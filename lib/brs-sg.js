/*! For license information please see brs-sg.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("brs-scenegraph",[],t):"object"==typeof exports?exports["brs-scenegraph"]=t():e["brs-scenegraph"]=t()}(Object("undefined"!=typeof self?self:this),()=>(()=>{var e={192:e=>{class t{constructor(e){this.value=e,this.next=void 0}}class i{constructor(){this.clear()}enqueue(e){const i=new t(e);this._head?(this._tail.next=i,this._tail=i):(this._head=i,this._tail=i),this._size++}dequeue(){const e=this._head;if(e)return this._head=this._head.next,this._size--,e.value}clear(){this._head=void 0,this._tail=void 0,this._size=0}get size(){return this._size}*[Symbol.iterator](){let e=this._head;for(;e;)yield e.value,e=e.next}}e.exports=i},308:(e,t,i)=>{"use strict";const s=i(192);e.exports=e=>{if(!Number.isInteger(e)&&e!==1/0||!(e>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const t=new s;let i=0;const n=async(e,s,...n)=>{i++;const a=(async()=>e(...n))();s(a);try{await a}catch{}i--,t.size>0&&t.dequeue()()},a=(s,...a)=>new Promise(r=>{((s,a,...r)=>{t.enqueue(n.bind(null,s,a,...r)),(async()=>{await Promise.resolve(),i<e&&t.size>0&&t.dequeue()()})()})(s,r,...a)});return Object.defineProperties(a,{activeCount:{get:()=>i},pendingCount:{get:()=>t.size},clearQueue:{value:()=>{t.clear()}}}),a}},507:function(e,t){var i,s;void 0===(s="function"==typeof(i=function(){"use strict";function e(e,t,i){this.low=0|e,this.high=0|t,this.unsigned=!!i}function t(e){return!0===(e&&e.__isLong__)}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),e.isLong=t;var i={},s={};function n(e,t){var n,a,o;return t?(o=0<=(e>>>=0)&&e<256)&&(a=s[e])?a:(n=r(e,(0|e)<0?-1:0,!0),o&&(s[e]=n),n):(o=-128<=(e|=0)&&e<128)&&(a=i[e])?a:(n=r(e,e<0?-1:0,!1),o&&(i[e]=n),n)}function a(e,t){if(isNaN(e)||!isFinite(e))return t?p:m;if(t){if(e<0)return p;if(e>=u)return v}else{if(e<=-c)return b;if(e+1>=c)return S}return e<0?a(-e,t).neg():r(e%d|0,e/d|0,t)}function r(t,i,s){return new e(t,i,s)}e.fromInt=n,e.fromNumber=a,e.fromBits=r;var o=Math.pow;function l(e,t,i){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return m;if("number"==typeof t?(i=t,t=!1):t=!!t,(i=i||10)<2||36<i)throw RangeError("radix");var s;if((s=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===s)return l(e.substring(1),t,i).neg();for(var n=a(o(i,8)),r=m,h=0;h<e.length;h+=8){var d=Math.min(8,e.length-h),u=parseInt(e.substring(h,h+d),i);if(d<8){var c=a(o(i,d));r=r.mul(c).add(a(u))}else r=(r=r.mul(n)).add(a(u))}return r.unsigned=t,r}function h(t){return t instanceof e?t:"number"==typeof t?a(t):"string"==typeof t?l(t):r(t.low,t.high,t.unsigned)}e.fromString=l,e.fromValue=h;var d=4294967296,u=d*d,c=u/2,g=n(1<<24),m=n(0);e.ZERO=m;var p=n(0,!0);e.UZERO=p;var f=n(1);e.ONE=f;var y=n(1,!0);e.UONE=y;var w=n(-1);e.NEG_ONE=w;var S=r(-1,2147483647,!1);e.MAX_VALUE=S;var v=r(-1,-1,!0);e.MAX_UNSIGNED_VALUE=v;var b=r(0,-2147483648,!1);e.MIN_VALUE=b;var F=e.prototype;return F.toInt=function(){return this.unsigned?this.low>>>0:this.low},F.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},F.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(b)){var t=a(e),i=this.div(t),s=i.mul(t).sub(this);return i.toString(e)+s.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var n=a(o(e,6),this.unsigned),r=this,l="";;){var h=r.div(n),d=(r.sub(h.mul(n)).toInt()>>>0).toString(e);if((r=h).isZero())return d+l;for(;d.length<6;)d="0"+d;l=""+d+l}},F.getHighBits=function(){return this.high},F.getHighBitsUnsigned=function(){return this.high>>>0},F.getLowBits=function(){return this.low},F.getLowBitsUnsigned=function(){return this.low>>>0},F.getNumBitsAbs=function(){if(this.isNegative())return this.eq(b)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return 0!=this.high?t+33:t+1},F.isZero=function(){return 0===this.high&&0===this.low},F.isNegative=function(){return!this.unsigned&&this.high<0},F.isPositive=function(){return this.unsigned||this.high>=0},F.isOdd=function(){return!(1&~this.low)},F.isEven=function(){return!(1&this.low)},F.equals=function(e){return t(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},F.eq=F.equals,F.notEquals=function(e){return!this.eq(e)},F.neq=F.notEquals,F.lessThan=function(e){return this.comp(e)<0},F.lt=F.lessThan,F.lessThanOrEqual=function(e){return this.comp(e)<=0},F.lte=F.lessThanOrEqual,F.greaterThan=function(e){return this.comp(e)>0},F.gt=F.greaterThan,F.greaterThanOrEqual=function(e){return this.comp(e)>=0},F.gte=F.greaterThanOrEqual,F.compare=function(e){if(t(e)||(e=h(e)),this.eq(e))return 0;var i=this.isNegative(),s=e.isNegative();return i&&!s?-1:!i&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},F.comp=F.compare,F.negate=function(){return!this.unsigned&&this.eq(b)?b:this.not().add(f)},F.neg=F.negate,F.add=function(e){t(e)||(e=h(e));var i=this.high>>>16,s=65535&this.high,n=this.low>>>16,a=65535&this.low,o=e.high>>>16,l=65535&e.high,d=e.low>>>16,u=0,c=0,g=0,m=0;return g+=(m+=a+(65535&e.low))>>>16,c+=(g+=n+d)>>>16,u+=(c+=s+l)>>>16,u+=i+o,r((g&=65535)<<16|(m&=65535),(u&=65535)<<16|(c&=65535),this.unsigned)},F.subtract=function(e){return t(e)||(e=h(e)),this.add(e.neg())},F.sub=F.subtract,F.multiply=function(e){if(this.isZero())return m;if(t(e)||(e=h(e)),e.isZero())return m;if(this.eq(b))return e.isOdd()?b:m;if(e.eq(b))return this.isOdd()?b:m;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return a(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,s=65535&this.high,n=this.low>>>16,o=65535&this.low,l=e.high>>>16,d=65535&e.high,u=e.low>>>16,c=65535&e.low,p=0,f=0,y=0,w=0;return y+=(w+=o*c)>>>16,f+=(y+=n*c)>>>16,y&=65535,f+=(y+=o*u)>>>16,p+=(f+=s*c)>>>16,f&=65535,p+=(f+=n*u)>>>16,f&=65535,p+=(f+=o*d)>>>16,p+=i*c+s*u+n*d+o*l,r((y&=65535)<<16|(w&=65535),(p&=65535)<<16|(f&=65535),this.unsigned)},F.mul=F.multiply,F.divide=function(e){if(t(e)||(e=h(e)),e.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?p:m;var i,s,n;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return p;if(e.gt(this.shru(1)))return y;n=p}else{if(this.eq(b))return e.eq(f)||e.eq(w)?b:e.eq(b)?f:(i=this.shr(1).div(e).shl(1)).eq(m)?e.isNegative()?f:w:(s=this.sub(e.mul(i)),n=i.add(s.div(e)));if(e.eq(b))return this.unsigned?p:m;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();n=m}for(s=this;s.gte(e);){i=Math.max(1,Math.floor(s.toNumber()/e.toNumber()));for(var r=Math.ceil(Math.log(i)/Math.LN2),l=r<=48?1:o(2,r-48),d=a(i),u=d.mul(e);u.isNegative()||u.gt(s);)u=(d=a(i-=l,this.unsigned)).mul(e);d.isZero()&&(d=f),n=n.add(d),s=s.sub(u)}return n},F.div=F.divide,F.modulo=function(e){return t(e)||(e=h(e)),this.sub(this.div(e).mul(e))},F.mod=F.modulo,F.not=function(){return r(~this.low,~this.high,this.unsigned)},F.and=function(e){return t(e)||(e=h(e)),r(this.low&e.low,this.high&e.high,this.unsigned)},F.or=function(e){return t(e)||(e=h(e)),r(this.low|e.low,this.high|e.high,this.unsigned)},F.xor=function(e){return t(e)||(e=h(e)),r(this.low^e.low,this.high^e.high,this.unsigned)},F.shiftLeft=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?r(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):r(0,this.low<<e-32,this.unsigned)},F.shl=F.shiftLeft,F.shiftRight=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?r(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):r(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},F.shr=F.shiftRight,F.shiftRightUnsigned=function(e){if(t(e)&&(e=e.toInt()),0==(e&=63))return this;var i=this.high;return e<32?r(this.low>>>e|i<<32-e,i>>>e,this.unsigned):r(32===e?i:i>>>e-32,0,this.unsigned)},F.shru=F.shiftRightUnsigned,F.toSigned=function(){return this.unsigned?r(this.low,this.high,!1):this},F.toUnsigned=function(){return this.unsigned?this:r(this.low,this.high,!0)},F.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},F.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24&255,255&e,e>>>8&255,e>>>16&255,e>>>24&255]},F.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t]},e})?i.apply(t,[]):i)||(e.exports=s)},907:e=>{var t,i,s=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function r(e){if(t===setTimeout)return setTimeout(e,0);if((t===n||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(i){try{return t.call(null,e,0)}catch(i){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:n}catch(e){t=n}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var o,l=[],h=!1,d=-1;function u(){h&&o&&(h=!1,o.length?l=o.concat(l):d=-1,l.length&&c())}function c(){if(!h){var e=r(u);h=!0;for(var t=l.length;t;){for(o=l,l=[];++d<t;)o&&o[d].run();d=-1,t=l.length}o=null,h=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{return i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];l.push(new g(e,t)),1!==l.length||h||r(c)},g.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},942:(e,t,i)=>{"use strict";var s=i(907);function n(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function a(e,t){for(var i,s="",n=0,a=-1,r=0,o=0;o<=e.length;++o){if(o<e.length)i=e.charCodeAt(o);else{if(47===i)break;i=47}if(47===i){if(a===o-1||1===r);else if(a!==o-1&&2===r){if(s.length<2||2!==n||46!==s.charCodeAt(s.length-1)||46!==s.charCodeAt(s.length-2))if(s.length>2){var l=s.lastIndexOf("/");if(l!==s.length-1){-1===l?(s="",n=0):n=(s=s.slice(0,l)).length-1-s.lastIndexOf("/"),a=o,r=0;continue}}else if(2===s.length||1===s.length){s="",n=0,a=o,r=0;continue}t&&(s.length>0?s+="/..":s="..",n=2)}else s.length>0?s+="/"+e.slice(a+1,o):s=e.slice(a+1,o),n=o-a-1;a=o,r=0}else 46===i&&-1!==r?++r:r=-1}return s}var r={resolve:function(){for(var e,t="",i=!1,r=arguments.length-1;r>=-1&&!i;r--){var o;r>=0?o=arguments[r]:(void 0===e&&(e=s.cwd()),o=e),n(o),0!==o.length&&(t=o+"/"+t,i=47===o.charCodeAt(0))}return t=a(t,!i),i?t.length>0?"/"+t:"/":t.length>0?t:"."},normalize:function(e){if(n(e),0===e.length)return".";var t=47===e.charCodeAt(0),i=47===e.charCodeAt(e.length-1);return 0!==(e=a(e,!t)).length||t||(e="."),e.length>0&&i&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return n(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,t=0;t<arguments.length;++t){var i=arguments[t];n(i),i.length>0&&(void 0===e?e=i:e+="/"+i)}return void 0===e?".":r.normalize(e)},relative:function(e,t){if(n(e),n(t),e===t)return"";if((e=r.resolve(e))===(t=r.resolve(t)))return"";for(var i=1;i<e.length&&47===e.charCodeAt(i);++i);for(var s=e.length,a=s-i,o=1;o<t.length&&47===t.charCodeAt(o);++o);for(var l=t.length-o,h=a<l?a:l,d=-1,u=0;u<=h;++u){if(u===h){if(l>h){if(47===t.charCodeAt(o+u))return t.slice(o+u+1);if(0===u)return t.slice(o+u)}else a>h&&(47===e.charCodeAt(i+u)?d=u:0===u&&(d=0));break}var c=e.charCodeAt(i+u);if(c!==t.charCodeAt(o+u))break;47===c&&(d=u)}var g="";for(u=i+d+1;u<=s;++u)u!==s&&47!==e.charCodeAt(u)||(0===g.length?g+="..":g+="/..");return g.length>0?g+t.slice(o+d):(o+=d,47===t.charCodeAt(o)&&++o,t.slice(o))},_makeLong:function(e){return e},dirname:function(e){if(n(e),0===e.length)return".";for(var t=e.charCodeAt(0),i=47===t,s=-1,a=!0,r=e.length-1;r>=1;--r)if(47===(t=e.charCodeAt(r))){if(!a){s=r;break}}else a=!1;return-1===s?i?"/":".":i&&1===s?"//":e.slice(0,s)},basename:function(e,t){if(void 0!==t&&"string"!=typeof t)throw new TypeError('"ext" argument must be a string');n(e);var i,s=0,a=-1,r=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var o=t.length-1,l=-1;for(i=e.length-1;i>=0;--i){var h=e.charCodeAt(i);if(47===h){if(!r){s=i+1;break}}else-1===l&&(r=!1,l=i+1),o>=0&&(h===t.charCodeAt(o)?-1===--o&&(a=i):(o=-1,a=l))}return s===a?a=l:-1===a&&(a=e.length),e.slice(s,a)}for(i=e.length-1;i>=0;--i)if(47===e.charCodeAt(i)){if(!r){s=i+1;break}}else-1===a&&(r=!1,a=i+1);return-1===a?"":e.slice(s,a)},extname:function(e){n(e);for(var t=-1,i=0,s=-1,a=!0,r=0,o=e.length-1;o>=0;--o){var l=e.charCodeAt(o);if(47!==l)-1===s&&(a=!1,s=o+1),46===l?-1===t?t=o:1!==r&&(r=1):-1!==t&&(r=-1);else if(!a){i=o+1;break}}return-1===t||-1===s||0===r||1===r&&t===s-1&&t===i+1?"":e.slice(t,s)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var i=t.dir||t.root,s=t.base||(t.name||"")+(t.ext||"");return i?i===t.root?i+s:i+"/"+s:s}(0,e)},parse:function(e){n(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return t;var i,s=e.charCodeAt(0),a=47===s;a?(t.root="/",i=1):i=0;for(var r=-1,o=0,l=-1,h=!0,d=e.length-1,u=0;d>=i;--d)if(47!==(s=e.charCodeAt(d)))-1===l&&(h=!1,l=d+1),46===s?-1===r?r=d:1!==u&&(u=1):-1!==r&&(u=-1);else if(!h){o=d+1;break}return-1===r||-1===l||0===u||1===u&&r===l-1&&r===o+1?-1!==l&&(t.base=t.name=0===o&&a?e.slice(1,l):e.slice(o,l)):(0===o&&a?(t.name=e.slice(1,r),t.base=e.slice(1,l)):(t.name=e.slice(o,r),t.base=e.slice(o,l)),t.ext=e.slice(r,l)),o>0?t.dir=e.slice(0,o-1):a&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};r.posix=r,e.exports=r}},t={};function i(s){var n=t[s];if(void 0!==n)return n.exports;var a=t[s]={exports:{}};return e[s].call(a.exports,a,a.exports,i),a.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};return(()=>{"use strict";i.r(s),i.d(s,{Animation:()=>ve,AnimationBase:()=>we,ArrayGrid:()=>R,Audio:()=>D,BrightScriptExtension:()=>dt,BusySpinner:()=>N,Button:()=>L,ButtonGroup:()=>O,ChannelStore:()=>E,CheckList:()=>H,ColorFieldInterpolator:()=>Ve,ComponentDefinition:()=>qe,ComponentScopeResolver:()=>je,ContentNode:()=>k,Dialog:()=>_,Field:()=>w,FloatFieldInterpolator:()=>Be,Font:()=>K,Global:()=>v,Group:()=>T,Interpolator:()=>Se,Keyboard:()=>j,KeyboardDialog:()=>X,Label:()=>P,LabelList:()=>U,LayoutGroup:()=>M,MarkupGrid:()=>Y,MarkupList:()=>q,MiniKeyboard:()=>Z,Node:()=>S,Overhang:()=>ee,Panel:()=>te,ParallelAnimation:()=>be,Poster:()=>A,RSGPalette:()=>ie,RadioButtonList:()=>se,Rectangle:()=>ne,RoSGNode:()=>f,RoSGNodeEvent:()=>y,RoSGScreen:()=>ht,RoSGScreenEvent:()=>ot,RowList:()=>ae,SGNodeFactory:()=>ke,SGNodeType:()=>$,SGRoot:()=>b,Scene:()=>oe,ScrollingLabel:()=>le,SequentialAnimation:()=>Fe,SoundEffect:()=>he,StandardDialog:()=>re,StandardProgressDialog:()=>ge,StdDlgContentArea:()=>ue,StdDlgProgressItem:()=>ce,StdDlgTitleArea:()=>de,Task:()=>me,TextEditBox:()=>z,Timer:()=>Q,TrickPlayBar:()=>pe,Vector2DFieldInterpolator:()=>Ce,Video:()=>fe,ZoomRowList:()=>ye,brsValueOf:()=>n,createNodeByType:()=>Re,createSceneByType:()=>De,customNodeExists:()=>Ae,fromAssociativeArray:()=>a,fromContentNode:()=>c,fromSGNode:()=>d,getBrsValueFromFieldType:()=>Je,getComponentDefinitionMap:()=>Ze,getNodeType:()=>_e,getValueKindFromFieldType:()=>Ke,initializeNode:()=>Ne,initializeTask:()=>Le,isSGNodeType:()=>Te,isSubtypeCheck:()=>He,jsValueOf:()=>t,setupInterpreterWithSubEnvs:()=>Qe,sgRoot:()=>F,subtypeHierarchy:()=>Ue,toAssociativeArray:()=>r,toContentNode:()=>u,toSGNode:()=>o,updateSGNode:()=>h});const e=brsEngine;function t(i,s=!0,n){switch((0,e.isUnboxable)(i)&&(i=i.unbox()),i.kind){case e.ValueKind.Invalid:return null;case e.ValueKind.Uninitialized:return;case e.ValueKind.Boolean:return i.toBoolean();case e.ValueKind.String:return i.value;case e.ValueKind.Int32:case e.ValueKind.Float:case e.ValueKind.Double:return i.getValue();case e.ValueKind.Int64:return i.getValue().toNumber();case e.ValueKind.Interface:case e.ValueKind.Object:if(i instanceof e.RoArray||i instanceof e.RoList)return i.elements.map(e=>t(e,s,n));if(i instanceof e.RoByteArray)return i.elements;if(i instanceof S)return d(i,s,n);if(i instanceof e.RoAssociativeArray)return a(i,s);if(i instanceof e.BrsComponent)return{_component_:i.getComponentName()};if(i instanceof e.BrsInterface)return{_interface_:i.getInterfaceName()};break;case e.ValueKind.Callable:return{_callable_:i.name}}}function n(t,i,s){if(null==t)return e.BrsInvalid.Instance;const a=2147483648,l=typeof t;switch(l){case"boolean":return e.BrsBoolean.from(t);case"string":return new e.BrsString(t);case"number":return Number.isInteger(t)?t>=-a&&t<a?new e.Int32(t):new e.Int64(t):Number.isNaN(t)||t>=-34e37&&t<=34e37?new e.Float(t):new e.Double(t);case"object":return function(t,i,s){if((0,e.isBrsType)(t))return t;if(null===t)return e.BrsInvalid.Instance;if(t instanceof Uint8Array)return new e.RoByteArray(t);if(Array.isArray(t))return new e.RoArray(t.map(function(e){return n(e,i,s)}));if(t._node_||t._circular_){const i=t._node_?t._node_.split(":"):t._circular_.split(":");return 2===i.length?o(t,i[0],i[1],s):e.BrsInvalid.Instance}if(t._component_){const i=t._component_,s=e.BrsObjects.get(i);if(s)try{return s()}catch(t){return e.BrsInvalid.Instance}return e.BrsInvalid.Instance}return t._interface_?e.BrsInvalid.Instance:t._callable_?new e.Callable(t._callable_,{signature:{args:[new e.StdlibArgument("arg",e.ValueKind.Dynamic,e.BrsInvalid.Instance)],variadic:!0,returns:e.ValueKind.Void},impl:(t,...i)=>e.Uninitialized.Instance}):r(t,i,s)}(t,i,s);case"undefined":return e.Uninitialized.Instance;default:throw new Error(`brsValueOf not implemented for: ${t} <${l}>`)}}function a(i,s=!0){const n={};for(const[a,r]of i.elements)(0,e.isUnboxable)(r)?n[a]=t(r.unbox(),s):n[a]=t(r,s);return n}function r(t,i,s){const a=new e.RoAssociativeArray([],i);if(t instanceof Map)for(const[r,o]of t)a.set(new e.BrsString(r),n(o,i,s),!0);else{if("object"!=typeof t||null===t)throw new Error("Unsupported input type: "+typeof t);for(const r in t)t.hasOwnProperty(r)&&a.set(new e.BrsString(r),n(t[r],i,s),!0)}return a}function o(t,i,s,a){if(a??=new Map,t._circular_&&t._address_)return a.get(t._address_)||e.BrsInvalid.Instance;const r=ke.createNode(i,s)??new S([],s);r.address=t._address_||r.address,r.owner=t._owner_??r.owner,a.set(r.address,r);for(const e in t)e.startsWith("_")&&e.endsWith("_")&&e.length>2||r.setValueSilent(e,n(t[e],void 0,a));if(t._children_)for(const i of t._children_){const t=l(i);if(t){const e=o(i,t.type,t.subtype,a);r.appendChildToParent(e)}else void 0!==i._invalid_&&r.appendChildToParent(e.BrsInvalid.Instance)}return r}function l(e){if(!e||"object"!=typeof e)return;const t=e._node_??e._circular_;if("string"!=typeof t)return;const i=t.split(":");return 2===i.length?{type:i[0],subtype:i[1]}:void 0}function h(t,i,s){if(s??=new Map,t._circular_&&t._address_)return s.get(t._address_)||i;const a=t._address_;if(a&&a!==i.address){const e=i.address;i.address=a,s.delete(e)}i.owner=t._owner_??i.owner,s.set(i.address,i);for(const e in t){if(e.startsWith("_")&&e.endsWith("_")&&e.length>2)continue;const a=t[e],r=l(a);if(r){const t=a._address_,n=i.getValue(e);let l;l=n instanceof S&&t&&n.address===t?h(a,n,s):o(a,r.type,r.subtype,s),i.setValueSilent(e,l);continue}i.setValueSilent(e,n(a,void 0,s))}const r=t._children_;if(Array.isArray(r)){const t=i.getNodeChildren();for(const e of t)e instanceof S&&s.set(e.address,e);for(let n=0;n<r.length;n++){const a=r[n],d=t[n];if(a&&void 0!==a._invalid_){d instanceof S&&i.removeChildrenAtIndex(n,1),d!==e.BrsInvalid.Instance&&(t.splice(n,0,e.BrsInvalid.Instance),i.changed=!0);continue}const u=l(a);if(!u){d instanceof S&&i.removeChildrenAtIndex(n,1),d!==e.BrsInvalid.Instance&&(t.splice(n,0,e.BrsInvalid.Instance),i.changed=!0);continue}const c=a._address_;let g=c?s.get(c):void 0;g=g instanceof S?h(a,g,s):o(a,u.type,u.subtype,s),g instanceof S&&(s.set(g.address,g),d instanceof S?d!==g&&i.replaceChildAtIndex(g,n):d===e.BrsInvalid.Instance?(i.removeChildrenAtIndex(n,1),i.insertChildAtIndex(g,n)):i.insertChildAtIndex(g,n))}const n=t.length-r.length;if(n>0)i.removeChildrenAtIndex(r.length,n);else if(n<0)for(let i=0;i<Math.abs(n);i++)t.push(e.BrsInvalid.Instance)}return i.changed=!0,i}function d(i,s=!0,n){if(n??=new WeakSet,n.has(i))return{_circular_:`${_e(i.nodeSubtype)}:${i.nodeSubtype}`,_address_:i.address};n.add(i);const a={},r=i.getNodeFields(),o=[];a._node_=`${_e(i.nodeSubtype)}:${i.nodeSubtype}`,a._address_=i.address,a._owner_=i.owner;for(const[l,h]of r)if(!h.isHidden()){let r=h.getValue(!1);if((0,e.isUnboxable)(r)&&(r=r.unbox()),i instanceof me&&h.isPortObserved(i)&&o.push(l),r instanceof S){a[l]=d(r,s,n);continue}a[l]=t(r,s,n)}o.length&&(a._observed_=o);const l=i.getNodeChildren();return s&&l.length>0&&(a._children_=l.map(e=>e instanceof S?d(e,s,n):{_invalid_:null})),a}function u(e){const t=new k;for(const[i,s]of e.elements)t.setValueSilent(i,s);return t}function c(t){const i=new e.RoAssociativeArray([],!0);for(const[s,n]of t.getNodeFields())i.set(new e.BrsString(s),n.getValue(!1));return i}var g;function m(e){return e instanceof S&&"function"==typeof e.addParentField&&"function"==typeof e.removeParentField}function p(e){if(!(e instanceof S&&"id"in e))return;const t=e;return"number"==typeof t.id?t.id:void 0}!function(e){e.Interface="interface",e.Array="array",e.AssocArray="assocarray",e.Int32="integer",e.IntArray="intarray",e.Int64="longinteger",e.Double="double",e.Float="float",e.FloatArray="floatarray",e.Font="font",e.Node="node",e.Boolean="boolean",e.BoolArray="boolarray",e.String="string",e.StringArray="stringarray",e.Function="function",e.Object="object",e.Color="color",e.ColorArray="colorarray",e.Time="time",e.TimeArray="timearray",e.Rect2D="rect2d"}(g||(g={})),function(t){function i(e){switch(e.toLowerCase()){case"interface":return t.Interface;case"array":case"roarray":case"nodearray":case"vector2d":case"vector2darray":case"rect2darray":return t.Array;case"boolarray":return t.BoolArray;case"colorarray":return t.ColorArray;case"intarray":return t.IntArray;case"floatarray":return t.FloatArray;case"stringarray":return t.StringArray;case"timearray":return t.TimeArray;case"rect2d":return t.Rect2D;case"roassociativearray":case"assocarray":return t.AssocArray;case"font":return t.Font;case"node":return t.Node;case"bool":case"boolean":return t.Boolean;case"int":case"integer":return t.Int32;case"longint":case"longinteger":return t.Int64;case"float":return t.Float;case"double":return t.Double;case"uri":case"str":case"string":return t.String;case"function":return t.Function;case"object":return t.Object;case"color":return t.Color;case"time":return t.Time;default:return}}t.fromString=i,t.fromBrsType=function s(n){if((0,e.isUnboxable)(n))return s(n.unbox());if(n.kind!==e.ValueKind.Object)return i(e.ValueKind.toString(n.kind));switch(n.getComponentName().toLowerCase()){case"roarray":return t.Array;case"roassociativearray":return t.AssocArray;case"rosgnode":return n instanceof S&&"font"===n.nodeSubtype.toLowerCase()?t.Font:t.Node;default:return}}}(g||(g={}));class f extends e.BrsComponent{nodeSubtype;kind=e.ValueKind.Object;httpAgent;m=new e.RoAssociativeArray([]);location="";constructor(t,i="Node"){super("roSGNode"),this.nodeSubtype=i,this.registerMethods({ifAssociativeArray:[this.clear,this.delete,this.addReplace,this.count,this.doesExist,this.append,this.keys,this.items,this.lookup,this.lookupCI],ifSGNodeField:[this.addField,this.addFields,this.getField,this.getFields,this.getFieldType,this.getFieldTypes,this.hasField,this.observeField,this.unobserveField,this.observeFieldScoped,this.observeFieldScopedEx,this.unobserveFieldScoped,this.removeField,this.removeFields,this.setField,this.setFields,this.update,this.signalBeacon,this.threadInfo,this.queueFields,this.moveIntoField,this.moveFromField,this.setRef,this.canGetRef,this.getRef],ifSGNodeChildren:[this.appendChild,this.getChildCount,this.getChildren,this.removeChild,this.getParent,this.createChild,this.replaceChild,this.removeChildren,this.appendChildren,this.getChild,this.insertChild,this.removeChildrenIndex,this.removeChildIndex,this.reparent,this.createChildren,this.replaceChildren,this.insertChildren,this.getScene],ifSGNodeFocus:[this.hasFocus,this.setFocus,this.isInFocusChain],ifSGNodeDict:[this.findNode,this.isSameNode,this.subtype,this.callFunc,this.isSubtype,this.parentSubtype,this.clone],ifSGNodeBoundingRect:[this.boundingRect,this.localBoundingRect,this.sceneBoundingRect],ifSGNodeHttpAgentAccess:[this.getHttpAgent,this.setHttpAgent]}),this.httpAgent=new e.RoHttpAgent,this.registerHttpAgent(this.httpAgent)}registerHttpAgent(e){this.registerMethods({ifHttpAgent:[e.ifHttpAgent.addHeader,e.ifHttpAgent.setHeaders,e.ifHttpAgent.initClientCertificates,e.ifHttpAgent.setCertificatesFile,e.ifHttpAgent.setCertificatesDepth,e.ifHttpAgent.enableCookies,e.ifHttpAgent.getCookies,e.ifHttpAgent.addCookies,e.ifHttpAgent.clearCookies]})}equalTo(t){return e.BrsBoolean.False}set(t,i,s){if(!(0,e.isBrsString)(t))throw new Error("RoSGNode indexes must be strings");return this.setValue(t.getValue(),i),e.BrsInvalid.Instance}callFunc=new e.Callable("callFunc",...e.Callable.variadic({signature:{args:[new e.StdlibArgument("functionName",e.ValueKind.String)],returns:e.ValueKind.Dynamic},impl:(e,t,...i)=>this.callFunction(e,t,...i)}));clear=new e.Callable("clear",{signature:{args:[],returns:e.ValueKind.Void},impl:t=>(this.clearNodeFields(),e.Uninitialized.Instance)});delete=new e.Callable("delete",{signature:{args:[new e.StdlibArgument("str",e.ValueKind.String)],returns:e.ValueKind.Boolean},impl:(t,i)=>(this.removeFieldEntry(i.getValue()),e.BrsBoolean.True)});addReplace=new e.Callable("addReplace",{signature:{args:[new e.StdlibArgument("key",e.ValueKind.String),new e.StdlibArgument("value",e.ValueKind.Dynamic)],returns:e.ValueKind.Void},impl:(t,i,s)=>(this.location=t.formatLocation(),this.setValue(i.getValue(),s),e.Uninitialized.Instance)});count=new e.Callable("count",{signature:{args:[],returns:e.ValueKind.Int32},impl:t=>new e.Int32(this.getElements().length)});doesExist=new e.Callable("doesExist",{signature:{args:[new e.StdlibArgument("str",e.ValueKind.String)],returns:e.ValueKind.Boolean},impl:(t,i)=>e.BrsBoolean.from(this.getElements().some(e=>e.getValue()===i.getValue().toLowerCase()))});append=new e.Callable("append",{signature:{args:[new e.StdlibArgument("obj",e.ValueKind.Object)],returns:e.ValueKind.Void},impl:(t,i)=>(this.appendNodeFields(i),e.Uninitialized.Instance)});keys=new e.Callable("keys",{signature:{args:[],returns:e.ValueKind.Object},impl:t=>new e.RoArray(this.getElements())});items=new e.Callable("items",{signature:{args:[],returns:e.ValueKind.Object},impl:t=>new e.RoArray(this.getElements().map(e=>r({key:e,value:this.get(e)})))});lookup=new e.Callable("lookup",{signature:{args:[new e.StdlibArgument("key",e.ValueKind.String)],returns:e.ValueKind.Dynamic},impl:(e,t)=>this.get(t)});lookupCI=new e.Callable("lookupCI",this.lookup.signatures[0]);addField=new e.Callable("addField",{signature:{args:[new e.StdlibArgument("fieldName",e.ValueKind.String),new e.StdlibArgument("type",e.ValueKind.String),new e.StdlibArgument("alwaysNotify",e.ValueKind.Boolean)],returns:e.ValueKind.Boolean},impl:(t,i,s,n)=>(this.location=t.formatLocation(),this.addNodeField(i.getValue(),s.getValue(),n.toBoolean()),e.BrsBoolean.True)});addFields=new e.Callable("addFields",{signature:{args:[new e.StdlibArgument("fields",e.ValueKind.Object)],returns:e.ValueKind.Boolean},impl:(t,i)=>i instanceof e.RoAssociativeArray?(this.location=t.formatLocation(),this.setNodeFields(i,!0),e.BrsBoolean.True):e.BrsBoolean.False});threadInfo=new e.Callable("threadInfo",{signature:{args:[],returns:e.ValueKind.Object},impl:e=>this.getThreadInfo()});queueFields=new e.Callable("queueFields",{signature:{args:[new e.StdlibArgument("queueNode",e.ValueKind.Boolean)],returns:e.ValueKind.Void},impl:(t,i)=>e.Uninitialized.Instance});moveIntoField=new e.Callable("moveIntoField",{signature:{args:[new e.StdlibArgument("fieldName",e.ValueKind.String),new e.StdlibArgument("data",e.ValueKind.Object)],returns:e.ValueKind.Int32},impl:(t,i,s)=>{let n;if(n=s instanceof e.RoAssociativeArray?this.moveObjectIntoField(i.getValue(),s):{code:-1,msg:"Move data must be AA"},n.code<0){const i=t.formatLocation();e.BrsDevice.stderr.write(`warning,BRIGHTSCRIPT: ERROR: roSGNode.moveIntoField: ${n.msg}: ${i}`)}return new e.Int32(n.code)}});moveFromField=new e.Callable("moveFromField",{signature:{args:[new e.StdlibArgument("fieldName",e.ValueKind.String)],returns:e.ValueKind.Object},impl:(t,i)=>{const s=this.moveObjectFromField(i.getValue());if("string"==typeof s){const i=t.formatLocation();return e.BrsDevice.stderr.write(`warning,BRIGHTSCRIPT: ERROR: roSGNode.moveFromField: ${s}: ${i}`),e.BrsInvalid.Instance}return s}});setRef=new e.Callable("setRef",{signature:{args:[new e.StdlibArgument("fieldName",e.ValueKind.String),new e.StdlibArgument("data",e.ValueKind.Object)],returns:e.ValueKind.Boolean},impl:(t,i,s)=>{if(F.inTaskThread()||!(s instanceof e.RoAssociativeArray))return e.BrsBoolean.False;const n=this.setFieldByRef(i.getValue(),s);if(n<0){const s=t.formatLocation();e.BrsDevice.stderr.write(`warning,BRIGHTSCRIPT: ERROR: roSGNode.setRef: Could not find field '"${i.getValue()}"': ${s}`)}return e.BrsBoolean.from(n>0)}});canGetRef=new e.Callable("canGetRef",{signature:{args:[new e.StdlibArgument("fieldName",e.ValueKind.String)],returns:e.ValueKind.Boolean},impl:(t,i)=>e.BrsBoolean.from(this.canGetFieldByRef(i.getValue()))});getRef=new e.Callable("getRef",{signature:{args:[new e.StdlibArgument("fieldName",e.ValueKind.String)],returns:e.ValueKind.Dynamic},impl:(t,i)=>{const s=this.getFieldByRef(i.getValue());if("string"==typeof s&&s.length>0){const i=t.formatLocation();e.BrsDevice.stderr.write(`warning,BRIGHTSCRIPT: ERROR: roSGNode.getRef: ${s}: ${i}`)}else if(s instanceof e.RoAssociativeArray)return s;return e.BrsInvalid.Instance}});getField=new e.Callable("getField",{signature:{args:[new e.StdlibArgument("fieldName",e.ValueKind.String)],returns:e.ValueKind.Dynamic},impl:(e,t)=>this.get(t)});getFields=new e.Callable("getFields",{signature:{args:[],returns:e.ValueKind.Object},impl:e=>this.getNodeFieldsAsAA()});getFieldType=new e.Callable("getFieldType",{signature:{args:[new e.StdlibArgument("fieldName",e.ValueKind.String)],returns:e.ValueKind.String},impl:(t,i)=>{const s=this.getNodeFieldTypes().get(i);return s instanceof e.BrsString?s:new e.BrsString("<NoSuchField>")}});getFieldTypes=new e.Callable("getFieldTypes",{signature:{args:[],returns:e.ValueKind.Object},impl:e=>this.getNodeFieldTypes()});hasField=new e.Callable("hasField",{signature:{args:[new e.StdlibArgument("fieldName",e.ValueKind.String)],returns:e.ValueKind.Boolean},impl:(t,i)=>e.BrsBoolean.from(this.hasNodeField(i.getValue()))});observeField=new e.Callable("observeField",{signature:{args:[new e.StdlibArgument("fieldName",e.ValueKind.String),new e.StdlibArgument("functionName",e.ValueKind.String),new e.StdlibArgument("infoFields",e.ValueKind.Object,e.BrsInvalid.Instance)],returns:e.ValueKind.Boolean},impl:(e,t,i,s)=>this.addObserver(e,"unscoped",t,i,s)},{signature:{args:[new e.StdlibArgument("fieldName",e.ValueKind.String),new e.StdlibArgument("port",e.ValueKind.Object),new e.StdlibArgument("infoFields",e.ValueKind.Object,e.BrsInvalid.Instance)],returns:e.ValueKind.Boolean},impl:(e,t,i,s)=>this.addObserver(e,"unscoped",t,i,s)});unobserveField=new e.Callable("unobserveField",{signature:{args:[new e.StdlibArgument("fieldName",e.ValueKind.String)],returns:e.ValueKind.Boolean},impl:(t,i)=>{const s=i.getValue();if(!t.environment.hostNode){const i=t.formatLocation();return e.BrsDevice.stderr.write(`warning,BRIGHTSCRIPT: ERROR: roSGNode.unObserveField: "${this.nodeSubtype}.${s}" no active host node: ${i}`),e.BrsBoolean.False}return this.removeObserver(s),e.BrsBoolean.True}});observeFieldScoped=new e.Callable("observeFieldScoped",{signature:{args:[new e.StdlibArgument("fieldName",e.ValueKind.String),new e.StdlibArgument("functionName",e.ValueKind.String),new e.StdlibArgument("infoFields",e.ValueKind.Object,e.BrsInvalid.Instance)],returns:e.ValueKind.Boolean},impl:(e,t,i,s)=>this.addObserver(e,"scoped",t,i,s)},{signature:{args:[new e.StdlibArgument("fieldName",e.ValueKind.String),new e.StdlibArgument("port",e.ValueKind.Object),new e.StdlibArgument("infoFields",e.ValueKind.Object,e.BrsInvalid.Instance)],returns:e.ValueKind.Boolean},impl:(e,t,i,s)=>this.addObserver(e,"scoped",t,i,s)});observeFieldScopedEx=new e.Callable("observeFieldScopedEx",{signature:{args:[new e.StdlibArgument("fieldName",e.ValueKind.String),new e.StdlibArgument("functionName",e.ValueKind.String),new e.StdlibArgument("infoFields",e.ValueKind.Object,e.BrsInvalid.Instance)],returns:e.ValueKind.Boolean},impl:(e,t,i,s)=>this.addObserver(e,"scoped",t,i,s)},{signature:{args:[new e.StdlibArgument("fieldName",e.ValueKind.String),new e.StdlibArgument("port",e.ValueKind.Object),new e.StdlibArgument("infoFields",e.ValueKind.Object,e.BrsInvalid.Instance)],returns:e.ValueKind.Boolean},impl:(e,t,i,s)=>this.addObserver(e,"scoped",t,i,s)});unobserveFieldScoped=new e.Callable("unobserveFieldScoped",{signature:{args:[new e.StdlibArgument("fieldName",e.ValueKind.String)],returns:e.ValueKind.Boolean},impl:(t,i)=>{const s=i.getValue();if(!t.environment.hostNode){const i=t.formatLocation();return e.BrsDevice.stderr.write(`warning,BRIGHTSCRIPT: ERROR: roSGNode.unObserveFieldScoped: "${this.nodeSubtype}.${s}" no active host node: ${i}`),e.BrsBoolean.False}return this.removeObserver(s,t.environment.hostNode),e.BrsBoolean.True}});removeField=new e.Callable("removeField",{signature:{args:[new e.StdlibArgument("fieldName",e.ValueKind.String)],returns:e.ValueKind.Boolean},impl:(t,i)=>(this.removeFieldEntry(i.getValue()),e.BrsBoolean.True)});removeFields=new e.Callable("removeFields",{signature:{args:[new e.StdlibArgument("fieldNames",e.ValueKind.Object)],returns:e.ValueKind.Boolean},impl:(t,i)=>{if(!(i instanceof e.RoArray))return e.BrsBoolean.False;const s=i.getElements();if(0===s.length)return e.BrsBoolean.False;let n=!1;for(const t of s)(0,e.isBrsString)(t)&&(n||=this.removeFieldEntry(t.getValue()));return e.BrsBoolean.from(n)}});setField=new e.Callable("setField",{signature:{args:[new e.StdlibArgument("fieldName",e.ValueKind.String),new e.StdlibArgument("value",e.ValueKind.Dynamic)],returns:e.ValueKind.Boolean},impl:(t,i,s)=>{const n=i.getValue();return this.location=t.formatLocation(),m(this)||this.getElements().some(e=>e.getValue().toLowerCase()===n.toLowerCase())?this.canAcceptValue(n,s)?(this.setValue(n,s),e.BrsBoolean.True):(e.BrsDevice.stderr.write(`warning,BRIGHTSCRIPT: ERROR: roSGNode.setField: Type mismatch: ${this.location}`),e.BrsBoolean.True):(e.BrsDevice.stderr.write(`warning,BRIGHTSCRIPT: ERROR: roSGNode.setField: Tried to set nonexistent field "${n}": ${this.location}`),e.BrsBoolean.False)}});setFields=new e.Callable("setFields",{signature:{args:[new e.StdlibArgument("fields",e.ValueKind.Object)],returns:e.ValueKind.Boolean},impl:(t,i)=>i instanceof e.RoAssociativeArray?(this.location=t.formatLocation(),this.setNodeFields(i,!1),e.BrsBoolean.True):e.BrsBoolean.False});update=new e.Callable("update",{signature:{args:[new e.StdlibArgument("content",e.ValueKind.Object),new e.StdlibArgument("createFields",e.ValueKind.Boolean,e.BrsBoolean.False)],returns:e.ValueKind.Uninitialized},impl:(t,i,s)=>(this.location=t.formatLocation(),this.updateFields(t,i,s.toBoolean()),e.Uninitialized.Instance)});signalBeacon=new e.Callable("signalBeacon",{signature:{args:[new e.StdlibArgument("beacon",e.ValueKind.String)],returns:e.ValueKind.Int32},impl:(t,i)=>new e.Int32(["AppLaunchComplete","AppDialogInitiate","AppDialogComplete","EPGLaunchInitiate","EPGLaunchComplete"].includes(i.getValue())?0:2)});getChildCount=new e.Callable("getChildCount",{signature:{args:[],returns:e.ValueKind.Int32},impl:t=>new e.Int32(this.getNodeChildren().length)});appendChild=new e.Callable("appendChild",{signature:{args:[new e.StdlibArgument("child",e.ValueKind.Dynamic)],returns:e.ValueKind.Boolean},impl:(t,i)=>e.BrsBoolean.from(this.appendChildToParent(i))});getChildren=new e.Callable("getChildren",{signature:{args:[new e.StdlibArgument("num_children",e.ValueKind.Int32),new e.StdlibArgument("index",e.ValueKind.Int32)],returns:e.ValueKind.Object},impl:(t,i,s)=>{const n=i.getValue(),a=s.getValue(),r=this.getNodeChildren();let o;return o=n<=-1&&0===a?new e.RoArray(r.slice().map(t=>t instanceof e.BrsInvalid?t.box():t)):n<=0||a<0||a>=r.length?new e.RoArray([]):new e.RoArray(r.slice(a,a+n).map(t=>t instanceof e.BrsInvalid?t.box():t)),o}});removeChild=new e.Callable("removeChild",{signature:{args:[new e.StdlibArgument("child",e.ValueKind.Dynamic)],returns:e.ValueKind.Boolean},impl:(t,i)=>e.BrsBoolean.from(this.removeChildByReference(i))});getParent=new e.Callable("getParent",{signature:{args:[],returns:e.ValueKind.Dynamic},impl:e=>this.getNodeParent()});createChild=new e.Callable("createChild",{signature:{args:[new e.StdlibArgument("nodeType",e.ValueKind.String)],returns:e.ValueKind.Object},impl:(e,t)=>{const i=Re(t.getValue(),e);return i instanceof f&&this.appendChildToParent(i),i}});replaceChild=new e.Callable("replaceChild",{signature:{args:[new e.StdlibArgument("newChild",e.ValueKind.Dynamic),new e.StdlibArgument("index",e.ValueKind.Int32)],returns:e.ValueKind.Boolean},impl:(t,i,s)=>i instanceof f?e.BrsBoolean.from(this.replaceChildAtIndex(i,s.getValue())):e.BrsBoolean.False});removeChildren=new e.Callable("removeChildren",{signature:{args:[new e.StdlibArgument("child_nodes",e.ValueKind.Dynamic)],returns:e.ValueKind.Boolean},impl:(t,i)=>{if(i instanceof e.RoArray){const t=i.getElements();if(0!==t.length){for(const e of t)this.removeChildByReference(e);return e.BrsBoolean.True}}return e.BrsBoolean.False}});removeChildrenIndex=new e.Callable("removeChildrenIndex",{signature:{args:[new e.StdlibArgument("num_children",e.ValueKind.Int32),new e.StdlibArgument("index",e.ValueKind.Int32)],returns:e.ValueKind.Boolean},impl:(t,i,s)=>{const n=i.getValue(),a=s.getValue();return e.BrsBoolean.from(this.removeChildrenAtIndex(a,n))}});getChild=new e.Callable("getChild",{signature:{args:[new e.StdlibArgument("index",e.ValueKind.Int32)],returns:e.ValueKind.Dynamic},impl:(t,i)=>{const s=i.getValue(),n=this.getNodeChildren();let a=e.BrsInvalid.Instance;return s>=0&&s<n.length&&(a=n[s]),a}});appendChildren=new e.Callable("appendChildren",{signature:{args:[new e.StdlibArgument("child_nodes",e.ValueKind.Dynamic)],returns:e.ValueKind.Boolean},impl:(t,i)=>{if(i instanceof e.RoArray){const t=i.getElements();if(0!==t.length){for(const e of t)e instanceof f&&(this.removeChildByReference(e),this.appendChildToParent(e));return e.BrsBoolean.True}}return e.BrsBoolean.False}});createChildren=new e.Callable("createChildren",{signature:{args:[new e.StdlibArgument("num_children",e.ValueKind.Int32),new e.StdlibArgument("subtype",e.ValueKind.String)],returns:e.ValueKind.Dynamic},impl:(t,i,s)=>{const n=i.getValue(),a=[];for(let e=0;e<n;e++){const e=Re(s.getValue(),t);e instanceof f&&(this.appendChildToParent(e),a.push(e))}return new e.RoArray(a)}});replaceChildren=new e.Callable("replaceChildren",{signature:{args:[new e.StdlibArgument("child_nodes",e.ValueKind.Dynamic),new e.StdlibArgument("index",e.ValueKind.Int32)],returns:e.ValueKind.Boolean},impl:(t,i,s)=>{if(i instanceof e.RoArray){let t=s.getValue();const n=i.getElements();if(0!==n.length){for(const e of n)e instanceof f&&!this.replaceChildAtIndex(e,t)&&this.removeChildByReference(e),t+=1;return e.BrsBoolean.True}}return e.BrsBoolean.False}});insertChildren=new e.Callable("insertChildren",{signature:{args:[new e.StdlibArgument("child_nodes",e.ValueKind.Dynamic),new e.StdlibArgument("index",e.ValueKind.Int32)],returns:e.ValueKind.Boolean},impl:(t,i,s)=>{if(i instanceof e.RoArray){let t=s.getValue();const n=i.getElements();if(0!==n.length){for(const e of n)this.insertChildAtIndex(e,t),t+=1;return e.BrsBoolean.True}}return e.BrsBoolean.False}});insertChild=new e.Callable("insertChild",{signature:{args:[new e.StdlibArgument("child",e.ValueKind.Dynamic),new e.StdlibArgument("index",e.ValueKind.Int32)],returns:e.ValueKind.Boolean},impl:(t,i,s)=>e.BrsBoolean.from(this.insertChildAtIndex(i,s.getValue()))});removeChildIndex=new e.Callable("removeChildIndex",{signature:{args:[new e.StdlibArgument("index",e.ValueKind.Int32)],returns:e.ValueKind.Boolean},impl:(t,i)=>e.BrsBoolean.from(this.removeChildrenAtIndex(i.getValue(),1))});reparent=new e.Callable("reparent",{signature:{args:[new e.StdlibArgument("newParent",e.ValueKind.Dynamic),new e.StdlibArgument("adjustTransform",e.ValueKind.Boolean)],returns:e.ValueKind.Boolean},impl:(t,i,s)=>{if(i instanceof f&&i!==this){const t=this.getNodeParent();return t instanceof f&&t.removeChildByReference(this),i.appendChildToParent(this),e.BrsBoolean.True}return e.BrsBoolean.False}});boundingRect=new e.Callable("boundingRect",{signature:{args:[],returns:e.ValueKind.Dynamic},impl:e=>r(this.getBoundingRect(e,"toParent"))});localBoundingRect=new e.Callable("localBoundingRect",{signature:{args:[],returns:e.ValueKind.Dynamic},impl:e=>r(this.getBoundingRect(e,"local"))});sceneBoundingRect=new e.Callable("sceneBoundingRect",{signature:{args:[],returns:e.ValueKind.Dynamic},impl:e=>r(this.getBoundingRect(e,"toScene"))});hasFocus=new e.Callable("hasFocus",{signature:{args:[],returns:e.ValueKind.Boolean},impl:t=>e.BrsBoolean.from(F.focused===this)});setFocus=new e.Callable("setFocus",{signature:{args:[new e.StdlibArgument("on",e.ValueKind.Boolean)],returns:e.ValueKind.Boolean},impl:(t,i)=>(this.location=t.formatLocation(),e.BrsBoolean.from(this.setNodeFocus(t,i.toBoolean())))});isInFocusChain=new e.Callable("isInFocusChain",{signature:{args:[],returns:e.ValueKind.Boolean},impl:t=>F.focused===this?e.BrsBoolean.True:e.BrsBoolean.from(this.isChildrenFocused())});findNode=new e.Callable("findNode",{signature:{args:[new e.StdlibArgument("name",e.ValueKind.String)],returns:e.ValueKind.Dynamic},impl:(t,i)=>{const s=i.getValue();if(""===s.trim())return e.BrsInvalid.Instance;let n=this.findNodeById(this,s);return n instanceof e.BrsInvalid&&(n=this.findNodeById(this.findRootNode(),s)),n}});isSubtype=new e.Callable("isSubtype",{signature:{args:[new e.StdlibArgument("nodeType",e.ValueKind.String)],returns:e.ValueKind.Boolean},impl:(t,i)=>e.BrsBoolean.from(He(this.nodeSubtype,i.getValue()))});parentSubtype=new e.Callable("parentSubtype",{signature:{args:[new e.StdlibArgument("nodeType",e.ValueKind.String)],returns:e.ValueKind.Object},impl:(t,i)=>{const s=Ue.get(i.getValue().toLowerCase());return s?new e.BrsString(s):e.BrsInvalid.Instance}});isSameNode=new e.Callable("isSameNode",{signature:{args:[new e.StdlibArgument("roSGNode",e.ValueKind.Dynamic)],returns:e.ValueKind.Boolean},impl:(t,i)=>e.BrsBoolean.from(this.compareNodes(i))});subtype=new e.Callable("subtype",{signature:{args:[],returns:e.ValueKind.String},impl:t=>new e.BrsString(this.nodeSubtype)});clone=new e.Callable("clone",{signature:{args:[new e.StdlibArgument("isDeepCopy",e.ValueKind.Boolean)],returns:e.ValueKind.Object},impl:(e,t)=>this.cloneNode(t.toBoolean(),e)});getScene=new e.Callable("getScene",{signature:{args:[],returns:e.ValueKind.Object},impl:t=>F.scene??e.BrsInvalid.Instance});getHttpAgent=new e.Callable("getHttpAgent",{signature:{args:[],returns:e.ValueKind.Object},impl:e=>this.httpAgent});setHttpAgent=new e.Callable("setHttpAgent",{signature:{args:[new e.StdlibArgument("httpAgent",e.ValueKind.Object)],returns:e.ValueKind.Boolean},impl:(t,i)=>i instanceof e.RoHttpAgent?(this.httpAgent=i,this.registerHttpAgent(i),e.BrsBoolean.True):e.BrsBoolean.False})}class y extends e.BrsEvent{node;fieldName;fieldValue;infoFields;constructor(e,t,i,s){super("roSGNodeEvent"),this.node=e,this.fieldName=t,this.fieldValue=i,this.infoFields=s,this.appendMethods([this.getData,this.getField,this.getRoSGNode,this.getNode,this.getInfo])}getData=new e.Callable("getdata",{signature:{args:[],returns:e.ValueKind.Dynamic},impl:e=>this.fieldValue});getField=new e.Callable("getfield",{signature:{args:[],returns:e.ValueKind.Dynamic},impl:e=>this.fieldName});getRoSGNode=new e.Callable("getrosgnode",{signature:{args:[],returns:e.ValueKind.Dynamic},impl:e=>this.node});getNode=new e.Callable("getnode",{signature:{args:[],returns:e.ValueKind.Dynamic},impl:e=>this.node.getValue("id")});getInfo=new e.Callable("getinfo",{signature:{args:[],returns:e.ValueKind.Object},impl:t=>this.infoFields??new e.RoAssociativeArray([])})}class w{name;value;type;alwaysNotify;system;hidden;valueRef;permanentObservers=[];unscopedObservers=[];scopedObservers=new Map;constructor(e="",t,i,s=!1,n=!1,a=!1,r=!1){this.name=e,this.value=t,this.type=i,this.alwaysNotify=s,this.system=n,this.hidden=a,this.valueRef=r,this.value=this.convertValue(t)}toString(e){return this.value.toString(e)}isHidden(){return this.hidden}setHidden(e){this.hidden=e}isSystem(){return this.system}isAlwaysNotify(){return this.alwaysNotify}isValueRef(){return this.valueRef}getName(){return this.name}getType(){return this.type}getValue(e=!0){return e&&(this.hidden=!1),this.value}setValue(e,t=!0,i=!1){this.hidden=!1,this.valueRef=i;const s=this.value;return i||(m(s)&&s.removeParentField(this),m(e)&&e.addParentField(this),e=this.convertValue(e)),this.value=e,!(!t||!this.alwaysNotify&&this.isEqual(s,e)||(this.notifyObservers(),0))}notifyObservers(){for(const e of this.permanentObservers)this.executeCallbacks(e);for(const e of this.unscopedObservers)this.executeCallbacks(e);for(const[e,t]of this.scopedObservers)for(const e of t)this.executeCallbacks(e)}canAcceptValue(t){if(Ke(this.type)===e.ValueKind.Object&&(0,e.isInvalid)(t)||(0,e.isAnyNumber)(this.value)&&(0,e.isAnyNumber)(t)||(0,e.isBrsString)(this.value)&&(0,e.isBrsString)(t)||(0,e.isBrsString)(this.value)&&(0,e.isAnyNumber)(t)||(0,e.isBrsString)(this.value)&&(0,e.isBrsBoolean)(t)||(0,e.isBrsBoolean)(this.value)&&(0,e.isBrsString)(t))return!0;if(this.type===g.String&&(0,e.isStringComp)(t))return!0;if(this.type===g.Rect2D&&t instanceof e.RoArray)return 4===t.elements.length&&t.elements.every(t=>(0,e.isAnyNumber)(t));if(this.type===g.Rect2D&&t instanceof e.RoAssociativeArray){const e=a(t);return e&&"number"==typeof e.x&&"number"==typeof e.y&&"number"==typeof e.width&&"number"==typeof e.height}return!(![g.FloatArray,g.IntArray,g.ColorArray,g.TimeArray].includes(this.type)||!((0,e.isAnyNumber)(t)||t instanceof e.RoArray))||!(this.type!==g.BoolArray||!((0,e.isBrsBoolean)(t)||t instanceof e.RoArray))||this.type===g.fromBrsType(t)}addObserver(e,t,i,s,n,a){this.hidden=!1;const r=t.environment.hostNode??s;let o={interpreter:t,environment:t.environment,hostNode:r,callable:i,eventParams:{node:s,fieldName:n,infoFields:a}};if("scoped"===e){let e=this.scopedObservers.get(r)||[];this.scopedObservers.set(r,[...e,o])}else"unscoped"===e?this.unscopedObservers.push(o):this.permanentObservers.push(o)}removeUnscopedObservers(){this.unscopedObservers.splice(0)}removeScopedObservers(e){this.scopedObservers.get(e)?.splice(0),this.scopedObservers.delete(e)}clearObservers(){this.permanentObservers.length=0,this.unscopedObservers.length=0,this.scopedObservers.clear()}isObserved(){return this.permanentObservers.length>0||this.unscopedObservers.length>0||this.scopedObservers.size>0}isPortObserved(t){const i=p(t);return void 0!==i&&(this.unscopedObservers.some(t=>t.callable instanceof e.RoMessagePort&&p(t.hostNode)===i)||this.scopedObservers.get(t)?.some(t=>t.callable instanceof e.RoMessagePort)||!1)}convertValue(t){return(0,e.isAnyNumber)(t)&&t.kind!==Ke(this.type)?((0,e.isBoxedNumber)(t)&&(t=t.unbox()),t=this.convertNumber(t)):(0,e.isBrsBoolean)(t)&&this.type===g.String?t=new e.BrsString(t.toBoolean()?"1":"0"):(0,e.isBrsString)(t)&&this.type===g.Boolean?t=e.BrsBoolean.from("true"===t.getValue().toLowerCase()):(0,e.isBrsBoolean)(t)&&this.type===g.BoolArray?t=new e.RoArray([t]):this.type===g.Rect2D?t=this.convertRect2D(t):this.type===g.String&&(0,e.isStringComp)(t)&&(t=new e.BrsString(t.getValue())),(0,e.isBoxable)(t)&&(t=t.box()),t}convertNumber(t){let i=t;return this.type===g.Float?i=new e.Float(t.getValue()):this.type===g.Int32?i=new e.Int32(t.getValue()):this.type===g.Int64?i=new e.Int64(t.getValue()):this.type===g.Double?i=new e.Double(t.getValue()):this.type===g.String?i=new e.BrsString(t.toString()):this.type===g.IntArray||this.type===g.ColorArray?i=new e.RoArray([new e.Int32(t.getValue()).box()]):this.type===g.FloatArray?i=new e.RoArray([new e.Float(t.getValue()).box()]):this.type===g.TimeArray&&(i=new e.RoArray([new e.Double(t.getValue()).box()])),i}convertRect2D(i){const s={x:0,y:0,width:0,height:0};if(i instanceof e.RoArray){const e=t(i);Array.isArray(e)&&4===e.length&&e.every(e=>"number"==typeof e)&&(s.x=e[0],s.y=e[1],s.width=e[2],s.height=e[3])}else if(i instanceof e.RoAssociativeArray){const e=a(i);"number"==typeof e.x&&"number"==typeof e.y&&"number"==typeof e.width&&"number"==typeof e.height&&(s.x=e.x,s.y=e.y,s.width=e.width,s.height=e.height)}return r(s)}isEqual(t,i){return(0,e.isAnyNumber)(t)&&(0,e.isAnyNumber)(i)||(0,e.isBrsString)(t)&&(0,e.isBrsString)(i)?t.getValue()===i.getValue():(0,e.isBrsBoolean)(t)&&(0,e.isBrsBoolean)(i)?t.toBoolean()===i.toBoolean():t instanceof S&&i instanceof S?t===i&&!i.changed:t instanceof e.BrsComponent&&i instanceof e.BrsComponent&&t===i||t.equalTo(i).toBoolean()}executeCallbacks(t){if(t.running)return;const{interpreter:i,callable:s,hostNode:n,environment:a,eventParams:o}=t;let l;if(o.infoFields){const t=new Map;if(o.infoFields.elements?.length)for(const i of o.infoFields.elements)if((0,e.isBrsString)(i)){const e=i.getValue();t.set(e,n.getValue(e))}l=r(t)}const h=new y(o.node,o.fieldName,this.value,l);s instanceof e.RoMessagePort?s.pushMessage(h):i.inSubEnv(i=>{t.running=!0,i.environment.hostNode=n,i.environment.setRootM(n.m);try{const t=s.getFirstSatisfiedSignature([h]);if(t){let{signature:s,impl:n}=t;i.environment.define(e.Scope.Function,s.args[0].name.text,h),n(i,h)}else s.getFirstSatisfiedSignature([])?.impl(i)}catch(i){if(!(i instanceof e.BlockEnd))throw t.running=!1,i}return t.running=!1,e.BrsInvalid.Instance},a)}}class S extends f{nodeSubtype;fields;aliases;componentDef;funcNames=new Set;children;triedInitFocus=!1;notified=!1;parent;address;owner;changed=!1;rectLocal={x:0,y:0,width:0,height:0};rectToParent={x:0,y:0,width:0,height:0};rectToScene={x:0,y:0,width:0,height:0};defaultFields=[{name:"id",type:g.String},{name:"focusable",type:g.Boolean},{name:"focusedChild",type:g.Node,alwaysNotify:!0},{name:"change",type:g.AssocArray}];constructor(t=[],i=$.Node){super([],i),this.nodeSubtype=i,this.address=(0,e.genHexAddress)(),this.fields=new Map,this.aliases=new Map,this.children=[],this.parent=e.BrsInvalid.Instance,this.owner=F.taskId,this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t),this.setValueSilent("change",r({Index1:0,Index2:0,Operation:"none"})),this.componentDef=F.nodeDefMap.get(this.nodeSubtype.toLowerCase()),this.funcNames=new Set(Object.keys(this.componentDef?.functions??{}).map(e=>e.toLowerCase()))}toString(e){const t=`${this.getComponentName()}:${this.nodeSubtype}`;if(e)return`<Component: ${t}>`;const i=[],s=[];for(const[e,t]of this.fields.entries()){if(t.isHidden())continue;const n=this.aliases.get(e),a=n?n.aliasName:t.getName();!t.isSystem()||this.aliases.has(e)?s.push({name:a,field:t}):i.push({name:a,field:t})}return s.sort((e,t)=>e.name.toLowerCase().localeCompare(t.name.toLowerCase())),[`<Component: ${t}> =`,"{",...[...i,...s].map(({name:e,field:t})=>`    ${e}: ${t.toString(this)}`),"}"].join("\n")}getElements(){const t=[];for(const[e,i]of this.fields.entries()){const s=this.aliases.get(e),n=s?s.aliasName:i.getName();n&&t.push(n)}return t.toSorted((e,t)=>e.toLowerCase().localeCompare(t.toLowerCase())).map(t=>new e.BrsString(t))}getValues(){return Array.from(this.fields.values()).sort().map(e=>e.getValue())}getNodeFields(){return this.fields}getNodeFieldsAsAA(){const t=[];for(const[i,s]of this.fields.entries()){if(s.isHidden())continue;const n=this.aliases.get(i),a=n?n.aliasName:s.getName();a&&t.push({name:new e.BrsString(a),value:s.getValue()})}return new e.RoAssociativeArray(t)}getNodeFieldTypes(){const t=[];for(const[i,s]of this.fields.entries()){if(s.isHidden())continue;const n=this.aliases.get(i),a=n?n.aliasName:s.getName();a&&t.push({name:new e.BrsString(a),value:new e.BrsString(s.getType())})}return new e.RoAssociativeArray(t)}hasNodeField(e){return this.fields.has(e.toLowerCase())}canAcceptValue(e,t){const i=this.fields.get(e.toLowerCase());return!!i?.canAcceptValue(t)}clearNodeFields(){for(const[e,t]of this.fields)this.removeFieldEntry(e)}getNodeChildren(){return this.children}get(t){if(!(0,e.isBrsString)(t))throw new Error("Node indexes must be strings");const i=this.fields.get(t.getValue().toLowerCase());if(i){const t=i.getValue();return t instanceof e.RoAssociativeArray||t instanceof e.RoArray?t.deepCopy():(0,e.isUnboxable)(t)?t.copy():t}return this.getMethod(t.getValue())||e.BrsInvalid.Instance}getValue(t){const i=this.fields.get(t.toLowerCase());return i?i.getValue():e.BrsInvalid.Instance}getValueJS(e){const i=this.fields.get(e.toLowerCase());return i?t(i.getValue()):void 0}setValue(t,i,s,n){const a=t.toLowerCase(),r=n??g.fromBrsType(i),o=this.aliases.get(a);let l=this.fields.get(a);l&&l.getType()!==g.String&&(0,e.isBrsString)(i)&&(i=Je(l.getType(),i.getValue()));let h="";if(l)if(o){const e=this.findNodeById(this,o.nodeId);e instanceof S?(e.setValue(o.fieldName,i,s),this.makeDirty()):h=`BRIGHTSCRIPT: ERROR: roSGNode.Set: "${t}": Alias "${o.nodeId}.${o.fieldName}" not found!`}else l.canAcceptValue(i)?(this.notified=l.setValue(i,!0),this.fields.set(a,l),this.makeDirty()):(0,e.isInvalid)(i)||(h=`BRIGHTSCRIPT: ERROR: roSGNode.AddReplace: "${t}": Type mismatch!`);else r&&void 0!==s?(l=new w(t,i,r,s),this.fields.set(a,l),this.notified=!0,this.makeDirty()):h=`BRIGHTSCRIPT: ERROR: roSGNode.Set: Tried to set nonexistent field "${t}" of a "${this.nodeSubtype}" node:`;h.length>0&&e.BrsDevice.stderr.write(`warning,${h} ${this.location}`)}setValueSilent(e,t,i){const s=e.toLowerCase();let n=this.fields.get(s);if(n)n.setValue(t,!1),void 0!==i&&n.setHidden(i);else{const s=g.fromBrsType(t);s&&(n=new w(e,t,s,!1,!1,i??!1))}n&&(this.fields.set(s,n),this.makeDirty())}getId(){return this.getValueJS("id")??this.nodeSubtype}cloneNode(t,i,s){if(s??=new WeakMap,s.has(this))return s.get(this);const n=Re(this.nodeSubtype);if(!(n instanceof f))return e.BrsInvalid.Instance;s.set(this,n);for(const[t,s]of this.fields){if(this.aliases.has(t)&&i){const s=Ue.get(this.nodeSubtype)??"Node";return e.BrsDevice.stderr.write(`warning,BRIGHTSCRIPT: ERROR: roSGNode.Clone: No such field ${s}::${t}: ${i?.formatLocation()??""}`),e.BrsInvalid.Instance}let a=s.getValue(!1);a instanceof f&&(a=a.deepCopy());const r=new w(s.getName(),a,s.getType(),s.isAlwaysNotify(),s.isSystem(),s.isHidden());n.fields.set(t,r)}if(t)for(const t of this.children){let a=e.BrsInvalid.Instance;t instanceof f&&(a=t.cloneNode(!0,i,s)),n.appendChildToParent(a)}return n}deepCopy(t){t??=new WeakMap;const i=Re(this.nodeSubtype);if(!(i instanceof S))return new e.RoInvalid;i.address=this.address,t.set(this,i);for(const[e,s]of this.fields){let n=s,a=s.getValue(!1);a instanceof S&&(a=t.has(a)?t.get(a):a.deepCopy(t),n=new w(s.getName(),a,s.getType(),s.isAlwaysNotify(),s.isSystem(),s.isHidden())),i.fields.set(e,n)}for(const s of this.children){let n=e.BrsInvalid.Instance;s instanceof S&&(n=t.has(s)?t.get(s):s.deepCopy(t)),i.appendChildToParent(n)}return i}moveObjectIntoField(t,i){const s=this.fields.get(t.toLowerCase());if(void 0===s)return{code:-1,msg:`Could not find field '"${t}"'`};if(s.getType()!==g.AssocArray)return{code:-1,msg:"Field has wrong field type"};const n=[];for(const[t,s]of i.elements)s instanceof e.RoArray||s instanceof e.RoAssociativeArray||s instanceof f?n.push({name:new e.BrsString(t),value:s.deepCopy()}):!(0,e.isBoxable)(s)||s instanceof e.Callable?!(0,e.isUnboxable)(s)||s instanceof e.RoFunction||n.push({name:new e.BrsString(t),value:s.copy()}):n.push({name:new e.BrsString(t),value:s});const a=i.clearElements();return s.setValue(new e.RoAssociativeArray(n),!0),this.makeDirty(),{code:a}}moveObjectFromField(t){const i=this.fields.get(t.toLowerCase());if(void 0===i)return`Could not find field '"${t}"'`;if(i.getType()!==g.AssocArray)return"cannot moveFromField on non-assocarray fields";const s=i.getValue();return i.setValue(e.BrsInvalid.Instance,!0),this.makeDirty(),s}addNodeField(t,i,s){let n=Je(i),a=g.fromString(i);n===e.Uninitialized.Instance||this.fields.has(t.toLowerCase())||(this.setValue(t,n,s,a),this.makeDirty())}addNodeFieldAlias(e,t,i,s){this.fields.set(e.toLowerCase(),t),this.aliases.set(e.toLowerCase(),{nodeId:i,fieldName:s,aliasName:e})}appendNodeFields(t){if(t instanceof e.RoAssociativeArray)for(const[e,i]of t.elements)this.setValueSilent(e,i);else if(t instanceof S)for(const[e,i]of t.getNodeFields())this.fields.set(e,i),this.makeDirty()}setNodeFields(e,t){for(const[i,s]of e.elements)(t||!t&&this.fields.has(i.toLowerCase()))&&(this.setValue(i,s,!1),this.makeDirty())}updateFields(t,i,s){i instanceof e.RoAssociativeArray?this.populateNodeFromAA(t,this,i,s,this.nodeSubtype):i instanceof e.RoArray&&this.updateChildrenFromArray(t,this,i,s,this.nodeSubtype)}setFieldByRef(e,t){const i=this.fields.get(e.toLowerCase());return i?i.getType()===g.AssocArray?(i.setValue(t,!1,!0),1):0:-1}canGetFieldByRef(e){const t=this.fields.get(e.toLowerCase());return!!t&&t.getType()===g.AssocArray&&t.isValueRef()}getFieldByRef(t){const i=this.fields.get(t.toLowerCase());if(void 0===i)return`Could not find field '"${t}"'`;if(i.getType()===g.AssocArray&&i.isValueRef()){const t=i.getValue();if(t instanceof e.RoAssociativeArray)return t}return""}getNodeParent(){return this.parent}setNodeParent(e){this.parent=e}removeParent(){this.parent=e.BrsInvalid.Instance}isChildrenFocused(){if(0===this.children.length)return!1;for(const e of this.children)if(e instanceof S&&(F.focused===e||e.isChildrenFocused()))return!0;return!1}isFocusable(){return this.getValueJS("focusable")??!1}renderNode(e,t,i,s,n){this.renderChildren(e,t,i,s,n)}renderChildren(e,t,i,s,n){for(const a of this.children)a instanceof S&&a.renderNode(e,t,i,s,n);this.changed=!1}getBoundingRect(e,t){switch(this.createPath(this)[0].renderNode(e,[0,0],0,1),t){case"local":return this.rectLocal;case"toScene":return this.rectToScene;default:return this.rectToParent}}addObserver(t,i,s,n,a){let r=e.BrsBoolean.False;const o=s.getValue(),l=this.fields.get(o.toLowerCase());if(l instanceof w){let h=e.BrsInvalid.Instance;if(t.environment.hostNode){if(n instanceof e.BrsString)h=t.getCallableFunction(n.getValue());else if(n instanceof e.RoMessagePort){const e=t.environment.hostNode;n.registerCallback(e.nodeSubtype,e.getNewEvents.bind(e)),h=n}}else{const i=t.formatLocation();e.BrsDevice.stderr.write(`warning,BRIGHTSCRIPT: ERROR: roSGNode.ObserveField: "${this.nodeSubtype}.${o}" no active host node: ${i}`)}h instanceof e.BrsInvalid||(s=this.aliases.has(o.toLowerCase())?new e.BrsString(this.aliases.get(o.toLowerCase()).fieldName):new e.BrsString(l.getName()),l.addObserver(i,t,h,this,s,a),r=e.BrsBoolean.True)}return r}removeObserver(e,t){const i=this.fields.get(e.toLowerCase());i instanceof w&&(t instanceof f?i.removeScopedObservers(t):i.removeUnscopedObservers())}setNodeFocus(t,i){const s="focusedchild";if(i){if(!this.triedInitFocus&&(this.triedInitFocus=!0,this.componentDef?.initialFocus)){const e=this.findNodeById(this,this.componentDef.initialFocus);if(e instanceof S)return e.setNodeFocus(t,!0),this.isFocusable()}if(!this.isFocusable()&&this.isChildrenFocused())return!1;F.setFocused(this);let i=this.createPath(this);if(F.focused instanceof S){let t=this.createPath(F.focused),n=0;for(;n<i.length&&n<t.length&&t[n]===i[n];)n++;for(let i=n;i<t.length;i++)t[i].setValue(s,e.BrsInvalid.Instance,!1)}for(let e=0;e<i.length-1;e++)i[e].setValue(s,i[e+1],!1);this.setValue(s,this,!1)}else if(F.focused===this){const t=F.focused;F.setFocused();let i=this.createPath(t);for(const t of i)t.setValue(s,e.BrsInvalid.Instance,!1)}else this.setValue(s,e.BrsInvalid.Instance,!1);return this.isFocusable()}findNodeById(t,i){const s=t.getValue("id");if(s?.toString().toLowerCase()===i.toLowerCase())return t;for(const e of t.children){if(!(e instanceof S))continue;const t=this.findNodeById(e,i);if(t instanceof S)return t}return e.BrsInvalid.Instance}getBitmap(e){const t=this.getValueJS(e);return this.loadBitmap(t)}loadBitmap(t){if(t.trim())return F.scene?.subSearch&&F.scene?.subReplace&&(t=t.replace(F.scene.subSearch,F.scene.subReplace)),(0,e.getTextureManager)().loadTexture(t,this.httpAgent.customHeaders)}getIconSize(e){let t=0,i=0;for(const s of e){const e=this.getBitmap(s);e&&(t=Math.max(t,e.width),i=Math.max(i,e.height))}return[t,i]}copyField(e,t,i){const s=this.getValue(i??t);return e.setValue(t,s),s}linkField(e,t,i){const s=e.fields.get(t.toLowerCase());return s&&this.fields.set((i??t).toLowerCase(),s),s}removeFieldEntry(e){const t=e.toLowerCase(),i=this.fields.get(t);if(!i||i.isSystem()&&!this.aliases.has(t))return!1;i.clearObservers();const s=this.fields.delete(t),n=this.aliases.delete(t),a=s||n;return a&&this.makeDirty(),a}updateChildrenFromArray(i,s,n,a,r){const o=n.getElements();for(const n of o)if(n instanceof e.RoAssociativeArray){const o=t(n.get(new e.BrsString("subtype")))??r,l=Re(o,i);l instanceof f&&(this.populateNodeFromAA(i,l,n,a,o),s.appendChildToParent(l))}else if(n instanceof f)s.appendChildToParent(n);else{const t=i.formatLocation();e.BrsDevice.stderr.write(`warning,Warning calling update() on ${this.nodeSubtype} object expected to be convertible to Node is ${e.ValueKind.toString(n.kind)}: ${t}`)}}populateNodeFromAA(t,i,s,n,a){for(const[r,o]of s.getValue()){const s=r.toLowerCase();if("children"===s&&o instanceof e.RoArray)this.updateChildrenFromArray(t,i,o,n,a),this.makeDirty();else{if("subtype"===s)continue;(i.fields.has(s)||n&&!(0,e.isInvalid)(o))&&(i.setValue(r,o,!1),this.makeDirty())}}}getNewEvents(e,t){return new Array}removeChildByReference(e){if(e instanceof S){const t=this.children.indexOf(e);if(t>=0)return e.removeParent(),this.children.splice(t,1),this.recordChildChange("remove",t),this.makeDirty(),!0}return!1}removeChildrenAtIndex(e,t){if(t>0&&e>=0&&e<this.children.length){const i=this.children.splice(e,t);for(const e of i.filter(e=>e instanceof S))e.removeParent();return i.length>0&&this.recordChildChange("remove",e,e+i.length-1),this.makeDirty(),!0}return!1}appendChildToParent(e){if(e instanceof S){if(this.children.includes(e))return!0;const t=this.children.length;return this.children.push(e),e.setNodeParent(this),this.makeDirty(),this.recordChildChange("add",t),!0}return!1}replaceChildAtIndex(e,t){if(t<0||t>=this.children.length)return!1;const i=this.children.indexOf(e);i>=0&&(this.children.splice(i,1),i<t&&(t-=1)),0===this.children.length?t=0:t>=this.children.length&&(t=this.children.length-1);const s=this.children[t];return s instanceof S&&s.removeParent(),e.setNodeParent(this),this.children.splice(t,1,e),this.makeDirty(),this.recordChildChange("set",t),!0}insertChildAtIndex(e,t){if(!(e instanceof S))return!1;const i=this.children.length;(t<0||t>i)&&(t=i);const s=this.children.indexOf(e);return s>=0?(s===t||(this.children.splice(s,1),this.recordChildChange("remove",s,s),s<t&&(t-=1),this.children.splice(t,0,e),this.makeDirty(),this.recordChildChange("insert",t,t)),!0):(e.setNodeParent(this),this.children.splice(t,0,e),this.makeDirty(),this.recordChildChange("insert",t),!0)}recordChildChange(e,t,i){const s=this.fields.get("change");if(!(s instanceof w&&s.isObserved()))return;const n=Math.max(0,Math.trunc(t)),a=Math.max(0,Math.trunc(i??t));s.setValue(r({Index1:n,Index2:a,Operation:e}),!0)}createPath(e,t=!0){let i=[e];for(;e.parent instanceof S;)i.push(e.parent),e=e.parent;return t?i.reverse():i}findRootNode(e){let t=e??this;for(;t.parent instanceof S;)t=t.parent;return t}callFunction(t,i,...s){const n=i.getValue();return this.componentDef&&this.funcNames.has(n.toLowerCase())?t.inSubEnv(i=>{let a=i.getCallableFunction(n);if(!(a instanceof e.Callable))return e.BrsDevice.stderr.write(`warning,Ignoring attempt to call non-implemented function ${n}`),e.BrsInvalid.Instance;i.environment.setM(this.m),i.environment.setRootM(this.m),i.environment.hostNode=this;try{let r=a.getFirstSatisfiedSignature(s);const o=r?s:[];if(r??=a.getFirstSatisfiedSignature([]),r){const e=a.getLocation()??t.location;t.addToStack({functionName:n,functionLocation:e,callLocation:e,signature:r.signature});const s=a.call(i,...o);return t.stack.pop(),s}return t.addError((0,e.generateArgumentMismatchError)(a,s,t.stack.at(-1)?.functionLocation))}catch(t){if(!(t instanceof e.Stmt.ReturnValue))throw t;return t.value??e.BrsInvalid.Instance}},this.componentDef.environment):(e.BrsDevice.stderr.write(`warning,Warning calling function in ${this.nodeSubtype}: no function interface specified for ${n}`),e.BrsInvalid.Instance)}setExtendsType(e,t){const i=e.toLowerCase();Ue.has(i)||i===t.toLowerCase()||Ue.set(i,t)}registerDefaultFields(e){for(const t of e){const e=Je(t.type,t.value),i=g.fromString(t.type);i&&this.fields.set(t.name.toLowerCase(),new w(t.name,e,i,!!t.alwaysNotify,!0,t.hidden))}}registerInitializedFields(e){for(const t of e){const e=g.fromBrsType(t.value);if(e){const i=t.name.value;this.fields.set(i.toLowerCase(),new w(i,t.value,e,!1))}}}compareNodes(e){return this.nodeSubtype===e.nodeSubtype&&this.address===e.address}makeDirty(){this.changed=!0,F.makeDirty()}sendThreadUpdate(e,i,s,n,a=!1){const r={id:e,type:i,field:s,value:n instanceof S?d(n,a):t(n)};F.inTaskThread()&&n instanceof S&&(n.changed=!1),postMessage(r)}getThreadInfo(){return r({currentThread:F.getCurrentThread(),node:{address:this.address,id:this.getId(),type:this.nodeSubtype,owningThread:F.getThreadInfo(this.owner),willRendezvousFromCurrentThread:this.owner===F.taskId?"No":"Yes"},renderThread:F.getRenderThread()})}}class v extends S{name;constructor(e=[],t=$.Node){super([],t),this.name=t,this.registerInitializedFields(e)}setValue(e,t,i=!1,s,n=!0){const a=e.toLowerCase();super.setValue(e,t,i,s),n&&F.tasks.length>0&&this.changed&&this.fields.has(a)&&(this.sendThreadUpdate(F.taskId,"global",a,t),F.inTaskThread()&&(this.changed=!1))}}class b{_mGlobal;_nodeDefMap;_scene;_focused;_taskId;_threads;_tasks;_timers;_animations;_sfx;_audio;_video;_dirty=!1;get mGlobal(){return this._mGlobal??=new v([]),this._mGlobal}get nodeDefMap(){return this._nodeDefMap}get scene(){return this._scene}get focused(){return this._focused}get sfx(){return this._sfx}get tasks(){return this._tasks}get timers(){return this._timers}get animations(){return this._animations}get audio(){return this._audio}get video(){return this._video}get taskId(){return this._taskId}get isDirty(){return this._dirty}audioFlags=-1;audioIndex=-1;audioDuration=-1;audioPosition=-1;videoEvent=-1;videoIndex=-1;videoProgress=-1;videoDuration=-1;videoPosition=-1;constructor(){this._nodeDefMap=new Map,this._sfx=[],this._tasks=[],this._timers=[],this._animations=[],this._threads=new Map,this._taskId=0,this._threads.set(this._taskId,{id:(0,e.genHexAddress)(),type:"Render"})}setNodeDefMap(e){this._nodeDefMap=e}setScene(e){this._scene=e}setFocused(e){this._focused=e}setThread(t,i=!1,s){this._threads.set(t,{id:s??(0,e.genHexAddress)(),type:t>0?"Task":"Render"}),i&&(this._taskId=t)}processTasks(){let e=!1;for(const t of this._tasks)e=t.updateTask(),t.active&&t.checkTask();return e}processTimers(){let e=!1;for(const t of this._timers)t.active&&t.checkFire()&&(e=!0);return e}processAnimations(){let e=!1;for(const t of this._animations)t.tick()&&(e=!0);return e}setAudio(t){this._audio=t,this.audioFlags=-1,this.audioIndex=-1,this.audioDuration=-1,this.audioPosition=-1,Atomics.store(e.BrsDevice.sharedArray,e.DataType.SND,-1),Atomics.store(e.BrsDevice.sharedArray,e.DataType.SDX,-1),Atomics.store(e.BrsDevice.sharedArray,e.DataType.SDR,-1),Atomics.store(e.BrsDevice.sharedArray,e.DataType.SPS,-1)}processAudio(){if(!this._audio)return!1;let t=!1;const i=Atomics.load(e.BrsDevice.sharedArray,e.DataType.SND);i!==this.audioFlags&&(this.audioFlags=i,this._audio.setState(i),t=!0);const s=Atomics.load(e.BrsDevice.sharedArray,e.DataType.SDX);s!==this.audioIndex&&(this.audioIndex=s,this._audio.setContentIndex(s),t=!0);const n=Atomics.load(e.BrsDevice.sharedArray,e.DataType.SDR);n!==this.audioDuration&&(this.audioDuration=n,this._audio.setDuration(n),t=!0);const a=Atomics.load(e.BrsDevice.sharedArray,e.DataType.SPS);return a!==this.audioPosition&&(this.audioPosition=a,this._audio.setPosition(a),t=!0),t}setVideo(t){this._video=t,this.videoEvent=-1,this.videoIndex=-1,this.videoProgress=-1,this.videoDuration=-1,this.videoPosition=-1,Atomics.store(e.BrsDevice.sharedArray,e.DataType.VDO,-1),Atomics.store(e.BrsDevice.sharedArray,e.DataType.VDX,-1),Atomics.store(e.BrsDevice.sharedArray,e.DataType.VSE,-1),Atomics.store(e.BrsDevice.sharedArray,e.DataType.VDR,-1),Atomics.store(e.BrsDevice.sharedArray,e.DataType.VPS,-1),Atomics.store(e.BrsDevice.sharedArray,e.DataType.VAT,-1),Atomics.store(e.BrsDevice.sharedArray,e.DataType.VTT,-1)}processVideo(){if(!this._video)return!1;let t=!1;const i=Atomics.load(e.BrsDevice.sharedArray,e.DataType.VLP);this.videoProgress!==i&&i>=0&&i<=1e3&&this._video.setState(e.MediaEvent.Loading,Math.trunc(i/10)),this.videoProgress=i;const s=Atomics.load(e.BrsDevice.sharedArray,e.DataType.VDO),n=Atomics.load(e.BrsDevice.sharedArray,e.DataType.VDX);s!==this.videoEvent&&(this.videoEvent=s,s>=0&&(this._video.setState(s,n),Atomics.store(e.BrsDevice.sharedArray,e.DataType.VDO,-1),t=!0));const a=Atomics.load(e.BrsDevice.sharedArray,e.DataType.VSE);a!==this.videoIndex&&(this.videoIndex=a,a>=0&&(this._video.setContentIndex(a),Atomics.store(e.BrsDevice.sharedArray,e.DataType.VSE,-1),t=!0));const r=Atomics.load(e.BrsDevice.sharedArray,e.DataType.VDR);r!==this.videoDuration&&(this.videoDuration=r,this._video.setDuration(r),t=!0);const o=Atomics.load(e.BrsDevice.sharedArray,e.DataType.VPS);if(o!==this.videoPosition&&(this.videoPosition=o,this._video.setPosition(o),t=!0),Atomics.load(e.BrsDevice.sharedArray,e.DataType.BUF)===e.BufferType.MEDIA_TRACKS){const i=e.BrsDevice.readDataBuffer();let s=[],n=[];try{const e=JSON.parse(i);s=e.audio??[],n=e.text??[]}catch(e){s=[],n=[]}this._video.setAudioTracks(s),this._video.setSubtitleTracks(n),t=!0}const l=Atomics.load(e.BrsDevice.sharedArray,e.DataType.VAT);l>-1&&(this._video.setCurrentAudioTrack(l),Atomics.store(e.BrsDevice.sharedArray,e.DataType.VAT,-1),t=!0);const h=Atomics.load(e.BrsDevice.sharedArray,e.DataType.VTT);return h>-1&&(this._video.setCurrentSubtitleTrack(h),Atomics.store(e.BrsDevice.sharedArray,e.DataType.VTT,-1),t=!0),t}processSFX(){let t=!1;for(let i=0;i<this._sfx.length;i++){const s=this._sfx[i];if(!s)continue;const n=Atomics.load(e.BrsDevice.sharedArray,e.DataType.WAV+i);n>=0&&n===s.getAudioId()&&"playing"!==s.getState()?(s.setState(e.MediaEvent.StartPlay),t=!0):"stopped"!==s.getState()&&(s.setState(e.MediaEvent.Finished),this._sfx[i]=void 0,t=!0)}return t}inTaskThread(){return this.taskId>0}getThreadInfo(e){const t=this._threads.get(e);if(0===e&&0===this._taskId)t.name=this.scene?.nodeSubtype;else if(e>0){const i=this.tasks.find(t=>t.id===e);t.name=i?.name}return t}getCurrentThread(){return this.getThreadInfo(this._taskId)}getRenderThread(){return this.getThreadInfo(0)}makeDirty(){this._dirty=!0}clearDirty(){this._dirty=!1}}const F=new b;function B(e){return Number.isFinite(e.x)&&Number.isFinite(e.y)&&Number.isFinite(e.width)&&Number.isFinite(e.height)}function V(e,t,i){const s=void 0===i?0:i[0],n=void 0===i?0:i[1],a=Math.cos(-t),r=Math.sin(-t),o=[{x:-s,y:-n},{x:e.width-s,y:-n},{x:e.width-s,y:e.height-n},{x:-s,y:e.height-n}].map(e=>({x:e.x*a-e.y*r,y:e.x*r+e.y*a})),l=Math.min(...o.map(e=>e.x)),h=Math.max(...o.map(e=>e.x)),d=Math.min(...o.map(e=>e.y)),u=Math.max(...o.map(e=>e.y));return{x:e.x+l+s,y:e.y+d+n,width:h-l,height:u-d}}function C(e,t){const i=Math.cos(-t),s=Math.sin(-t);return[e[0]*i-e[1]*s,e[0]*s+e[1]*i]}function x(e,t){if(!B(e))return{...t};if(!B(t))return{...e};const i=Math.min(e.x,t.x),s=Math.min(e.y,t.y);return{x:i,y:s,width:Math.max(e.x+e.width,t.x+t.width)-i,height:Math.max(e.y+e.height,t.y+t.height)-s}}function I(e){let t=-1;return(e=e.trim()).length&&(6===(e=(e=(e=(e=e.startsWith("#")?e.slice(1):e).toLowerCase().startsWith("0x")?e.slice(2):e).toLowerCase().startsWith("&h")?e.slice(2):e).padStart(6,"0")).length&&(e+="FF"),t=Number.parseInt(e,16),t=Number.isNaN(t)?-1:0|t),t}class T extends S{name;defaultFields=[{name:"visible",type:"boolean",value:"true"},{name:"opacity",type:"float",value:"1.0"},{name:"translation",type:"vector2d",value:"[0.0,0.0]"},{name:"rotation",type:"float",value:"0.0"},{name:"scale",type:"vector2d",value:"[1.0,1.0]"},{name:"scaleRotateCenter",type:"vector2d",value:"[0.0,0.0]"},{name:"childRenderOrder",type:"string",value:"renderLast"},{name:"inheritParentTransform",type:"boolean",value:"true"},{name:"inheritParentOpacity",type:"boolean",value:"true"},{name:"clippingRect",type:"rect2d",value:"[0.0,0.0,0.0,0.0]"},{name:"renderPass",type:"integer",value:"0"},{name:"muteAudioGuide",type:"boolean",value:"false"},{name:"enableRenderTracking",type:"boolean",value:"false"},{name:"renderTracking",type:"string",value:"disabled"}];sceneRect;resolution;cachedLines=[];cachedHeight=0;isDirty;constructor(e=[],t=$.Group){super([],t),this.name=t,this.setExtendsType(t,$.Node),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(e);const i=F.scene?.ui;i?(this.resolution=i.resolution,this.sceneRect={x:0,y:0,width:i.width,height:i.height}):(this.resolution="HD",this.sceneRect={x:0,y:0,width:1280,height:720}),this.isDirty=!0}setValue(t,i,s=!1,n){const a=t.toLowerCase(),r=this.fields.get(a);if(r?.getType()===g.Font&&(0,e.isBrsString)(i)){const t=i.getValue(),s=Re("Font");i=t.startsWith("font:")&&s.setSystemFont(t.slice(5).toLowerCase())?s:e.BrsInvalid.Instance}else if(r?.getType()===g.Color&&(0,e.isBrsString)(i)){let t=i.getValue();if(!t.length)return;i=new e.Int32(I(t))}this.isDirty=!0,super.setValue(t,i,s,n)}setValueSilent(e,t){this.isDirty=!0,super.setValueSilent(e,t)}getDimensions(){return{width:this.getValueJS("width")??0,height:this.getValueJS("height")??0}}isVisible(){return this.getValueJS("visible")??!0}addPoster(t,i,s,n){const a=Re("Poster");return t&&a.setValue("uri",new e.BrsString(t)),a.setTranslation(i),void 0!==s&&a.setValueSilent("width",new e.Float(s)),void 0!==n&&a.setValueSilent("height",new e.Float(n)),this.appendChildToParent(a),a}addLabel(t,i,s,n,a,r,o,l){const h=Re("Label");if(t&&this.copyField(h,"color",t),a){const e=h.getNodeFields(),t=e.get("font")?.getValue();void 0!==t&&(d=t)instanceof S&&"function"==typeof d.setSize&&"function"==typeof d.setSystemFont&&t.setSize(a)}var d;return void 0!==s&&h.setValueSilent("width",new e.Float(s)),void 0!==n&&h.setValueSilent("height",new e.Float(n)),h.setTranslation(i),r&&h.setValueSilent("vertalign",new e.BrsString(r)),o&&h.setValueSilent("horizalign",new e.BrsString(o)),void 0!==l&&h.setValueSilent("wrap",e.BrsBoolean.from(l)),this.appendChildToParent(h),h}addScrollingLabel(t,i,s,n,a,r,o,l,h){const d=Re("ScrollingLabel");if(t&&this.copyField(d,"color",t),a){const t=d.getValue("font");t&&t.kind===e.ValueKind.Object&&"setSystemFont"in t&&t.setSystemFont(a)}return void 0!==s&&d.setValueSilent("maxWidth",new e.Float(s)),void 0!==n&&d.setValueSilent("height",new e.Float(n)),d.setTranslation(i),r&&d.setValueSilent("vertalign",new e.BrsString(r)),o&&d.setValueSilent("horizalign",new e.BrsString(o)),void 0!==l&&d.setValueSilent("scrollSpeed",new e.Int32(l)),void 0!==h&&d.setValueSilent("repeatCount",new e.Int32(h)),this.appendChildToParent(d),d}addRectangle(t,i,s,n){const a=Re("Rectangle");return this.copyField(a,"color",t),void 0!==s&&a.setValueSilent("width",new e.Float(s)),void 0!==n&&a.setValueSilent("height",new e.Float(n)),a.setTranslation(i),this.appendChildToParent(a),a}getTranslation(){const e=this.getValueJS("translation"),t=this.getValueJS("scale"),i=this.getScaleRotateCenter(),s=i[0]*(t[0]-1),n=i[1]*(t[1]-1);return e[0]-=s,e[1]-=n,e}setTranslation(t){if(2===t.length){const i=[new e.Float(t[0]),new e.Float(t[1])];this.setValue("translation",new e.RoArray(i))}}setTranslationOffset(e=0,t=0){const i=this.getValueJS("translation");i[0]+=e,i[1]+=t,this.setTranslation(i)}setTranslationX(e){const t=this.getValueJS("translation");t[0]=e,this.setTranslation(t)}setTranslationY(e){const t=this.getValueJS("translation");t[1]=e,this.setTranslation(t)}getRotation(){return this.getValueJS("rotation")??0}getScaleRotateCenter(){const i=this.getValue("scaleRotateCenter"),s=[0,0];return i instanceof e.RoArray&&2===i.elements.length&&(s[0]=t(i.elements[0]),s[1]=t(i.elements[1])),s}getOpacity(){return this.getValueJS("opacity")??1}drawText(t,i,s,n,a,r,o,l,h,d="...",u=0){const c=i.createDrawFont();if(!(c instanceof e.RoFont))return{text:t,width:0,height:0,ellipsized:!1};let g,m;if(this.isDirty||void 0===this.cachedLines[u]){if(0===a.width){const e=t.indexOf("\n");g=-1===e?t:t.substring(0,e),m=c.measureText(g)}else m=c.measureText(t,a.width,d),g=m.text;this.cachedLines[u]=m}else m=this.cachedLines[u],g=m.text;let p=a.x,f=a.y;return a.width>m.width&&("center"===r?p+=(a.width-m.width)/2:"right"===r&&(p+=a.width-m.width)),a.height>m.height&&("center"===o?f+=(a.height-m.height)/2:"bottom"===o&&(f+=a.height-m.height)),h?.doDrawRotatedText(g,p,f,s,n,c,l),m}drawTextWrap(t,i,s,n,a,r,o,l,h="...",d=0,u=0,c=0,g=!1,m){const p=i.createDrawFont();if(!(p instanceof e.RoFont))return{text:t,width:a.width,height:0,ellipsized:!1};this.changed&&this.refreshLines(t,p,a,h,d,u,c,g);let f=a.y;"center"===o?f+=(a.height-this.cachedHeight)/2:"bottom"===o&&(f+=a.height-this.cachedHeight);let y=!1;for(const e of this.cachedLines){let t=a.x;"center"===r?t+=(a.width-e.width)/2:"right"===r&&(t+=a.width-e.width),m?.doDrawRotatedText(e.text,t,f,s,n,p,l),f+=e.height+c,y=e.ellipsized}return{text:t,width:a.width,height:this.cachedHeight,ellipsized:y}}refreshLines(e,t,i,s,n,a,r,o){const l=this.breakTextIntoLines(e,t,i.width),h=t.measureTextHeight();let d=l,u=l.length*h;if(i.height>0){const e=Math.floor((i.height+r)/(h+r));d=this.checkEllipsis(l,e,t,i.width,s),u=!o&&d.length<l.length?d.length*h+(d.length>1?(d.length-1)*r:0):Math.min(u,i.height)}else if(n>0||a>0){const e=n>0?n:a;d=this.checkEllipsis(l,e,t,i.width,s),u=Math.min(u,e*h+(e>1?(e-1)*r:0))}this.cachedHeight=u,this.cachedLines=d}checkEllipsis(e,t,i,s,n){if(e.length>t){const a=e.slice(0,t);if(a.length>0){const e=a.at(-1);e.text=this.ellipsizeLine(e.text,i,s,n),e.ellipsized=!0}return a}return e}breakTextIntoLines(e,t,i){const s=[];if(0===e.length||i<=0)return s;const n=e.split(/(\s|-)/);let a=t.measureText(e);if(a.width<=i)return[a];a={text:"",width:0,height:0,ellipsized:!1};for(const e of n)if("\n"===e)s.push(a),a={text:"",width:0,height:0,ellipsized:!1};else{const n=a.text+e,r=t.measureText(n);if(r.width<=i)a=r;else if(t.measureText(e).width>i){const n=this.breakLongWord(e,t,i);for(const e of n){const n=t.measureText(a.text+e);n.width<=i?a=n:(s.push(a),a=t.measureText(e))}}else s.push(a),a=t.measureText(e)}return s.push(a),s}breakLongWord(e,t,i){const s=[];let n="";for(const a of e)t.measureTextWidth(n+a).width<=i?n+=a:(s.push(n),n=a);return s.push(n),s}ellipsizeLine(e,t,i,s){if(t.measureTextWidth(e+s).width<=i)return e+s;let n="";for(const a of e){if(!(t.measureTextWidth(n+a+s).width<=i))return n+s;n+=a}return n+s}drawImage(e,t,i,s,n,a){if(e.isValid()){if(e.scaleMode=1,"number"==typeof a&&4294967295!==a&&-1!==a||(a=void 0),(s<0||s>1)&&(s=1),e.ninePatch)return n?.drawNinePatch(e,t,a,s),t;const r=this.getValueJS("scale");let o=0===t.width?1:t.width/e.width,l=0===t.height?1:t.height/e.height;if(o*=r[0],l*=r[1],t.width=o*e.width,t.height=l*e.height,0!==i||1!==r[0]||1!==r[1]){const r=this.getScaleRotateCenter();n?.doDrawRotatedBitmap(t.x,t.y,o,l,i,e,r[0],r[1],a,s)}else n?.doDrawScaledObject(t.x,t.y,o,l,e,a,s)}return t}updateBoundingRects(e,t,i){const s=this.getTranslation();if(this.rectLocal={x:0,y:0,width:e.width,height:e.height},0===i)return this.rectToScene=e,void(this.rectToParent={x:s[0],y:s[1],width:e.width,height:e.height});const n=this.getScaleRotateCenter();this.rectToScene=V(e,i,n);const a=this.getRotation();if(0!==a&&a===i)this.rectToParent={x:this.rectToScene.x-t[0],y:this.rectToScene.y-t[1],width:this.rectToScene.width,height:this.rectToScene.height};else if(0!==a&&a!==i){const t=V({x:0,y:0,width:e.width,height:e.height},a,n);this.rectToParent={x:s[0]+t.x,y:s[1]+t.y,width:t.width,height:t.height}}else this.rectToParent={x:s[0],y:s[1],width:e.width,height:e.height}}updateParentRects(e,t){if(this.parent instanceof T){const i=this.parent;i.rectLocal=x(i.rectLocal,this.rectToParent);const s=i.getTranslation();let n=s[0]+i.rectLocal.x,a=s[1]+i.rectLocal.y,r=i.rectLocal.width,o=i.rectLocal.height;if(0!==t){const e=V({x:0,y:0,width:r,height:o},t,i.getScaleRotateCenter());n+=e.x,a+=e.y,r=e.width,o=e.height}i.rectToParent=x(i.rectToParent,{x:n,y:a,width:r,height:o}),n+=e[0]-s[0],a+=e[1]-s[1],i.rectToScene=x(i.rectToScene,{x:n,y:a,width:r,height:o})}}handleKey(e,t){return!1}renderNode(e,t,i,s,n){if(!this.isVisible())return;const a=this.getTranslation(),r=a.slice();r[0]+=t[0],r[1]+=t[1];const o=i+this.getRotation();this.rectLocal={x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY,width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY},this.rectToScene={x:r[0],y:r[1],width:0,height:0},this.rectToParent={x:a[0],y:a[1],width:0,height:0},s*=this.getOpacity(),this.renderChildren(e,r,o,s,n),this.updateContainerBounds(a,r),this.updateParentRects(t,i),this.isDirty=!1}updateContainerBounds(e,t){if(!Number.isFinite(this.rectLocal.x))return;const i=this.rectLocal;this.rectToParent={x:e[0]+i.x,y:e[1]+i.y,width:i.width,height:i.height},this.rectToScene={x:t[0]+i.x,y:t[1]+i.y,width:i.width,height:i.height}}}class k extends S{name;defaultFields=[{name:"actors",type:"array",hidden:!0},{name:"actor",type:"string",hidden:!0},{name:"adaptiveMaxStartBitrate",type:"integer",hidden:!0},{name:"adaptiveMinStartBitrate",type:"integer",hidden:!0},{name:"album",type:"string",hidden:!0},{name:"appData",type:"string",value:"",hidden:!0},{name:"artist",type:"string",hidden:!0},{name:"audioFormat",type:"string",hidden:!0},{name:"audioLanguageSelected",type:"string",hidden:!0},{name:"audioPIDPref",type:"integer",hidden:!0},{name:"bookmarkPosition",type:"integer",hidden:!0},{name:"categories",type:"array",hidden:!0},{name:"category",type:"string",hidden:!0},{name:"cdnConfig",type:"array",hidden:!0},{name:"clipEnd",type:"float",hidden:!0},{name:"clipStart",type:"float",hidden:!0},{name:"closedCaptions",type:"boolean",hidden:!0},{name:"color",type:"string",hidden:!0},{name:"compositionMode",type:"string",hidden:!0},{name:"contentType",type:"string",hidden:!0},{name:"description",type:"string",hidden:!0},{name:"directors",type:"array",hidden:!0},{name:"director",type:"string",hidden:!0},{name:"encodingKey",type:"string",hidden:!0},{name:"encodingType",type:"string",hidden:!0},{name:"episodeNumber",type:"string",hidden:!0},{name:"fhdBifUrl",type:"string",hidden:!0},{name:"fhdPosterUrl",type:"string",hidden:!0},{name:"filterCodecProfiles",type:"boolean",hidden:!0},{name:"forwardQueryStringParams",type:"boolean",hidden:!0},{name:"frameRate",type:"integer",hidden:!0},{name:"fullHD",type:"boolean",hidden:!0},{name:"hdBackgroundImageUrl",type:"string",hidden:!0},{name:"hdBifUrl",type:"string",hidden:!0},{name:"hdBranded",type:"boolean",hidden:!0},{name:"hdGridPosterUrl",type:"string",hidden:!0},{name:"hdListItemIconSelectedUrl",type:"string",hidden:!0},{name:"hdListItemIconUrl",type:"string",hidden:!0},{name:"hdPosterUrl",type:"string",hidden:!0},{name:"hideIcon",type:"boolean",hidden:!0},{name:"httpCertificatesFile",type:"string",hidden:!0},{name:"httpCookies",type:"array",hidden:!0},{name:"httpHeaders",type:"array",hidden:!0},{name:"httpSendClientCertificate",type:"boolean",hidden:!0},{name:"ignoreStreamErrors",type:"boolean",hidden:!0},{name:"isHD",type:"boolean",hidden:!0},{name:"keySystem",type:"string",value:"",hidden:!0},{name:"length",type:"integer",hidden:!0},{name:"licenseRenewURL",type:"string",value:"",hidden:!0},{name:"licenseServerURL",type:"string",value:"",hidden:!0},{name:"live",type:"boolean",hidden:!0},{name:"liveBoundsPauseBehavior",type:"string",hidden:!0},{name:"maxBandwidth",type:"integer",hidden:!0},{name:"minBandwidth",type:"integer",hidden:!0},{name:"numEpisodes",type:"integer",hidden:!0},{name:"playDuration",type:"integer",hidden:!0},{name:"playStart",type:"integer",hidden:!0},{name:"preferredAudioCodec",type:"string",hidden:!0},{name:"rating",type:"string",hidden:!0},{name:"releaseDate",type:"string",hidden:!0},{name:"sdBackgroundImageUrl",type:"string",hidden:!0},{name:"sdBifUrl",type:"string",hidden:!0},{name:"sdGridPosterUrl",type:"string",hidden:!0},{name:"sdListItemIconSelectedUrl",type:"string",hidden:!0},{name:"sdListItemIconUrl",type:"string",hidden:!0},{name:"sdPosterUrl",type:"string",hidden:!0},{name:"serializationURL",type:"string",value:"",hidden:!0},{name:"serviceCert",type:"string",value:"",hidden:!0},{name:"shortDescriptionLine1",type:"string",hidden:!0},{name:"shortDescriptionLine2",type:"string",hidden:!0},{name:"sourceRect",type:"assocarray",hidden:!0},{name:"starRating",type:"integer",hidden:!0},{name:"stream",type:"assocarray",hidden:!0},{name:"streamBitrates",type:"array",hidden:!0},{name:"streamContentIDs",type:"array",hidden:!0},{name:"streamFormat",type:"string",hidden:!0},{name:"streamQualities",type:"array",hidden:!0},{name:"streams",type:"assocarray",hidden:!0},{name:"streamStartTimeOffset",type:"integer",hidden:!0},{name:"streamStickyHttpRedirects",type:"array",hidden:!0},{name:"streamUrls",type:"array",hidden:!0},{name:"subtitleColor",type:"string",hidden:!0},{name:"subtitleConfig",type:"assocarray",hidden:!0},{name:"subtitleTracks",type:"assocarray",hidden:!0},{name:"subtitleUrl",type:"string",hidden:!0},{name:"switchingStrategy",type:"string",hidden:!0},{name:"targetRect",type:"assocarray",hidden:!0},{name:"targetRotation",type:"float",hidden:!0},{name:"targetTranslation",type:"assocarray",hidden:!0},{name:"text",type:"string",hidden:!0},{name:"textAttrs",type:"assocarray",hidden:!0},{name:"textOverlayBody",type:"string",hidden:!0},{name:"textOverlayUL",type:"string",hidden:!0},{name:"textOverlayUR",type:"string",hidden:!0},{name:"title",type:"string",hidden:!0},{name:"titleSeason",type:"string",hidden:!0},{name:"trackIDAudio",type:"string",hidden:!0},{name:"trackIDSubtitle",type:"string",hidden:!0},{name:"trackIDVideo",type:"string",hidden:!0},{name:"url",type:"string",hidden:!0},{name:"userStarRating",type:"integer",hidden:!0},{name:"videoDisableUI",type:"boolean",hidden:!0},{name:"watched",type:"boolean",hidden:!0}];metaDataFields=new Set(this.defaultFields.map(e=>e.name.toLowerCase()));parentFields=new Set;constructor(e=$.ContentNode){super([],e),this.name=e,this.setExtendsType(e,$.Node),this.registerDefaultFields(this.defaultFields),this.appendMethods([this.count,this.keys,this.items,this.hasField])}getVisibleFields(){let e=this.getNodeFields();return Array.from(e).filter(([e,t])=>!t.isHidden())}setValue(e,t,i=!1,s){if(this.notified=!1,super.setValue(e,t,i,s),this.parentFields.size&&this.notified)for(const e of this.parentFields)e.notifyObservers()}appendChildToParent(t){let i=!1,s=!1,n=null;return t instanceof k?(i=!0,this.children.includes(t)||(n=this.children.length,this.children.push(t),t.setNodeParent(this),s=!0)):(t instanceof S||t===e.BrsInvalid.Instance)&&(i=!0,n=this.children.length,this.children.push(e.BrsInvalid.Instance),s=!0),this.changed||=i,s&&null!==n&&this.recordChildChange("add",n),i}addParentField(e){this.parentFields.add(e)}removeParentField(e){this.parentFields.delete(e)}getElements(){return this.getVisibleFields().map(([e,t])=>e).sort().map(t=>new e.BrsString(t))}getValues(){return this.getVisibleFields().map(([e,t])=>t).sort().map(e=>e.getValue())}count=new e.Callable("count",{signature:{args:[],returns:e.ValueKind.Int32},impl:t=>new e.Int32(this.getVisibleFields().length)});keys=new e.Callable("keys",{signature:{args:[],returns:e.ValueKind.Object},impl:t=>new e.RoArray(this.getElements())});items=new e.Callable("items",{signature:{args:[],returns:e.ValueKind.Object},impl:t=>new e.RoArray(this.getElements().map(e=>r({key:e,value:this.get(e)})))});hasField=new e.Callable("hasField",{signature:{args:[new e.StdlibArgument("fieldname",e.ValueKind.String)],returns:e.ValueKind.Boolean},impl:(t,i)=>{let s=this.getNodeFields().get(i.value.toLowerCase());return s?(s.setHidden(!1),e.BrsBoolean.True):e.BrsBoolean.False}})}class R extends T{name;defaultFields=[{name:"content",type:"node"},{name:"itemSize",type:"vector2d",value:"[0,0]"},{name:"itemSpacing",type:"vector2d",value:"[0,0]"},{name:"numRows",type:"integer",value:"0"},{name:"numColumns",type:"integer",value:"0"},{name:"focusRow",type:"integer",value:"0",alwaysNotify:!0},{name:"focusColumn",type:"integer",value:"0",alwaysNotify:!0},{name:"horizFocusAnimationStyle",type:"string",value:"floatingFocus"},{name:"vertFocusAnimationStyle",type:"string",value:"floatingFocus"},{name:"drawFocusFeedbackOnTop",type:"boolean",value:"false"},{name:"drawFocusFeedback",type:"boolean",value:"true"},{name:"fadeFocusFeedbackWhenAutoScrolling",type:"boolean",value:"false"},{name:"currFocusFeedbackOpacity",type:"float",value:"0"},{name:"focusBitmapUri",type:"string",value:""},{name:"focusFootprintBitmapUri",type:"string",value:""},{name:"focusBitmapBlendColor",type:"color",value:"0xFFFFFFFF"},{name:"focusFootprintBlendColor",type:"color",value:"0xFFFFFFFF"},{name:"wrapDividerBitmapUri",type:"string",value:""},{name:"wrapDividerWidth",type:"float",value:"0"},{name:"wrapDividerHeight",type:"float",value:"36"},{name:"fixedLayout",type:"boolean",value:"false"},{name:"numRenderPasses",type:"integer",value:"1"},{name:"rowHeights",type:"floatarray",value:"[]"},{name:"columnWidths",type:"floatarray",value:"[]"},{name:"rowSpacings",type:"floatarray",value:"[]"},{name:"columnSpacings",type:"array",value:"[]"},{name:"sectionDividerBitmapUri",type:"string",value:""},{name:"sectionDividerFont",type:"font",value:"font:SmallestSystemFont"},{name:"sectionDividerTextColor",type:"color",value:"0xddddddff"},{name:"sectionDividerSpacing",type:"float",value:"0.0"},{name:"sectionDividerWidth",type:"float",value:"0.0"},{name:"sectionDividerHeight",type:"float",value:"40"},{name:"sectionDividerMinWidth",type:"float",value:"0.0"},{name:"sectionDividerLeftOffset",type:"float",value:"0.0"},{name:"itemClippingRect",type:"rect2d",value:"[0.0,0.0,0.0,0.0]"},{name:"itemSelected",type:"integer",value:"-1",alwaysNotify:!0},{name:"itemFocused",type:"integer",value:"-1",alwaysNotify:!0},{name:"itemUnfocused",type:"integer",value:"-1",alwaysNotify:!0},{name:"jumpToItem",type:"integer",value:"-1",alwaysNotify:!0},{name:"animateToItem",type:"integer",value:"-1",alwaysNotify:!0},{name:"currFocusRow",type:"float",value:"0.0"},{name:"currFocusColumn",type:"float",value:"0.0"},{name:"currFocusSection",type:"float",value:"0.0"}];dividerUri="common:/images/dividerHorizontal.9.png";content=[];metadata=[];itemComps=[];marginX;marginY;gap;lineHeight;focusIndex=0;numRows=0;numCols=0;currRow=0;topRow=0;wrap=!1;lastPressHandled;hasNinePatch;focusField;constructor(t=[],i=$.ArrayGrid){super([],i),this.name=i,this.setExtendsType(i,$.Group),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t),this.setValueSilent("content",new k),"FHD"===this.resolution?(this.marginX=36,this.marginY=6,this.lineHeight=4.5,this.setValueSilent("wrapDividerHeight",new e.Float(36)),this.setValueSilent("sectionDividerHeight",new e.Float(60)),this.setValueSilent("sectionDividerMinWidth",new e.Float(126)),this.setValueSilent("sectionDividerSpacing",new e.Float(15))):(this.marginX=24,this.marginY=4,this.lineHeight=3,this.setValueSilent("wrapDividerHeight",new e.Float(24)),this.setValueSilent("sectionDividerHeight",new e.Float(40)),this.setValueSilent("sectionDividerMinWidth",new e.Float(117)),this.setValueSilent("sectionDividerSpacing",new e.Float(10))),this.gap=this.marginX/2,this.setValueSilent("focusable",e.BrsBoolean.True),this.setValueSilent("wrapDividerBitmapUri",new e.BrsString(this.dividerUri)),this.setValueSilent("sectionDividerBitmapUri",new e.BrsString(this.dividerUri));const s=this.getValueJS("vertFocusAnimationStyle");this.wrap="fixedfocuswrap"===s.toLowerCase(),this.lastPressHandled="",this.hasNinePatch=!1,this.focusField="listHasFocus"}setValue(i,s,n=!1,a){const r=i.toLowerCase();if("content"===r&&s instanceof k)return super.setValue(i,s,n,a),this.itemComps.length=0,this.refreshContent(),void(this.content.length>0&&this.setFocusedItem(0));if(["jumptoitem","animatetoitem"].includes(r)&&(0,e.isBrsNumber)(s))this.setFocusedItem(t(s));else if("numrows"===r&&(0,e.isBrsNumber)(s))this.numRows=t(s);else if("numcolumns"===r&&(0,e.isBrsNumber)(s))this.numCols=t(s);else if("vertfocusanimationstyle"===r&&(0,e.isBrsString)(s)){const e=s.toString().toLowerCase();if(!["fixedfocuswrap","floatingfocus","fixedfocus"].includes(e))return;this.wrap="fixedfocuswrap"===e}else if("horizfocusanimationstyle"===r&&(0,e.isBrsString)(s)&&!["fixedfocuswrap","floatingfocus"].includes(s.toString().toLowerCase()))return;super.setValue(i,s,n,a),["vertfocusanimationstyle","numrows","focusrow"].includes(r)&&(this.currRow=this.updateCurrRow())}setFocusedItem(t){const i=this.findContentIndex(t);if(-1===i)return;const s=this.getValueJS("itemFocused"),n=F.focused===this;this.updateItemFocus(this.focusIndex,!1,n),super.setValue("itemUnfocused",new e.Int32(s)),this.focusIndex=i,this.updateItemFocus(this.focusIndex,!0,n),super.setValue("itemFocused",new e.Int32(t))}findContentIndex(e){return e<0||e>=this.content.length?-1:this.metadata.length>0?this.metadata.findIndex(t=>t.index===e):e}updateItemFocus(t,i,s){const n=this.itemComps[t];n&&(n.setValue("itemHasFocus",e.BrsBoolean.from(i)),n.setValue(this.focusField,e.BrsBoolean.from(s)),n.setValue("focusPercent",new e.Float(i?1:0)))}handleKey(e,t){if(!t&&this.lastPressHandled===e)return this.lastPressHandled="",!0;let i=!1;return"up"===e||"down"===e?i=!!t&&this.handleUpDown(e):"left"===e||"right"===e?i=!!t&&this.handleLeftRight(e):"rewind"===e||"fastforward"===e?i=!!t&&this.handlePageUpDown(e):"OK"===e&&(i=this.handleOK(t)),this.lastPressHandled=i&&"OK"!==e?e:"",i}handleUpDown(e){return!1}handleLeftRight(e){return!1}handlePageUpDown(e){return!1}handleOK(t){if(t){const t=this.metadata[this.focusIndex]?.index??this.focusIndex;this.setValue("itemSelected",new e.Int32(t))}return!1}getContentItem(e){return this.content[e]instanceof k?this.content[e]:new k}getContentChildren(e){return e.getNodeChildren().map(e=>e instanceof k?e:new k)}renderNode(e,t,i,s,n){if(!this.isVisible())return;const a=this.getTranslation(),r=0===i?a.slice():C(a,i);r[0]+=t[0],r[1]+=t[1];const o=this.getDimensions(),l={x:r[0],y:r[1],...o},h=i+this.getRotation();s*=this.getOpacity();const d=this.getValue("content");d instanceof k&&d.changed&&(this.refreshContent(),d.changed=!1),this.renderContent(e,l,h,s,n),this.updateBoundingRects(l,t,h),this.renderChildren(e,r,h,s,n),this.updateParentRects(t,i),this.isDirty=!1}renderContent(e,t,i,s,n){}renderItemComponent(e,t,i,s,n,a){const r=this.getContentItem(t),o=F.focused===this,l=t===this.focusIndex;if(!this.itemComps[t]){const s=this.createItemComponent(e,i,r);s instanceof T&&(this.itemComps[t]=s)}r.changed&&(this.itemComps[t].setValue("itemContent",r,!0),r.changed=!1),this.updateItemFocus(t,l,o);const h=this.getValueJS("drawFocusFeedback"),d=this.getValueJS("drawFocusFeedbackOnTop");l&&h&&!d&&this.renderFocus(i,n,o,a);const u=[i.x,i.y];this.itemComps[t].renderNode(e,u,s,n,a),l&&h&&d&&this.renderFocus(i,n,o,a)}renderFocus(e,t,i,s){const n=i?"focusBitmapUri":"focusFootprintBitmapUri",a=this.getBitmap(n);if(!a?.isValid())return;this.hasNinePatch=a.ninePatch;let r=a.ninePatch?{x:e.x-this.marginX,y:e.y-this.marginY,width:e.width+2*this.marginX,height:e.height+2*this.marginY}:e;this.drawImage(a,r,0,t,s)}renderSectionDivider(e,t,i,s,n){const a=this.getValueJS("sectionDividerHeight"),r=this.getValueJS("sectionDividerSpacing"),o={...t,height:a};let l=0;if(0!==e.length){const t=this.getValue("sectionDividerFont"),a=this.getValueJS("sectionDividerTextColor");l=this.drawText(e,t,a,i,o,"left","center",0,n,"...",s).width+r}const h=this.getBitmap("sectionDividerBitmapUri");if(h?.isValid()){const e=h.ninePatch?this.lineHeight:h.height,t={x:o.x+l,y:o.y+Math.round((a-e)/2),width:o.width-l,height:e};this.drawImage(h,t,0,i,n)}return a}renderWrapDivider(e,t,i){const s=this.getBitmap("wrapDividerBitmapUri"),n=this.getValueJS("wrapDividerHeight");if(s?.isValid()){const a=s.ninePatch?this.lineHeight:s.height,r=Math.round((n-a)/2),o={...e,y:e.y+r,height:a};this.drawImage(s,o,0,t,i)}return n}refreshContent(){this.content.length=0,this.metadata.length=0;const e=this.getValue("content");if(!(e instanceof k))return;const t=this.getContentChildren(e);let i=0;for(const e of t)"section"===e.getValueJS("ContentType")?.toLowerCase()&&(i=this.processSection(e,i));0===this.content.length&&t.length>0&&this.content.push(...t)}processSection(e,t){const i=this.getContentChildren(e),s=this.numCols||1;if(0===i.length)return t;for(const[s,n]of i.entries()){const i={index:t,divider:!1,sectionTitle:""};0===s&&(i.divider=!0,i.sectionTitle=e.getValueJS("title")??""),this.metadata.push(i),t++}this.content.push(...i);const n=i.length%s;if(n>0){const e=new k("_placeholder_"),t={index:-1,divider:!1,sectionTitle:""};for(let i=0;i<s-n;i++)this.content.push(e),this.metadata.push(t)}return t}createItemComponent(e,t,i){if("_placeholder_"===i.name)return new T;const s=Re(this.getValueJS("itemComponentName")??"",e);return s instanceof T&&(s.setNodeParent(this),s.setValue("width",n(t.width)),s.setValue("height",n(t.height)),s.setValue("itemContent",i)),s}updateCurrRow(){const e=this.numCols||1,t=this.getValueJS("focusRow");if(!this.wrap){const i=Math.floor(this.focusIndex/e),s=this.getValueJS("numRows");if(i>=0&&i<s)return i;const n=Math.min(this.currRow,s-1),a=Math.max(0,n),r=Math.max(a,t);return Math.min(r,i)}return t}updateListCurrRow(){if(this.wrap)return this.topRow=0,this.updateCurrRow();const e=this.numCols||1;if(e<=0)return this.topRow=0,0;const t=Math.ceil(this.content.length/e);if(t<=0)return this.topRow=0,0;const i=Number.isFinite(this.numRows)&&this.numRows>0?Math.floor(this.numRows):t,s=Math.max(1,Math.min(i,t));let n=Math.floor(this.focusIndex/e);n=Math.max(0,Math.min(n,t-1)),n<this.topRow?this.topRow=n:n>this.topRow+(s-1)&&(this.topRow=n-(s-1));const a=Math.max(0,t-s);return this.topRow=Math.max(0,Math.min(this.topRow,a)),Math.max(0,n-this.topRow)}clampTopRow(){const e=this.numCols||1;if(e<=0)return void(this.topRow=0);const t=Math.ceil(this.content.length/e);if(t<=0)return void(this.topRow=0);const i=Number.isFinite(this.numRows)&&this.numRows>0?Math.floor(this.numRows):t,s=Math.max(1,Math.min(i,t)),n=Math.max(0,t-s);this.topRow=Math.max(0,Math.min(this.topRow,n))}updateRect(e,t,i){const s=this.numCols||1;e.x=e.x-(this.hasNinePatch?this.marginX:0),e.y=e.y-(this.hasNinePatch?this.marginY:0),e.width=s*(i[0]+(this.hasNinePatch?2*this.marginX:0)),e.height=t*(i[1]+(this.hasNinePatch?2*this.marginY:0))}getIndex(e=0,t){t=t??this.focusIndex;const i=this.numCols||1,s=Math.floor(t/i),n=Math.ceil(this.content.length/i);let a=s+e;return this.wrap?a=(a+n)%n:a>=n?a=n-1:a<0&&(a=0),a*i}resolveBoolean(e,t,i){return Array.isArray(e)&&0!==e.length?t<e.length?Boolean(e[t]):Boolean(e.at(-1)):i}resolveVector(e,t,i){if(!Array.isArray(e)||0===e.length)return i;if(2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1])return[Number(e[0])||0,Number(e[1])||0];const s=t<e.length?e[t]:e.at(-1);return Array.isArray(s)&&s.length>=2?[Number(s[0])||0,Number(s[1])||0]:i}resolveNumber(e,t,i){if(!Array.isArray(e)||0===e.length)return i;if(t<e.length){const s=Number(e[t]);return Number.isFinite(s)&&s>0?s:i}const s=Number(e.at(-1));return Number.isFinite(s)&&s>0?s:i}resolveColor(e,t,i){return Array.isArray(e)&&0!==e.length?t<e.length?Number(e[t])||i:Number(e.at(-1))||i:i}}class D extends S{name;defaultFields=[{name:"content",type:"node"},{name:"contentIsPlaylist",type:"boolean",value:"false"},{name:"nextContentIndex",type:"integer",value:"-1"},{name:"loop",type:"boolean",value:"false"},{name:"bufferingStatus",type:"assocarray"},{name:"control",type:"string",value:"none",alwaysNotify:!0},{name:"notificationInterval",type:"time",value:"0.5"},{name:"seek",type:"time"},{name:"contentIndex",type:"integer",value:"-1",alwaysNotify:!0},{name:"state",type:"string",value:"none",alwaysNotify:!0},{name:"position",type:"time",value:"0",alwaysNotify:!0},{name:"duration",type:"time",value:"0",alwaysNotify:!0},{name:"errorCode",type:"integer",value:"0"},{name:"errorMsg",type:"string",value:""},{name:"audioFormat",type:"string",value:""},{name:"autoplayAfterSeek",type:"boolean",value:"true"},{name:"mute",type:"boolean",value:"false"},{name:"streamInfo",type:"assocarray"},{name:"timeToStartStreaming",type:"time",value:"0"}];constructor(e=[],t=$.Audio){super([],t),this.name=t,this.setExtendsType(t,$.Node),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(e),F.inTaskThread()||(postMessage({audioPlaylist:new Array}),postMessage("audio,loop,false"),postMessage("audio,next,-1"),postMessage("audio,mute,false"),F.setAudio(this))}setValue(i,s,n=!1,a){const r=i.toLowerCase();if("control"===r&&(0,e.isBrsString)(s)){const t=["start","play","pause","resume","stop"],i=s.getValue().toLowerCase();t.includes(i)?(this.checkContentChanged(),F.inTaskThread()||postMessage(`audio,${i}`)):s=new e.BrsString("none")}else if("seek"===r&&(0,e.isBrsNumber)(s)){this.checkContentChanged();const e=t(s);F.inTaskThread()||postMessage("audio,seek,"+1e3*e)}else if("notificationInterval"===r&&(0,e.isBrsNumber)(s))F.inTaskThread()||postMessage(`audio,notify,${Math.round(1e3*t(s))}`);else if("loop"===r&&(0,e.isBrsBoolean)(s))F.inTaskThread()||postMessage(`audio,loop,${s.toBoolean()}`);else if("mute"===r&&(0,e.isBrsBoolean)(s))F.inTaskThread()||postMessage(`audio,mute,${s.toBoolean()}`);else if(r==="contentIsPlaylist".toLowerCase()&&(0,e.isBrsBoolean)(s)){const e=this.getValueJS("contentIsPlaylist"),t=s.toBoolean(),i=this.getValue("content");e!==t&&i instanceof k&&(F.inTaskThread()||postMessage({audioPlaylist:this.formatContent(i)}))}else"content"===r&&s instanceof k&&(F.inTaskThread()||postMessage({audioPlaylist:this.formatContent(s)}));super.setValue(i,s,n,a)}setState(t){let i="none";switch(t){case e.MediaEvent.Loading:i="buffering";break;case e.MediaEvent.StartPlay:case e.MediaEvent.StartStream:case e.MediaEvent.Selected:case e.MediaEvent.Resumed:i="playing";break;case e.MediaEvent.Paused:i="paused";break;case e.MediaEvent.Full:i="finished";break;case e.MediaEvent.Failed:i="failed"}super.setValue("state",new e.BrsString(i))}setContentIndex(t){super.setValue("contentIndex",new e.Int32(t))}setDuration(t){super.setValue("duration",new e.Double(Math.round(t/1e3)))}setPosition(t){super.setValue("position",new e.Double(t/1e3))}checkContentChanged(){const e=this.getValue("content");e instanceof k&&e.changed&&(F.inTaskThread()||postMessage({audioPlaylist:this.formatContent(e)}),e.changed=!1)}formatContent(t){const i=new Array;if(this.getValueJS("contentIsPlaylist")){const s=t.getNodeChildren().filter(e=>e instanceof S);for(const t of s){const s=t.getValueJS("url");s?.length&&s.startsWith("http")?i.push(e.BrsDevice.getCORSProxy(s)):s?.length&&i.push(s)}}else{const s=t.getValueJS("url");s?.length&&s.startsWith("http")?i.push(e.BrsDevice.getCORSProxy(s)):s?.length&&i.push(s)}return i}}class A extends T{name;defaultFields=[{name:"uri",type:"uri"},{name:"width",type:"float",value:"0.0"},{name:"height",type:"float",value:"0.0"},{name:"loadSync",type:"boolean",value:"false"},{name:"loadWidth",type:"float",value:"0.0"},{name:"loadHeight",type:"float",value:"0.0"},{name:"loadDisplayMode",type:"string",value:"noScale"},{name:"loadStatus",type:"string",value:"none"},{name:"bitmapWidth",type:"float",value:"0.0"},{name:"bitmapHeight",type:"float",value:"0.0"},{name:"bitmapMargins",type:"assocarray"},{name:"blendColor",type:"color",value:"0xFFFFFFFF"},{name:"loadingBitmapUri",type:"uri"},{name:"loadingBitmapOpacity",type:"float",value:"1.0"},{name:"failedBitmapUri",type:"uri"},{name:"failedBitmapOpacity",type:"float",value:"1.0"},{name:"audioGuideText",type:"string"}];uri="";bitmap;noScaling=!1;constructor(e=[],t=$.Poster){super([],t),this.name=t,this.setExtendsType(t,$.Group),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(e)}setValue(i,s,a=!1,r){if("uri"===i.toLowerCase()){const i=t(s);if("string"==typeof i&&""!==i.trim()&&this.uri!==i){this.uri=i;const t=this.loadUri(i),s=F.scene?.subSearch??"";if("ready"===t)this.noScaling=""!==s&&i.includes(s);else{const e=this.getValueJS("failedBitmapUri");this.loadUri(e),this.noScaling=""!==s&&e.includes(s)}super.setValue("loadStatus",new e.BrsString(t))}else if("string"!=typeof i||""===i.trim()){this.uri="",this.bitmap=void 0,super.setValue("loadStatus",new e.BrsString("none")),super.setValue("bitmapWidth",new e.Float(0)),super.setValue("bitmapHeight",new e.Float(0));const t={left:0,right:0,top:0,bottom:0};super.setValue("bitmapMargins",n(t))}}super.setValue(i,s,a,r)}renderNode(t,i,s,n,a){if(!this.isVisible())return;const r=this.getTranslation(),o=0===s?r.slice():C(r,s);o[0]+=i[0],o[1]+=i[1];const l=this.getDimensions(),h=this.getValueJS("loadStatus"),d={x:o[0],y:o[1],width:l.width,height:l.height};"ready"===h&&!this.noScaling&&(d.width<=0||d.height<=0)&&this.updateRect(d);const u=s+this.getRotation(),c=this.getValueJS("loadDisplayMode");if(n*=this.getOpacity(),this.bitmap instanceof e.RoBitmap&&this.bitmap.isValid()){let e=this.getValueJS("blendColor"),t=n;"failed"===h&&(e=4294967295,t=n*this.getValueJS("loadingBitmapOpacity")),this.bitmap.scaleMode=1,"scaletofit"===c.trim().toLowerCase()?this.drawImage(this.bitmap,this.scaleToFit(d),u,t,a,e):"scaletozoom"===c.trim().toLowerCase()?a?.doDrawCroppedBitmap(this.bitmap,this.scaleToZoom(d),d,e,t):this.drawImage(this.bitmap,d,u,t,a,e)}this.updateBoundingRects(d,i,u),this.renderChildren(t,o,u,n,a),this.updateParentRects(i,s)}updateRect(t){const i=this.bitmap?.height??0,s=this.bitmap?.width??0;this.resolution===e.BrsDevice.getDisplayMode()?(t.height=t.height<=0?i:t.height,t.width=t.width<=0?s:t.width):"FHD"===this.resolution?(t.height=t.height<=0?1.5*i:t.height,t.width=t.width<=0?1.5*s:t.width):(t.height=t.height<=0?i/1.5:t.height,t.width=t.width<=0?s/1.5:t.width)}loadUri(t){let i="failed";if(this.bitmap=this.loadBitmap(t),this.bitmap?.isValid()){const t={left:0,right:0,top:0,bottom:0};if(this.bitmap.ninePatch){const e=this.bitmap.getPatchSizes();t.left=e.horizontal,t.right=e.horizontal,t.top=e.vertical,t.bottom=e.vertical}else{const t=this.getValueJS("loadWidth"),i=this.getValueJS("loadHeight");t>0&&i>0&&(this.bitmap=(0,e.getTextureManager)().resizeTexture(this.bitmap,t,i))}super.setValue("bitmapWidth",new e.Float(this.bitmap.width)),super.setValue("bitmapHeight",new e.Float(this.bitmap.height)),super.setValue("bitmapMargins",n(t)),i="ready"}return i}scaleToFit(e){const t=this.bitmap.width/this.bitmap.height,i=e.width/e.height,s={...e};return t<i?(s.width=e.height*t,s.x+=(e.width-s.width)/2):(s.height=e.width/t,s.y+=(e.height-s.height)/2),s}scaleToZoom(e){const t=e.width/this.bitmap.width,i=e.height/this.bitmap.height,s=Math.max(t,i),n=e.width/s,a=e.height/s;return{x:(this.bitmap.width-n)/2,y:(this.bitmap.height-a)/2,width:n,height:a}}}class N extends T{name;defaultFields=[{name:"poster",type:"node"},{name:"control",type:"string",value:"none"},{name:"clockwise",type:"boolean",value:"true"},{name:"spinInterval",type:"float",value:"2.0"}];poster;active=!0;lastRenderTime=0;currentRotation=0;constructor(e=[],t=$.BusySpinner){super([],t),this.name=t,this.setExtendsType(t,$.Group),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(e),this.poster=this.addPoster(`common:/images/${this.resolution}/spinner.png`,[0,0]),this.poster.noScaling=!0,this.setValueSilent("poster",this.poster)}setValue(t,i,s=!1,n){const a=t.toLowerCase();if("control"===a){let t=i.toString();"start"===t?(this.active=!0,this.lastRenderTime=Date.now()):"stop"===t?this.active=!1:i=new e.BrsString("none")}else if("poster"===a){if(!(i instanceof A))return;this.removeChildByReference(this.poster),this.appendChildToParent(i),this.poster=i}super.setValue(t,i,s,n)}setBlendColor(t){t instanceof e.BrsString&&this.poster.setValue("blendColor",t)}renderNode(t,i,s,n,a){if(!this.isVisible())return;const r=this.getTranslation(),o=0===s?r.slice():C(r,s);o[0]+=i[0],o[1]+=i[1];const l=this.getDimensions(),h={x:o[0],y:o[1],width:l.width,height:l.height},d=s+this.getRotation();n*=this.getOpacity();const u=this.poster.getBitmap("uri");if(u?.isValid()&&(this.poster.setValueSilent("scaleRotateCenter",new e.RoArray([new e.Float(u.width/2),new e.Float(u.height/2)])),l.width!==u.width&&(h.width=u.width,this.setValueSilent("width",new e.Float(u.width))),l.height!==u.height&&(h.height=u.height,this.setValueSilent("height",new e.Float(u.height))),this.active)){0===this.lastRenderTime&&(this.lastRenderTime=Date.now());const t=Date.now(),i=this.getValueJS("spinInterval"),s=this.getValueJS("clockwise")?-1:1,n=(t-this.lastRenderTime)/1e3,a=2*Math.PI*n/(i??2);this.currentRotation+=s*a;const r=this.currentRotation+d;this.poster.setValue("rotation",new e.Float(r)),this.lastRenderTime=t}this.updateBoundingRects(h,i,d),this.renderChildren(t,o,d,n,a),this.updateParentRects(i,s)}}class L extends T{name;defaultFields=[{name:"text",type:"string",value:""},{name:"textColor",type:"color",value:"0xddddddff"},{name:"focusedTextColor",type:"color",value:"0x262626ff"},{name:"textFont",type:"font"},{name:"focusedTextFont",type:"font",value:"font:MediumBoldSystemFont"},{name:"focusBitmapUri",type:"uri",value:""},{name:"focusFootprintBitmapUri",type:"uri",value:""},{name:"iconUri",type:"uri",value:""},{name:"focusedIconUri",type:"uri",value:""},{name:"minWidth",type:"float",value:"250"},{name:"maxWidth",type:"float",value:"32767"},{name:"height",type:"float",value:"64"},{name:"showFocusFootprint",type:"boolean",value:"false"},{name:"buttonSelected",type:"boolean",value:"false",alwaysNotify:!0}];static focusUri="common:/images/focus_list.9.png";static footprintUri="common:/images/focus_footprint.9.png";static iconUriHD="common:/images/HD/icon_generic.png";static iconUriFHD="common:/images/FHD/icon_generic.png";background;textLabel;icon;margin;gap;width;iconWidth;iconHeight;labelWidth;iconSize=[0,0];constructor(t=[],i=$.Button){if(super([],i),this.name=i,this.setExtendsType(i,$.Group),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t),"FHD"===this.resolution){this.margin=36,this.gap=18,this.width=375,this.iconWidth=36,this.iconHeight=36,this.labelWidth=this.width-2*this.margin-this.iconWidth-this.gap,this.setValueSilent("height",new e.Float(96)),this.setValueSilent("minWidth",new e.Float(375)),this.setValueSilent("iconUri",new e.BrsString(L.iconUriFHD)),this.setValueSilent("focusedIconUri",new e.BrsString(L.iconUriFHD)),this.background=this.addPoster("",[0,0],this.width,96),this.icon=this.addPoster(L.iconUriFHD,[this.margin,30],this.iconWidth,this.iconHeight);const t=[this.margin+this.iconWidth+this.gap,30];this.textLabel=this.addLabel("textColor",t,this.labelWidth,void 0,void 0,"center","right")}else{this.margin=24,this.gap=12,this.width=250,this.iconWidth=24,this.iconHeight=24,this.labelWidth=this.width-2*this.margin-this.iconWidth-this.gap,this.setValueSilent("height",new e.Float(64)),this.setValueSilent("minWidth",new e.Float(250)),this.setValueSilent("iconUri",new e.BrsString(L.iconUriHD)),this.setValueSilent("focusedIconUri",new e.BrsString(L.iconUriHD)),this.background=this.addPoster("",[0,0],this.width,64),this.icon=this.addPoster(L.iconUriHD,[this.margin,20],this.iconWidth,this.iconHeight);const t=[this.margin+this.iconWidth+this.gap,20];this.textLabel=this.addLabel("textColor",t,this.labelWidth,void 0,void 0,"center","right")}this.setValueSilent("focusable",e.BrsBoolean.True),this.setValueSilent("focusBitmapUri",new e.BrsString(L.focusUri)),this.setValueSilent("focusFootprintBitmapUri",new e.BrsString(L.footprintUri))}updateChildren(t){const i=this.getValueJS("minWidth"),s=this.getValueJS("maxWidth"),n=this.getValueJS(t?"focusedIconUri":"iconUri");this.updateIconSize(n);const a=Math.max(this.iconWidth,this.iconSize[0]),r=a>0?a+this.gap:0,o=i-2*this.margin-r,l=s-2*this.margin-r,h=this.getValueJS("text"),d=this.getValue(t?"focusedTextFont":"textFont"),u=d.createDrawFont(),c=u instanceof e.RoFont?u.measureText(h,l):{width:0,height:0},g=Math.max(c.width,o);this.width=Math.max(g+2*this.margin+r,i),this.labelWidth=this.width-2*this.margin-r+1;const m=this.getValueJS("height"),p=[this.margin+r,m/2-c.height/2],f=this.getValueJS("showFocusFootprint")?"focusFootprintBitmapUri":"";if(t||f){const e=this.getValue(t?"focusBitmapUri":f);this.background.setValue("uri",e)}else this.background.setValue("uri",new e.BrsString(""));this.background.setValue("width",new e.Float(this.width)),this.background.setValue("height",new e.Float(m));const y=this.getValue(t?"focusedTextColor":"textColor");this.textLabel.setTranslation(p),this.textLabel.setValue("width",new e.Float(this.labelWidth)),this.textLabel.setValue("color",y),this.textLabel.setValue("font",d),this.textLabel.setValue("text",new e.BrsString(h));const w=[this.margin,m/2-this.iconHeight/2];this.icon.setTranslation(w),this.icon.setValue("width",new e.Float(this.iconWidth)),this.icon.setValue("height",new e.Float(this.iconHeight)),this.icon.setValue("uri",new e.BrsString(n)),this.icon.setValue("blendColor",y)}updateIconSize(e){let t=0,i=0;if(e){const s=this.loadBitmap(e);s&&(t=s.width,i=s.height)}this.iconWidth=t,this.iconHeight=i}renderNode(e,t,i,s,n){if(!this.isVisible())return;const a=F.focused===this,r=this.getTranslation(),o=0===i?r.slice():C(r,i);o[0]+=t[0],o[1]+=t[1];const l=this.getDimensions(),h={x:o[0],y:o[1],width:l.width,height:Math.max(l.height,this.iconSize[1])},d=i+this.getRotation();s*=this.getOpacity(),this.isDirty&&(this.updateChildren(a),this.isDirty=!1),this.updateBoundingRects(h,t,i),this.renderChildren(e,o,d,s,n),this.updateParentRects(t,i)}}class P extends T{name;defaultFields=[{name:"text",type:"string",value:""},{name:"color",type:"color",value:"0xddddddff"},{name:"font",type:"font"},{name:"horizAlign",type:"string",value:"left"},{name:"vertAlign",type:"string",value:"top"},{name:"width",type:"float",value:"0"},{name:"height",type:"float",value:"0"},{name:"numLines",type:"integer",value:"0"},{name:"maxLines",type:"integer",value:"0"},{name:"wrap",type:"boolean",value:"false"},{name:"lineSpacing",type:"float",value:"0"},{name:"displayPartialLines",type:"boolean",value:"false"},{name:"ellipsizeOnBoundary",type:"boolean",value:"false"},{name:"truncateOnDelimiter",type:"string"},{name:"wordBreakChars",type:"string"},{name:"ellipsisText",type:"string"},{name:"isTextEllipsized",type:"boolean",value:"false"}];measured;constructor(t=[],i=$.Label){super([],i),this.name=i,this.setExtendsType(i,$.Group),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t),"FHD"===F.scene?.ui.resolution?this.setValueSilent("lineSpacing",new e.Float(12)):this.setValueSilent("lineSpacing",new e.Float(8))}setValue(e,t,i=!1,s){const n=e.toLowerCase();["text","font","width","height","numlines","maxlines","wrap","linespacing"].includes(n)&&(this.setEllipsized(!1),this.measured=void 0);let a=!0;this.isDirty||"text"!==n||this.getValueJS("text")!==t.toString()||(a=!1),super.setValue(e,t,i,s),this.isDirty=a}getMeasured(){if(void 0===this.measured){const e=this.getDimensions();this.measured=this.renderLabel({x:0,y:0,...e},0,1)}return this.measured}renderNode(e,t,i,s,n){if(!this.isVisible())return;const a=this.getTranslation(),r=0===i?a.slice():C(a,i);r[0]+=t[0],r[1]+=t[1];const o=this.getDimensions(),l={x:r[0],y:r[1],width:o.width,height:o.height},h=i+this.getRotation();s*=this.getOpacity(),this.measured=this.renderLabel(l,h,s,n),l.width=Math.max(this.measured.width,o.width),l.height=Math.max(this.measured.height,o.height),this.updateBoundingRects(l,t,h),this.renderChildren(e,r,h,s,n),this.updateParentRects(t,i),this.isDirty=!1}renderLabel(e,t,i,s){const n=this.getValue("font"),a=this.getValueJS("color"),r=this.getValueJS("text"),o=this.getValueJS("horizAlign")||"left",l=this.getValueJS("vertAlign")||"top",h=this.getValueJS("ellipsisText")||"...",d=this.getValueJS("wrap"),u=this.getValueJS("numLines"),c=this.getValueJS("maxLines"),g=this.getValueJS("displayPartialLines"),m=this.getValueJS("lineSpacing");let p;return p=d?e.width>0?this.drawTextWrap(r,n,a,i,e,o,l,t,h,u,c,m,g,s):{text:"",width:0,height:0,ellipsized:!1}:this.drawText(r,n,a,i,e,o,l,t,s,h),this.setEllipsized(p.ellipsized),p}setEllipsized(t){this.fields.get("istextellipsized")?.setValue(e.BrsBoolean.from(t))}}class M extends T{name;defaultFields=[{name:"layoutDirection",type:"string",value:"vert"},{name:"horizAlignment",type:"string",value:"left"},{name:"vertAlignment",type:"string",value:"top"},{name:"itemSpacings",type:"array"},{name:"addItemSpacingAfterChild",type:"boolean",value:"true"}];layoutDirty=!0;metricsUsedThisPass;childSizes=new WeakMap;lastSpacingSignature="";lastChildCount=0;epsilon=.25;constructor(t=[],i=$.LayoutGroup){super([],i),this.name=i,this.setExtendsType(i,$.Group),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t),this.setValueSilent("focusable",e.BrsBoolean.True)}setValue(e,t,i=!1,s){const n=e.toLowerCase();super.setValue(e,t,i,s),this.isLayoutField(n)&&(this.layoutDirty=!0)}setValueSilent(e,t){super.setValueSilent(e,t),this.isLayoutField(e)&&(this.layoutDirty=!0)}appendChildToParent(e){const t=super.appendChildToParent(e);return t&&(this.layoutDirty=!0),t}removeChildByReference(e){const t=super.removeChildByReference(e);return t&&(this.layoutDirty=!0),t}renderNode(e,t,i,s,n){if(!this.isVisible())return;const a=this.getLayoutDirection(),r=this.getLayoutChildren(),o=this.getItemSpacingValues(),l=this.createSpacingSignature(o);l!==this.lastSpacingSignature&&(this.lastSpacingSignature=l,this.layoutDirty=!0),r.length!==this.lastChildCount&&(this.lastChildCount=r.length,this.layoutDirty=!0);const h=this.shouldAddSpacingAfterChild();this.metricsUsedThisPass=void 0,r.length&&this.layoutDirty&&(this.metricsUsedThisPass=new WeakMap,this.applyLayout(r,a,o,h,this.metricsUsedThisPass),this.layoutDirty=!1),super.renderNode(e,t,i,s,n),r.length&&this.synchronizeChildMetrics(r,a)}applyLayout(e,t,i,s,n){const a=e.map(e=>this.measureChild(e,t,n)),r="horiz"===t?this.getHorizontalPrimaryAlignment():this.getVerticalPrimaryAlignment(),o="horiz"===t?this.normalizeVertAlignment(t):this.normalizeHorizAlignment(t),l=this.calculateTotalPrimary(a,i,s);let h=this.computeStartOffset(t,l,r);const d=e.length;for(let r=0;r<d;r++){const l=e[r],u=a[r],c=this.getSpacingValue(i,r),g=this.getChildTranslation(l);let m=u.crossStart;s||(h+=c);const p=h;if("horiz"===t){if(g[0]+=p-u.primaryStart,o&&"custom"!==o){const e=this.computeCrossPosition(o,u.cross),t=e-u.crossStart;g[1]+=t,m=e}}else if(g[1]+=p-u.primaryStart,o&&"custom"!==o){const e=this.computeCrossPosition(o,u.cross),t=e-u.crossStart;g[0]+=t,m=e}this.setChildTranslation(l,g),h=p+u.primary,s&&r<d-1&&(h+=c),n&&n.set(l,{primary:u.primary,cross:u.cross,crossStart:m,primaryStart:p})}}synchronizeChildMetrics(e,t){let i=!1;for(const s of e){const e=this.measureChild(s,t),n="horiz"===t?{width:e.primary,height:e.cross}:{width:e.cross,height:e.primary},a=this.childSizes.get(s),r=this.metricsUsedThisPass?.get(s);this.childSizes.set(s,n),a&&!this.sizesClose(a,n)&&(i=!0),r&&!this.metricsClose(r,e)&&(i=!0)}i&&(this.layoutDirty=!0,this.isDirty=!0),this.metricsUsedThisPass=void 0}measureChild(e,t,i){const s=this.chooseActiveRect(e),n={primary:"horiz"===t?s.width:s.height,cross:"horiz"===t?s.height:s.width,crossStart:"horiz"===t?s.y:s.x,primaryStart:"horiz"===t?s.x:s.y};return i&&i.set(e,n),n}chooseActiveRect(e){const t=[e.rectToParent,e.rectToScene,e.rectLocal];for(const e of t)if(Number.isFinite(e.x)&&Number.isFinite(e.y)&&Number.isFinite(e.width)&&Number.isFinite(e.height)&&e.width>0&&e.height>0)return e;const i=this.getChildTranslation(e),s=e.getDimensions(),n=this.childSizes.get(e);return{x:i[0],y:i[1],width:"number"==typeof s.width&&s.width>0?s.width:n?.width??0,height:"number"==typeof s.height&&s.height>0?s.height:n?.height??0}}calculateTotalPrimary(e,t,i){let s=0;const n=e.length;for(let a=0;a<n;a++){const r=this.getSpacingValue(t,a);i||(s+=r),s+=e[a].primary,i&&a<n-1&&(s+=r)}return s}computeCrossPosition(e,t){switch(e){case"center":return-t/2;case"bottom":case"right":return-t;default:return 0}}computeStartOffset(e,t,i){if("horiz"===e)switch(i){case"center":return-t/2;case"right":return-t;default:return 0}switch(i){case"center":return-t/2;case"bottom":return-t;default:return 0}}getChildTranslation(e){const t=e.getValueJS("translation");return Array.isArray(t)&&2===t.length?[Number(t[0])||0,Number(t[1])||0]:[0,0]}setChildTranslation(e,t){const i=e.getValueJS("translation");Array.isArray(i)&&2===i.length&&this.nearlyEqual(i[0],t[0])&&this.nearlyEqual(i[1],t[1])||e.setTranslation(t)}getLayoutChildren(){const e=[];for(const t of this.children)t instanceof T&&e.push(t);return e}getLayoutDirection(){const e=this.getValueJS("layoutDirection");if("string"==typeof e){const t=e.toLowerCase();if("horiz"===t||"horizontal"===t)return"horiz";if("vert"===t||"vertical"===t)return"vert"}return"vert"}normalizeHorizAlignment(e){const t=this.getValueJS("horizAlignment");if("string"==typeof t){const i=t.toLowerCase();if("left"===i||"center"===i||"right"===i||"custom"===i)return"horiz"===e&&"custom"===i?"left":i}return"left"}normalizeVertAlignment(e){const t=this.getValueJS("vertAlignment");if("string"==typeof t){const i=t.toLowerCase();if("top"===i||"center"===i||"bottom"===i||"custom"===i)return"vert"===e&&"custom"===i?"top":i}return"top"}getHorizontalPrimaryAlignment(){const e=this.normalizeHorizAlignment("horiz");return"custom"===e?"left":e}getVerticalPrimaryAlignment(){const e=this.normalizeVertAlignment("vert");return"custom"===e?"top":e}shouldAddSpacingAfterChild(){return!1!==this.getValueJS("addItemSpacingAfterChild")}getItemSpacingValues(){const i=this.getValue("itemSpacings");return i instanceof e.RoArray?i.getElements().map(e=>{const i=t(e);return"number"==typeof i&&Number.isFinite(i)?i:0}):[]}getSpacingValue(e,t){if(!e.length)return 0;const i=e[Math.min(t,e.length-1)];return"number"==typeof i&&Number.isFinite(i)?i:0}createSpacingSignature(e){if(0===e.length)return"";const t=e.map(e=>"number"==typeof e&&Number.isFinite(e)?e.toFixed(4):"nan");return`${e.length}:${t.join("|")}`}isLayoutField(e){const t=e.toLowerCase();return"layoutdirection"===t||"horizalignment"===t||"vertalignment"===t||"itemspacings"===t||"additemspacingafterchild"===t}nearlyEqual(e,t){return Math.abs((e||0)-(t||0))<=this.epsilon}metricsClose(e,t){return this.nearlyEqual(e.primary,t.primary)&&this.nearlyEqual(e.cross,t.cross)&&this.nearlyEqual(e.crossStart,t.crossStart)&&this.nearlyEqual(e.primaryStart,t.primaryStart)}sizesClose(e,t){return this.nearlyEqual(e.width,t.width)&&this.nearlyEqual(e.height,t.height)}}class O extends M{name;defaultFields=[{name:"textColor",type:"color",value:"0xddddddff"},{name:"focusedTextColor",type:"color",value:"0x262626ff"},{name:"textFont",type:"font"},{name:"focusedTextFont",type:"font",value:"font:MediumBoldSystemFont"},{name:"focusBitmapUri",type:"uri",value:""},{name:"focusFootprintBitmapUri",type:"string",value:""},{name:"iconUri",type:"uri",value:""},{name:"focusedIconUri",type:"uri",value:""},{name:"minWidth",type:"float",value:"0.0"},{name:"maxWidth",type:"float",value:"32767"},{name:"buttonHeight",type:"float",value:"0.0"},{name:"rightJustify",type:"boolean",value:"false"},{name:"buttonSelected",type:"integer",value:"0",alwaysNotify:!0},{name:"buttonFocused",type:"integer",value:"0",alwaysNotify:!0},{name:"focusButton",type:"integer",value:"0",alwaysNotify:!0},{name:"buttons",type:"array"}];margin;gap;vertOffset;width;iconSize=[0,0];lastPressHandled;focusIndex=0;wasFocused=!1;constructor(t=[],i=$.ButtonGroup){super([],i),this.name=i,this.setExtendsType(i,$.LayoutGroup),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t),this.width=0,"FHD"===this.resolution?(this.margin=36,this.gap=18,this.vertOffset=18,this.iconSize=[36,36],this.setValueSilent("buttonHeight",new e.Float(75)),this.setValueSilent("iconUri",new e.BrsString(L.iconUriFHD)),this.setValueSilent("focusedIconUri",new e.BrsString(L.iconUriFHD))):(this.margin=24,this.gap=12,this.vertOffset=12,this.iconSize=[24,24],this.setValueSilent("buttonHeight",new e.Float(50)),this.setValueSilent("iconUri",new e.BrsString(L.iconUriHD)),this.setValueSilent("focusedIconUri",new e.BrsString(L.iconUriHD))),this.setValueSilent("focusBitmapUri",new e.BrsString(L.focusUri)),this.setValueSilent("focusFootprintBitmapUri",new e.BrsString(L.footprintUri)),this.setValueSilent("buttons",new e.RoArray([])),this.lastPressHandled=""}setValue(i,s,n=!1,a){const r=i.toLowerCase();if("focusbutton"===r){const e=this.getValueJS("buttons"),i=t(s);"number"==typeof i&&i>=0&&i<e.length&&(this.focusIndex=i,super.setValue("buttonFocused",s))}else"buttons"!==r||s instanceof e.RoArray||(s=new e.RoArray([]));super.setValue(i,s,n,a),"buttons"===r&&(this.refreshButtons(),this.refreshFocus())}setNodeFocus(e,t){const i=super.setNodeFocus(e,t);return i&&this.refreshFocus(),i}handleKey(t,i){if(!i&&this.lastPressHandled===t)return this.lastPressHandled="",!0;let s=!1;if("up"===t||"down"===t){const n=this.getIndex("up"===t?-1:1);i&&n!==this.focusIndex&&(this.setValue("focusButton",new e.Int32(n)),s=!0)}else"OK"===t&&i&&(this.setValue("buttonSelected",new e.Int32(this.focusIndex)),s=!0);return this.lastPressHandled=s?t:"",s}renderNode(e,t,i,s,n){if(!this.isVisible())return;const a=this.getTranslation(),r=0===i?a.slice():C(a,i);r[0]+=t[0],r[1]+=t[1];const o=this.getDimensions(),l={x:r[0],y:r[1],width:this.width,height:o.height};this.refreshFocus(),this.isDirty&&(this.refreshButtons(),this.isDirty=!1);const h=i+this.getRotation();s*=this.getOpacity(),this.updateBoundingRects(l,t,h),this.renderChildren(e,r,h,s,n),this.updateParentRects(t,i)}refreshButtons(){const i=t(this.getValue("buttons"));if(!i)return;const s=Math.max(i.length,this.children.length),n=this.getValue("focusedTextFont"),a=this.getValueJS("buttonHeight");this.width=this.calculateButtonWidth(i,n.createDrawFont());for(let t=0;t<s;t++){const s=i[t];if(!s)break;{let i=this.children[t];i||(i=this.createButton()),i.iconSize=this.iconSize,i.setValueSilent("text",new e.BrsString(s)),this.copyField(i,"textColor"),this.copyField(i,"focusedTextColor"),this.copyField(i,"textFont"),this.copyField(i,"focusedTextFont"),this.copyField(i,"focusBitmapUri"),this.copyField(i,"focusFootprintBitmapUri"),this.copyField(i,"iconUri"),this.copyField(i,"focusedIconUri"),this.copyField(i,"height","buttonHeight"),i.setValueSilent("minWidth",new e.Float(this.width)),this.copyField(i,"maxWidth"),i.setValueSilent("showFocusFootprint",e.BrsBoolean.from(this.focusIndex===t));const n=t*(Math.max(a,this.iconSize[1])-this.vertOffset),r=Math.max((this.iconSize[1]-a)/2,0);i.setValueSilent("translation",new e.RoArray([new e.Float(0),new e.Float(n+r)]))}}this.children.splice(i.length)}createButton(){const t=new L;for(let i of t.getNodeChildren())if(i instanceof P){i.setValueSilent("horizAlign",new e.BrsString("left"));break}return this.appendChildToParent(t),t}refreshFocus(){const e=F.focused;if(this.children.length&&e instanceof f&&(e===this||e.getNodeParent()===this)){const t=this.children[this.focusIndex];e!==t&&t instanceof f&&F.setFocused(t),this.wasFocused=!0}else this.wasFocused&&(this.wasFocused=!1,this.isDirty=!0)}calculateButtonWidth(t,i){const s=this.getValueJS("minWidth"),n=this.getValueJS("maxWidth");this.iconSize=this.getIconSize(["iconUri","focusedIconUri"]);const a=this.iconSize[0]>0?this.iconSize[0]+this.gap:0,r=n-2*this.margin-a;let o=s-2*this.margin-a;for(let s of t){const t=i instanceof e.RoFont?i.measureTextWidth(s,r):{width:0,height:0};o=Math.max(t.width,o)}return Math.min(n,o+2*this.margin+a)}getIndex(e=0){const t=this.getValueJS("buttonFocused")+e,i=this.getValueJS("buttons");return t>=i.length?i.length-1:t<0?0:t}}class E extends S{name;defaultFields=[{name:"command",type:"string"},{name:"requestedUserData",type:"string",value:"all"},{name:"requestedUserDataInfo",type:"node"},{name:"userData",type:"node",alwaysNotify:!0},{name:"userRegionData",type:"node",alwaysNotify:!0},{name:"order",type:"node"},{name:"deltaOrder",type:"assocarray"},{name:"requestPartnerOrder",type:"node"},{name:"confirmPartnerOrder",type:"node"},{name:"orderStatus",type:"node",alwaysNotify:!0},{name:"purchases",type:"node",alwaysNotify:!0},{name:"catalog",type:"node",alwaysNotify:!0},{name:"storeCatalog",type:"node",alwaysNotify:!0},{name:"requestPartnerOrderStatus",type:"node",alwaysNotify:!0},{name:"confirmPartnerOrderStatus",type:"node",alwaysNotify:!0},{name:"fakeServer",type:"boolean",value:"false"},{name:"nonce",type:"string"},{name:"deviceAttestationToken",type:"node",alwaysNotify:!0}];channelStore;constructor(t=[],i=$.ChannelStore){super([],i),this.name=i,this.setExtendsType(i,$.Node),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t),this.channelStore=new e.RoChannelStore}setValue(i,s,n=!1,a){const r=i.toLowerCase();if("order"===r){const e=[];s instanceof k&&e.push(c(s)),this.channelStore.setNewOrder(e)}else if("deltaorder"===r){if(s instanceof e.RoAssociativeArray){const i=s.get(new e.BrsString("delta")),n=s.get(new e.BrsString("qty"));(0,e.isBrsString)(i)&&(0,e.isBrsNumber)(n)&&this.channelStore.setDeltaOrder(i.getValue(),t(n))}}else r==="fakeServer".toLowerCase()&&(0,e.isBrsBoolean)(s)&&this.channelStore.setFakeServer(s.toBoolean());super.setValue(i,s,n,a),"command"===r&&(0,e.isBrsString)(s)&&""!==s.getValue()&&this.handleCommand(s.getValue().toLowerCase())}handleCommand(t){switch(t){case"getuserdata":case"getuserregiondata":this.setUserData(t,"getuserdata"===t?"userData":"userRegionData");break;case"getcatalog":case"getstorecatalog":this.setStoreData("GetCatalog","getcatalog"===t?"catalog":"storeCatalog");break;case"getpurchases":case"getallpurchases":this.setStoreData("GetPurchases","purchases");break;case"doorder":this.doOrder();break;case"getdeviceattestationtoken":{const t=new k;t.setValueSilent("status",new e.Int32(1)),t.setValueSilent("nonce",this.getValue("nonce")),t.setValueSilent("token",this.channelStore.getAttestationToken()),super.setValue("deviceAttestationToken",t);break}default:e.BrsDevice.stderr.write(`warning,[ChannelStore] Invalid or unhandled 'command': ${t}`)}}setStoreData(t,i){const s=new k,n={code:-4,message:"Empty List"},a=this.channelStore.getProductData(t,n);s.setValueSilent("status",new e.Int32(n.code)),s.setValueSilent("message",new e.BrsString(n.message));for(const e of a)s.appendChildToParent(u(e));super.setValue(i,s)}setUserData(t,i){const s=new k,n=this.getValueJS("fakeServer");n?("getuserdata"===t?(s.setValueSilent("email",new e.BrsString("johm.doe@email.com")),s.setValueSilent("firstName",new e.BrsString("John")),s.setValueSilent("lastName",new e.BrsString("Doe")),s.setValueSilent("gender",new e.BrsString("Male")),s.setValueSilent("birth",new e.BrsString("1970-01")),s.setValueSilent("phone",e.BrsInvalid.Instance)):n&&"getuserregiondata"===t&&(s.setValueSilent("state",new e.BrsString("CA")),s.setValueSilent("zip",new e.BrsString("90210")),s.setValueSilent("country",new e.BrsString("USA"))),super.setValue(i,s)):super.setValue(i,e.BrsInvalid.Instance)}doOrder(){const t=new k,i={code:-3,message:"Invalid Order"},s=this.channelStore.placeOrder(i);t.setValueSilent("status",new e.Int32(i.code)),t.setValueSilent("message",new e.BrsString(i.message));for(const e of s)t.appendChildToParent(u(e));super.setValue("orderStatus",t)}}class U extends R{name;defaultFields=[{name:"textHorizAlign",type:"string",value:"left"},{name:"color",type:"color",value:"0xddddddff"},{name:"focusedColor",type:"color",value:"0x262626ff"},{name:"font",type:"font"},{name:"focusedFont",type:"font",value:"font:MediumBoldSystemFont"},{name:"numRows",type:"integer",value:"12"},{name:"numColumns",type:"integer",value:"1"},{name:"vertFocusAnimationStyle",type:"string",value:"fixedFocusWrap"}];focusUri="common:/images/focus_list.9.png";footprintUri="common:/images/focus_footprint.9.png";constructor(t=[],i=$.LabelList){super([],i),this.name=i,this.setExtendsType(i,$.ArrayGrid),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t),"FHD"===this.resolution?this.setValueSilent("itemSize",n([510,72])):this.setValueSilent("itemSize",n([340,48])),this.setValueSilent("focusBitmapUri",new e.BrsString(this.focusUri)),this.setValueSilent("focusFootprintBitmapUri",new e.BrsString(this.footprintUri));const s=this.getValueJS("vertFocusAnimationStyle");this.wrap="fixedfocuswrap"===s.toLowerCase(),this.numRows=this.getValueJS("numRows"),this.numCols=this.getValueJS("numColumns"),this.hasNinePatch=!0}setValue(e,t,i=!1,s){const n=e.toLowerCase();if("vertfocusanimationstyle"===n){if(!["fixedfocuswrap","floatingfocus"].includes(t.toString().toLowerCase()))return}else if(["horizfocusanimationstyle","numcolumns"].includes(n))return;super.setValue(e,t,i,s),"content"===n||"vertfocusanimationstyle"===n?this.topRow=0:"numrows"===n&&this.clampTopRow()}handleUpDown(t){let i=!1;const s="up"===t?-1:1,n=this.getIndex(s);return n!==this.focusIndex&&(this.setValue("animateToItem",new e.Int32(n)),i=!0,this.currRow+=this.wrap?0:s),i}handlePageUpDown(t){let i,s=!1;if(this.wrap){const e=Math.max(1,this.numRows-2),s="rewind"===t?-e:e;i=this.getIndex(s)}else i="rewind"===t?0:this.content.length-1,this.currRow="rewind"===t?0:this.numRows-1;return i!==this.focusIndex&&(this.setValue("animateToItem",new e.Int32(i)),s=!0),s}renderContent(t,i,s,n,a){if(0===this.content.length)return;const r=this.metadata.length>0,o=F.focused===this;this.currRow=this.updateListCurrRow();let l=-1;const h=Math.min(this.content.length,this.numRows),d=this.getValueJS("itemSize"),u={...i,width:d[0],height:d[1]};let c=h+1;for(let t=0;t<h;t++){const i=this.getIndex(t-this.currRow),s=i===this.focusIndex,h=this.getContentItem(i);if(!r&&this.wrap&&i<l&&t>0)u.y+=this.renderWrapDivider(u,n,a);else if(r&&this.wrap&&this.metadata[i]?.divider&&t>0){const e=this.metadata[i].sectionTitle;u.y+=this.renderSectionDivider(e,u,n,c,a),c++}if(this.renderItem(i,h,u,n,o,s,a),u.y+=d[1]+1,l=i,!(0,e.RectRect)(this.sceneRect,u))break}this.updateRect(i,h,d)}renderItem(e,t,i,s,n,a,r){const o=["HDListItemIconUrl","HDListItemIconSelectedUrl"],l=t.getIconSize(o),h=t.getValueJS("title"),d=l[0]>0?l[0]+this.gap:0,u=a?1:0,c=d>0?t.getBitmap(o[u]):void 0;a?this.renderFocused(e,h,i,s,n,d,!1,c,r):this.renderUnfocused(e,h,i,s,d,!1,c,r)}renderUnfocused(e,t,i,s,n,a,r,o){const l=this.getValue("font"),h=this.getValueJS("color"),d=this.getValueJS("textHorizAlign"),u={...i,x:i.x+n,width:i.width-(n?this.gap:0)};r&&this.renderIcon(r,i,s,o,a?h:void 0),this.drawText(t,l,h,s,u,d,"center",0,o,"...",e)}renderFocused(e,t,i,s,n,a,r,o,l){const h=this.getValue(n?"focusedFont":"font"),d=this.getValueJS(n?"focusedColor":"color"),u=this.getValueJS("textHorizAlign"),c={...i,x:i.x+a,width:i.width-(a?this.gap:0)},g=this.getValueJS("drawFocusFeedback"),m=this.getValueJS("drawFocusFeedbackOnTop");g&&!m&&this.renderFocus(i,s,n,l),o&&this.renderIcon(o,i,s,l,r?d:void 0),this.drawText(t,h,d,s,c,u,"center",0,l,"...",e),g&&m&&this.renderFocus(i,s,n,l),this.hasNinePatch=this.hasNinePatch&&g}renderIcon(e,t,i,s,n){const a=t.y+(t.height/2-e.height/2),r={...t,y:a,width:e.width,height:e.height};this.drawImage(e,r,0,i,s,n)}}class H extends U{name;defaultFields=[{name:"checkedState",type:"array"},{name:"checkOnSelect",type:"boolean",value:"true"},{name:"checkedIconUri",type:"uri",value:""},{name:"uncheckedIconUri",type:"uri",value:""},{name:"focusedCheckedIconUri",type:"uri",value:""},{name:"focusedUncheckedIconUri",type:"uri",value:""}];constructor(t=[],i=$.CheckList){super([],i),this.name=i,this.setExtendsType(i,$.LabelList),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t);const s=`common:/images/${this.resolution}/icon_checkboxON.png`,n=`common:/images/${this.resolution}/icon_checkboxOFF.png`;this.setValueSilent("checkedIconUri",new e.BrsString(s)),this.setValueSilent("uncheckedIconUri",new e.BrsString(n)),this.setValueSilent("focusedCheckedIconUri",new e.BrsString(s)),this.setValueSilent("focusedUncheckedIconUri",new e.BrsString(n)),this.setValueSilent("checkedState",new e.RoArray([]))}get(t){if(!(0,e.isBrsString)(t))throw new Error("RoSGNode indexes must be strings");return"checkedstate"===t.getValue().toLowerCase()?this.refreshCheckedState():super.get(t)}setValue(i,s,a=!1,r){if("checkedstate"===i.toLowerCase()){let i=[],a=this.getValue("checkedState");if(a instanceof e.RoArray&&(i=t(a)),!(s instanceof e.RoArray&&s.elements.length))return;for(let t=0;t<s.elements.length;t++){const n=s.elements[t];n.kind===e.ValueKind.Boolean&&(i[t]=n.getValue())}s=n(i)}super.setValue(i,s,a,r)}handleOK(i){if(!i)return!1;const s=this.getValueJS("checkOnSelect"),a=this.getValue("checkedState");if(s&&a instanceof e.RoArray){const e=t(a);e[this.focusIndex]=!e[this.focusIndex],this.setValue("checkedState",n(e))}return this.setValue("itemSelected",new e.Int32(this.focusIndex)),!0}renderItem(e,t,i,s,n,a,r){const o=this.getValueJS("checkedState"),l=t.getValueJS("hideIcon"),h=o[e]?["checkedIconUri","focusedCheckedIconUri"]:["uncheckedIconUri","focusedUncheckedIconUri"],d=this.getIconSize(h),u=t.getValueJS("title"),c=d[0]>0?d[0]+this.gap:0,g=a?1:0,m=!l&&c>0?this.getBitmap(h[g]):void 0;a?this.renderFocused(e,u,i,s,n,c,!0,m,r):this.renderUnfocused(e,u,i,s,c,!0,m,r)}refreshCheckedState(){let i=[],s=this.getValue("checkedState");s instanceof e.RoArray&&(i=t(s));const a=this.getValue("content");if(a instanceof k){const e=a.getNodeChildren().length;i.length<e?i.length=e:i.length>e&&i.splice(e)}const r=n(i);return this.setValueSilent("checkedState",r),r}}class _ extends T{name;defaultFields=[{name:"title",type:"string"},{name:"titleColor",type:"color",value:"0xddddddff"},{name:"titleFont",type:"font"},{name:"message",type:"string"},{name:"messageColor",type:"color",value:"0xddddddff"},{name:"messageFont",type:"font"},{name:"numberedBullets",type:"boolean",value:"false"},{name:"bulletText",type:"array"},{name:"bulletTextColor",type:"color",value:"0xddddddff"},{name:"bulletTextFont",type:"font"},{name:"buttons",type:"array"},{name:"buttonGroup",type:"node"},{name:"graphicUri",type:"uri",value:""},{name:"graphicWidth",type:"float",value:"0.0"},{name:"graphicHeight",type:"float",value:"0.0"},{name:"buttonSelected",type:"integer",value:"0",alwaysNotify:!0},{name:"buttonFocused",type:"integer",value:"0",alwaysNotify:!0},{name:"focusButton",type:"integer",value:"0"},{name:"optionsDialog",type:"boolean",value:"false"},{name:"backgroundUri",type:"uri",value:""},{name:"iconUri",type:"uri",value:""},{name:"dividerUri",type:"uri",value:""},{name:"close",type:"boolean",value:"false"},{name:"wasClosed",type:"boolean",value:"false",alwaysNotify:!0},{name:"width",type:"float",value:"-1.0"},{name:"maxHeight",type:"float",value:"-1.0"}];background;icon;divider;title;message;gap;vertOffset;minHeight;buttonGroup;lineHeight;lastFocus;width;height;dialogTrans;iconSize;iconTrans;backUri="common:/images/dialog_background.9.png";dividerUri="common:/images/dividerHorizontal.9.png";focusIndex=0;hasButtons=!1;constructor(t=[],i=$.Dialog){let s,n,a,r,o,l,h,d,u,c;super([],i),this.name=i,this.setExtendsType(i,$.Group),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t),this.buttonGroup=new O;const g=`common:/images/${this.resolution}/icon_dialog_info.png`;"FHD"===this.resolution?(this.width=1050,this.minHeight=216,this.gap=18,this.vertOffset=30,this.lineHeight=4.5,this.dialogTrans=[(this.sceneRect.width-this.width)/2,(this.sceneRect.height-this.minHeight)/2],this.iconSize=60,this.iconTrans=[this.dialogTrans[0]+447,this.dialogTrans[1]+36],s=this.width-228,n=46,o=42,a=(this.sceneRect.width-s)/2,r=this.dialogTrans[1]+45,l=this.dialogTrans[1]+105,h=this.width-177,d=(this.sceneRect.width-h)/2,u=r+111,c=34,this.buttonGroup.setValueSilent("minWidth",new e.Float(900)),this.buttonGroup.setValueSilent("maxWidth",new e.Float(900))):(this.width=700,this.minHeight=144,this.gap=12,this.vertOffset=20,this.lineHeight=3,this.dialogTrans=[(this.sceneRect.width-this.width)/2,(this.sceneRect.height-this.minHeight)/2],this.iconSize=40,this.iconTrans=[this.dialogTrans[0]+298,this.dialogTrans[1]+24],s=this.width-152,n=30,o=28,a=(this.sceneRect.width-s)/2,r=this.dialogTrans[1]+30,l=this.dialogTrans[1]+70,h=this.width-118,d=(this.sceneRect.width-h)/2,u=r+74,c=24,this.buttonGroup.setValueSilent("minWidth",new e.Float(600)),this.buttonGroup.setValueSilent("maxWidth",new e.Float(600))),this.height=this.minHeight,this.setValueSilent("iconUri",new e.BrsString(g)),this.background=this.addPoster(this.backUri,this.dialogTrans,this.width,this.height),this.title=this.addLabel("titleColor",[a,r],s,n,o,"top","center"),this.icon=this.addPoster(g,this.iconTrans,this.iconSize,this.iconSize),this.divider=this.addPoster(this.dividerUri,[a,l],s,this.lineHeight),this.message=this.addLabel("messageColor",[d,u],h,0,c,"top","left",!0),this.setValueSilent("width",new e.Float(this.width)),this.setValueSilent("backgroundUri",new e.BrsString(this.backUri)),this.setValueSilent("dividerUri",new e.BrsString(this.dividerUri)),this.setValueSilent("buttonGroup",this.buttonGroup),this.linkField(this.buttonGroup,"buttons"),this.linkField(this.buttonGroup,"buttonSelected"),this.linkField(this.buttonGroup,"buttonFocused"),this.linkField(this.buttonGroup,"focusButton"),this.appendChildToParent(this.buttonGroup)}setValue(i,s,n=!1,a){const r=i.toLowerCase();if("focusbutton"===r){const e=this.getValueJS("buttons"),i=t(s);"number"==typeof i&&i>=0&&i<e.length&&(this.focusIndex=i,super.setValue("buttonFocused",s))}else if("close"===r)i="wasClosed",s=e.BrsBoolean.True,this.setValue("visible",e.BrsBoolean.False),F.scene?.dialog===this&&(F.scene.dialog=void 0),this.lastFocus instanceof T&&(F.setFocused(this.lastFocus),this.lastFocus.isDirty=!0,this.lastFocus=void 0);else if("buttons"===r)return void this.buttonGroup.setValue(i,s);super.setValue(i,s,n,a)}setNodeFocus(e,t){return t&&this.hasButtons&&F.focused&&void 0===this.lastFocus&&(this.lastFocus=F.focused,F.setFocused(this.buttonGroup),this.isDirty=!0),!0}handleKey(t,i){const s=this.getValueJS("optionsDialog");let n=!1;return i&&("back"===t||"options"===t&&s)?(this.setValue("close",e.BrsBoolean.True),n=!0):this.hasButtons&&(n=this.buttonGroup.handleKey(t,i)),n}renderNode(e,t,i,s,n){if(!this.isVisible())return;const a=this.getTranslation(),r=0===i?a.slice():C(a,i);r[0]+=t[0],r[1]+=t[1];const o=this.getDimensions(),l={x:r[0],y:r[1],width:this.width,height:o.height};this.isDirty&&this.updateChildren(),this.setNodeFocus(e,!0);const h=i+this.getRotation();s*=this.getOpacity(),this.updateBoundingRects(l,t,h),this.renderChildren(e,r,h,s,n),this.updateParentRects(t,i)}updateChildren(){this.height=this.minHeight;const t=this.getValueJS("width");t&&(this.background.setValue("width",new e.Float(t)),this.width=t),this.copyField(this.background,"uri","backgroundUri"),this.copyField(this.title,"text","title"),this.copyField(this.title,"color","titleColor"),this.copyField(this.title,"font","titleFont");const i=this.copyField(this.icon,"uri","iconUri").toString();if(i){const e=this.title.getMeasured();if(e.width>0){const t=(this.sceneRect.width-e.width)/2;this.iconTrans[0]=t-this.iconSize-this.gap}}this.copyField(this.divider,"uri","dividerUri");const s=this.copyField(this.message,"text","message");if((0,e.isBrsString)(s)&&""!==s.getValue()){const e=this.message.getMeasured();this.height+=e.height+this.vertOffset}this.copyField(this.message,"color","messageColor"),this.copyField(this.message,"font","messageFont");const n=this.getValueJS("buttons"),a=this.buttonGroup.getValueJS("buttonHeight");n?.length?(this.height+=a*n.length,this.hasButtons=!0):(this.height+=this.vertOffset,this.hasButtons=!1);const r=(this.sceneRect.height-this.height)/2,o=r-this.dialogTrans[1];if(this.dialogTrans[1]=r,this.background.setTranslation(this.dialogTrans),this.background.setValue("height",new e.Float(this.height)),i&&(this.iconTrans[1]+=o,this.icon.setTranslation(this.iconTrans)),this.title.setTranslationOffset(0,o),this.divider.setTranslationOffset(0,o),this.message.setTranslationOffset(0,o),this.hasButtons){const e=[this.message.getValueJS("translation")[0],this.dialogTrans[1]+this.height-a*n.length-this.vertOffset];this.buttonGroup.setTranslation(e)}this.isDirty=!1}}class K extends S{name;defaultFields=[{name:"uri",type:"uri"},{name:"size",type:"integer",value:"24"},{name:"fallbackGlyph",type:"string"}];static DrawFontCache=new Map;defaultSize;resolution;fontRegistry;systemFont;constructor(t=[],i=$.Font){super([],i),this.name=i,this.setExtendsType(i,$.Node),this.resolution=F.scene?.ui.resolution??"HD",this.defaultSize="HD"===this.resolution?24:36,this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t),this.setValueSilent("size",new e.Int32(this.defaultSize)),this.systemFont="MediumSystemFont",this.fontRegistry=(0,e.getFontRegistry)(),function(t){if(J.size>0)return;const i=e.BrsDevice.fileSystem.readFileSync("common:/fonts/system-fonts.json","utf-8"),s=JSON.parse(i),n=t.registerFont(`common:/Fonts/${s.sceneGraph.regular}`,!0),a=t.registerFont(`common:/Fonts/${s.sceneGraph.bold}`,!0);for(const e of s.systemFonts)J.set(e.name.toLowerCase(),{family:e.bold?a:n,fhd:e.fhd,hd:e.hd})}(this.fontRegistry)}setValue(t,i,s=!1,n){"uri"===t.toLowerCase()&&(0,e.isBrsString)(i)&&this.fontRegistry.registerFont(i.getValue(),!0),super.setValue(t,i,s,n)}getUri(){return this.getValueJS("uri")??""}getSize(){return this.getValueJS("size")??this.defaultSize}setSize(t){this.setValueSilent("size",new e.Int32(t))}setSystemFont(e){const t=J.get(e.toLowerCase());return!!t&&(this.systemFont=e,this.setSize("HD"===this.resolution?t.hd:t.fhd),!0)}createDrawFont(){let t=J.get(this.systemFont.toLowerCase())?.family??"";const i=this.getUri();""!==i&&(t=this.fontRegistry.getFontFamily(i)??t);const s=`${t}-${this.getSize()}`;let n=K.DrawFontCache.get(s);if(!n){const i=this.fontRegistry.createFont(new e.BrsString(t),new e.Int32(this.getSize()),e.BrsBoolean.False,e.BrsBoolean.False);if(!(i instanceof e.RoFont))return e.BrsDevice.isDevMode&&e.BrsDevice.stderr.write(`warning, Failed to create RoFont for family "${t}".`),e.BrsInvalid.Instance;n=i,K.DrawFontCache.set(s,n)}return n}}const J=new Map;class z extends T{name;defaultFields=[{name:"text",type:"string",value:""},{name:"hintText",type:"string",value:""},{name:"maxTextLength",type:"integer",value:"15"},{name:"cursorPosition",type:"integer",value:"0"},{name:"clearOnDownKey",type:"boolean",value:"true"},{name:"active",type:"boolean",value:"false"},{name:"secureMode",type:"boolean",value:"false"},{name:"textColor",type:"color",value:"0xFFFFFFFF"},{name:"hintTextColor",type:"color",value:"0xAAAAAAFF"},{name:"width",type:"float",value:"-1.0"},{name:"backgroundUri",type:"string",value:""},{name:"leadingEllipsis",type:"boolean",value:"false"}];background;drawFont;cursorVisible=!0;lastCursorToggleTime=0;lastCharInputTime=0;cursor;textLabel;secureLabel;hintLabel;height;paddingX;paddingY;cursorBlinkInterval=500;secureDisplayTimeout=2500;secureChar="";backUri="common:/images/inputField.9.png";constructor(t=[],i=$.TextEditBox){super([],i),this.name=i,this.setExtendsType(i,$.Group),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t),"FHD"===this.resolution?(this.height=72,this.paddingX=33,this.paddingY=18):(this.height=48,this.paddingX=22,this.paddingY=12),this.background=this.loadBitmap(this.backUri);const s=`common:/images/${this.resolution}/cursor_textInput.png`;this.cursor=this.loadBitmap(s),this.setValueSilent("focusable",e.BrsBoolean.True),this.setValueSilent("height",new e.Float(this.height)),this.textLabel=new P,this.secureLabel=new P,this.hintLabel=new P,this.configureLabel(this.textLabel),this.configureLabel(this.secureLabel),this.configureLabel(this.hintLabel),this.appendChildToParent(this.textLabel),this.appendChildToParent(this.secureLabel),this.appendChildToParent(this.hintLabel),this.linkField(this.textLabel,"text"),this.linkField(this.textLabel,"color","textColor"),this.linkField(this.hintLabel,"text","hintText"),this.hintLabel.setValueSilent("color",new e.Int32(I("0xAAAAAAFF"))),this.linkField(this.hintLabel,"color","hintTextColor"),this.lastCursorToggleTime=Date.now()}configureLabel(t){const i=this.getValueJS("width"),s=i>0?i-2*this.paddingX:0;t.setTranslation([this.paddingX,this.paddingY]),t.setValueSilent("width",new e.Float(s)),t.setValueSilent("height",new e.Float(this.height-2*this.paddingY)),t.setValueSilent("vertAlign",new e.BrsString("center"))}handleKey(t,i){let s=!1;if(!i)return s;const n=this.getValueJS("maxTextLength");let a=this.getValueJS("text"),r=this.getValueJS("cursorPosition");if(t.startsWith("Lit_")){const i=t.substring(4);a.length<n&&(a=0===r?i+a:a.slice(0,r)+i+a.slice(r),r++,this.setValue("text",new e.BrsString(a)),this.setValue("cursorPosition",new e.Float(r)),this.lastCharInputTime=Date.now(),s=!0)}else"replay"===t&&a.length&&r>0&&(a=a.slice(0,r-1)+a.slice(r),r--,this.setValue("text",new e.BrsString(a)),this.setValue("cursorPosition",new e.Float(r)),this.lastCharInputTime=0,s=!0);return s&&(this.cursorVisible=!0,this.lastCursorToggleTime=Date.now()),s}setActive(t){this.setValue("active",e.BrsBoolean.from(t))}moveCursor(t){let i=this.getValueJS("cursorPosition");const s=this.getValueJS("text");0===t?i=0:(i+=t,i<0?i=0:i>s.length&&(i=s.length)),this.setValue("cursorPosition",new e.Float(i)),this.cursorVisible=!0,this.lastCursorToggleTime=Date.now()}renderNode(t,i,s,n,a){if(!this.isVisible())return;const r=this.getTranslation().slice();r[0]+=i[0],r[1]+=i[1];const o=this.getDimensions(),l=s+this.getRotation(),h=n*this.getOpacity(),d=this.getValueJS("text"),u=this.getValueJS("secureMode"),c=Date.now();if(this.isDirty){const t=this.getValueJS("width"),i=t>0?t-2*this.paddingX:0,s=new e.Float(i);this.textLabel.setValueSilent("width",s),this.secureLabel.setValueSilent("width",s),this.hintLabel.setValueSilent("width",s),this.copyField(this.secureLabel,"color","textColor");const n=this.getValueJS("backgroundUri");n&&this.background?.getImageName()!==n&&(this.background=this.getBitmap("backgroundUri"))}const g={x:r[0],y:r[1],width:o.width,height:o.height};this.background?.isValid()&&this.drawImage(this.background,g,0,h,a);const m=0===d.length,p=this.getSecureText(d,c,u,m);this.textLabel.setValueSilent("visible",e.BrsBoolean.from(!m&&!u)),this.hintLabel.setValueSilent("visible",e.BrsBoolean.from(m)),this.secureLabel.setValueSilent("visible",e.BrsBoolean.from(!m&&u)),this.renderCursor(g,c,d,u,p,a),this.updateBoundingRects(g,i,l),this.renderChildren(t,r,l,h,a),this.updateParentRects(i,s),this.isDirty=!1}getSecureText(t,i,s,n){let a="";return s&&!n&&(a=i-this.lastCharInputTime<this.secureDisplayTimeout&&t.length>0?this.secureChar.repeat(t.length-1)+t.slice(-1):this.secureChar.repeat(t.length),this.secureLabel.setValueSilent("text",new e.BrsString(a))),a}renderCursor(t,i,s,n,a,r){if(this.getValueJS("active")&&this.cursor?.isValid()&&(i-this.lastCursorToggleTime>this.cursorBlinkInterval&&(this.cursorVisible=!this.cursorVisible,this.lastCursorToggleTime=i),this.cursorVisible)){const i=this.getValueJS("cursorPosition");let o;if(o=n?a.substring(0,Math.min(i,a.length)):s.substring(0,Math.min(i,s.length)),void 0===this.drawFont){const t=this.textLabel.getValue("font").createDrawFont();if(!(t instanceof e.RoFont))return;this.drawFont=t}const l=this.drawFont.measureTextWidth(o),h={x:t.x+this.paddingX+l.width,y:t.y+(t.height-this.cursor.height)/2,width:this.cursor.width,height:this.cursor.height};this.drawImage(this.cursor,h,0,1,r)}}}var G,W,$;!function(e){e[e.ALPHANUMERIC=0]="ALPHANUMERIC",e[e.SYMBOLS=1]="SYMBOLS",e[e.ACCENTED=2]="ACCENTED"}(G||(G={}));class j extends T{name;defaultFields=[{name:"text",type:"string",value:""},{name:"keyColor",type:"color",value:"0xFFFFFFFF"},{name:"focusedKeyColor",type:"color",value:"0x000000FF"},{name:"keyboardBitmapUri",type:"uri",value:""},{name:"focusBitmapUri",type:"uri",value:""},{name:"textEditBox",type:"node"},{name:"showTextEditBox",type:"boolean",value:"true"}];textEditBox;showTextEdit;keyboardMode;capsLock;shift;keyColor;focusedKeyColor;bmpBack;bmpFocus;textEditX;iconOffsetY;iconRightX;iconOffsetX;keyLeftX;keyRightX;keyBaseY;keyWidth;keyHeight;keyFocusDelta;widthOver;heightOver;offsetX;offsetY;font;icons=["shift","space","delete","moveCursorLeft","moveCursorRight","caps_on","caps_off","alphanum_on","alphanum_off","symbols_on","symbols_off","accent_on","accent_off"];buttons=new Map;bmpIcons=new Map;keyFocus={row:0,col:0,key:"",cursor:-1};constructor(t=[],i=$.Keyboard){super([],i),this.name=i,this.setExtendsType(i,$.Group),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t),this.font=new K,this.keyboardMode=G.ALPHANUMERIC,this.capsLock=!1,this.shift=!1,this.setupKeyboardModes(),this.textEditBox=new z,this.showTextEdit=!0,"FHD"===this.resolution?(this.textEditBox.setValueSilent("width",new e.Float(1371)),this.textEditX=12,this.iconRightX=1203,this.iconOffsetX=45,this.iconOffsetY=81,this.keyLeftX=228,this.keyRightX=897,this.keyBaseY=18,this.keyWidth=93,this.keyHeight=81,this.keyFocusDelta=15,this.offsetX=90,this.offsetY=84,this.widthOver=21,this.heightOver=90):(this.textEditBox.setValueSilent("width",new e.Float(914)),this.textEditX=8,this.iconRightX=802,this.iconOffsetX=30,this.iconOffsetY=54,this.keyLeftX=152,this.keyRightX=598,this.keyBaseY=12,this.keyWidth=62,this.keyHeight=54,this.keyFocusDelta=10,this.offsetX=60,this.offsetY=56,this.widthOver=12,this.heightOver=60),this.textEditBox.setTranslation([this.textEditX,0]),this.textEditBox.setValueSilent("maxTextLength",new e.Int32(75)),this.bmpBack=this.loadBitmap(`common:/images/${this.resolution}/keyboard_full.png`),this.setValueSilent("focusable",e.BrsBoolean.True),this.setValueSilent("width",new e.Float(this.bmpBack.width+this.widthOver)),this.setValueSilent("height",new e.Float(this.bmpBack.height+this.heightOver)),this.bmpFocus=this.loadBitmap("common:/images/focus_keyboard.9.png");for(const e of this.icons){const t=`common:/images/${this.resolution}/icon_${e}.png`,i=this.loadBitmap(t);i?.isValid()&&this.bmpIcons.set(e,i)}this.keyColor=this.getValueJS("keyColor"),this.focusedKeyColor=this.getValueJS("focusedKeyColor"),this.setValueSilent("textEditBox",this.textEditBox),this.linkField(this.textEditBox,"text"),this.appendChildToParent(this.textEditBox)}handleKey(e,t){let i=!1;return t?("left"===e||"right"===e?i=this.handleLeftRight(e):"up"===e||"down"===e?i=this.handleUpDown(e):"OK"===e?i=this.handleOK():e.startsWith("Lit_")||"replay"===e?i=this.textEditBox.handleKey(e,t):"options"===e&&(this.capsLock=!this.capsLock,this.isDirty=!0,i=!0),i):i}handleLeftRight(e){if(this.isDirty=!0,0===this.keyFocus.col&&3===this.keyFocus.row){if("left"===e&&1===this.keyFocus.cursor)return this.keyFocus.cursor=-1,!0;if("right"===e&&-1===this.keyFocus.cursor)return this.keyFocus.cursor=1,!0}else 1===this.keyFocus.col&&3===this.keyFocus.row&&"left"===e?this.keyFocus.cursor=1:11===this.keyFocus.col&&3===this.keyFocus.row&&"right"===e&&(this.keyFocus.cursor=-1);return this.keyFocus.col+="left"===e?-1:1,this.keyFocus.col>11?this.keyFocus.col=0:this.keyFocus.col<0&&(this.keyFocus.col=11),!0}handleUpDown(e){let t=!1;return"up"===e&&this.keyFocus.row>0?(this.keyFocus.row--,this.isDirty=!0,t=!0):"down"===e&&this.keyFocus.row<3&&(this.keyFocus.row++,this.isDirty=!0,t=!0),t}handleOK(){let e=!0;return 0===this.keyFocus.col?0===this.keyFocus.row?this.shift=!this.shift:1===this.keyFocus.row?(this.textEditBox.handleKey("Lit_ ",!0),this.shift=!1):2===this.keyFocus.row?(this.textEditBox.handleKey("replay",!0),this.shift=!1):(this.textEditBox.moveCursor(this.keyFocus.cursor),this.shift=!1):11===this.keyFocus.col?(0===this.keyFocus.row?this.capsLock=!this.capsLock:this.keyboardMode=this.keyFocus.row-1,this.shift=!1):this.keyFocus.col>0&&this.keyFocus.col<11&&(this.keyFocus.key.length&&this.textEditBox.handleKey(`Lit_${this.keyFocus.key}`,!0),this.shift=!1),this.isDirty=e,e}renderNode(t,i,s,n,a){if(!this.isVisible())return;const r=F.focused===this;this.textEditBox.setActive(r);const o=this.getTranslation().slice();o[0]+=i[0],o[1]+=i[1];const l=this.getDimensions(),h=s+this.getRotation();n*=this.getOpacity();const d={x:o[0],y:o[1],width:l.width,height:l.height};if(this.isDirty){this.keyColor=this.getValueJS("keyColor"),this.focusedKeyColor=this.getValueJS("focusedKeyColor"),this.showTextEdit=this.getValueJS("showTextEditBox"),this.textEditBox.setValueSilent("visible",e.BrsBoolean.from(this.showTextEdit)),this.setValueSilent("height",new e.Float(d.height));const t=this.getValueJS("keyboardBitmapUri");t&&this.bmpBack?.getImageName()!==t&&(this.bmpBack=this.getBitmap("keyboardBitmapUri"));const i=this.getValueJS("focusBitmapUri");i&&this.bmpFocus?.getImageName()!==i&&(this.bmpFocus=this.getBitmap("focusBitmapUri"))}d.height=this.showTextEdit?this.bmpBack.height+this.heightOver:this.bmpBack.height;const u=d.y+(this.showTextEdit?this.iconOffsetY:0),c={x:d.x,y:u,width:0,height:0};this.drawImage(this.bmpBack,c,0,n,a),this.renderLeftIcons(d,n,r,a),this.keyFocus.key="",this.renderKeys(7,0,d.x+this.keyLeftX,u+this.keyBaseY,n,r,a),this.renderKeys(3,28,d.x+this.keyRightX,u+this.keyBaseY,n,r,a),this.renderRightIcons(d,n,r,a),this.updateBoundingRects(d,i,h),this.renderChildren(t,o,h,n,a),this.updateParentRects(i,s),this.isDirty=!1}renderLeftIcons(e,t,i,s){for(let n=0;n<5;n++){const a=this.bmpIcons.get(this.icons[n]);if(!a?.isValid())continue;let r=i&&0===this.keyFocus.col&&this.keyFocus.row===n,o=this.offsetX;n>2&&(r=i&&0===this.keyFocus.col&&3===this.keyFocus.row&&(3===n&&-1===this.keyFocus.cursor||4===n&&1===this.keyFocus.cursor),o+=3===n?-this.iconOffsetX:this.iconOffsetX);const l=n<=3?n*this.offsetY:3*this.offsetY;let h=this.keyColor;r&&(h=this.focusedKeyColor,this.renderFocus(e,n,l,t,s)),this.renderIcon(e,a,o,l+a.height,h,t,s)}}renderKeys(e,t,i,s,n,a,r){const o=`${this.keyboardMode}${this.capsLock||this.shift?"U":"L"}`,l=this.buttons.get(o);for(let o=0;o<4;o++)for(let h=0;h<e;h++){const d=t+o*e+h,u=7===e?h+1:h+8,c=l[d]??"",g={x:i+h*this.offsetX,y:s+o*this.offsetY,width:this.keyWidth,height:this.keyHeight};let m=this.keyColor;if(a&&this.keyFocus.col===u&&this.keyFocus.row===o){m=this.focusedKeyColor,this.keyFocus.key=c;const e={x:g.x-this.keyFocusDelta,y:g.y-this.keyFocusDelta,width:g.width+2*this.keyFocusDelta,height:g.height+2*this.keyFocusDelta};this.drawImage(this.bmpFocus,e,0,n,r)}c.length&&this.drawText(c,this.font,m,n,g,"center","center",0,r,"",d)}}renderRightIcons(e,t,i,s){for(let n=0;n<4;n++){const a=this.getRightIcon(n),r=this.bmpIcons.get(a);if(!r?.isValid())continue;let o=this.keyBaseY+n*this.offsetY;const l=e.y+(this.showTextEdit?this.iconOffsetY:0);let h=this.keyColor;if(i&&11===this.keyFocus.col&&this.keyFocus.row===n){h=this.focusedKeyColor;const i={x:e.x+this.iconRightX-this.keyFocusDelta,y:l+o-this.keyFocusDelta,width:2*this.keyWidth+2*this.keyFocusDelta,height:this.keyHeight+2*this.keyFocusDelta};this.drawImage(this.bmpFocus,i,0,t,s)}this.renderIcon(e,r,this.iconRightX,o,h,t,s)}}renderFocus(e,t,i,s,n){const a=e.y+(this.showTextEdit?this.iconOffsetY:0),r=t<3?2*this.keyWidth:this.keyWidth,o={x:t<4?e.x:e.x+this.offsetX,y:a+i,width:r+2*this.keyFocusDelta,height:this.keyHeight+2*this.keyFocusDelta};this.drawImage(this.bmpFocus,o,0,s,n)}renderIcon(e,t,i,s,n,a,r){const o=e.y+(this.showTextEdit?this.iconOffsetY:0),l={x:e.x+i,y:o+s,width:t.width,height:t.height};this.drawImage(t,l,0,a,r,n)}getRightIcon(e){let t="";const i=this.keyboardMode;return 0===e?t=this.capsLock?"caps_on":"caps_off":1===e?t=i===G.ALPHANUMERIC?"alphanum_on":"alphanum_off":2===e?t=i===G.SYMBOLS?"symbols_on":"symbols_off":3===e&&(t=i===G.ACCENTED?"accent_on":"accent_off"),t}setupKeyboardModes(){this.buttons.set("0L","abcdefghijklmnopqrstuvwxyz-_123456789@.0".split("")),this.buttons.set("0U","ABCDEFGHIJKLMNOPQRSTUVWXYZ-_123456789@.0".split("")),this.buttons.set("1L",'!?*#$%^&,:;"(){}[]~<>|\\/=+'.split("")),this.buttons.set("1U","".split("")),this.buttons.set("2L","".split("")),this.buttons.set("2U","".split(""))}}class X extends _{name;defaultFields=[{name:"text",type:"string",value:""},{name:"keyboard",type:"node"}];minHeight;keyboard;keyboardY;focus;constructor(t=[],i=$.KeyboardDialog){let s,n,a,r,o,l;super([],i),this.name=i,this.setExtendsType(i,$.Dialog),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t),this.keyboard=new j,this.setValueSilent("keyboard",this.keyboard),"FHD"===this.resolution?(this.width=1530,this.minHeight=645,this.height=this.minHeight,this.dialogTrans=[(this.sceneRect.width-this.width)/2,(this.sceneRect.height-this.height)/2],s=this.width-177,n=(this.sceneRect.width-s)/2,a=[n,this.dialogTrans[1]+45],r=[n,this.dialogTrans[1]+105],o=[n,a[1]+111],this.keyboardY=219,l=[264,this.dialogTrans[1]+this.keyboardY]):(this.width=1020,this.minHeight=430,this.height=this.minHeight,this.dialogTrans=[(this.sceneRect.width-this.width)/2,(this.sceneRect.height-this.height)/2],s=this.width-118,n=(this.sceneRect.width-s)/2,a=[n,this.dialogTrans[1]+30],r=[n,this.dialogTrans[1]+70],o=[n,a[1]+74],this.keyboardY=146,l=[177,this.dialogTrans[1]+this.keyboardY]),this.background.setValueSilent("width",new e.Float(this.width)),this.background.setValueSilent("height",new e.Float(this.minHeight)),this.background.setTranslation(this.dialogTrans),this.title.setValueSilent("width",new e.Float(s)),this.divider.setValueSilent("width",new e.Float(s)),this.title.setTranslation(a),this.divider.setTranslation(r),this.message.setTranslation(o),this.message.setValueSilent("width",new e.Float(s)),this.keyboard.setTranslation(l),this.appendChildToParent(this.keyboard),this.buttonGroup.setValueSilent("minWidth",new e.Float(s)),this.buttonGroup.setValueSilent("maxWidth",new e.Float(s)),this.setValueSilent("width",new e.Float(this.width)),this.setValueSilent("iconUri",new e.BrsString("")),this.linkField(this.keyboard,"text"),this.icon.setValueSilent("visible",e.BrsBoolean.False),this.focus=""}setNodeFocus(e,t){return t&&F.focused&&void 0===this.lastFocus&&(this.lastFocus=F.focused,F.setFocused(this.hasButtons?this.buttonGroup:this.keyboard),this.isDirty=!0),!0}handleKey(t,i){const s=this.getValueJS("optionsDialog");let n=!1;return i&&("back"===t||"options"===t&&s)?(this.setValue("close",e.BrsBoolean.True),this.focus="",this.keyboard.textEditBox.setActive(!1),this.keyboard.textEditBox.moveCursor(0),n=!0):this.hasButtons&&"buttons"===this.focus?n=this.buttonGroup.handleKey(t,i):"keyboard"===this.focus&&(n=this.keyboard.handleKey(t,i)),!!n||(i&&"up"===t&&"buttons"===this.focus?(F.setFocused(this.keyboard),this.focus="keyboard",this.isDirty=!0,n=!0):i&&"down"===t&&"keyboard"===this.focus&&(F.setFocused(this.buttonGroup),this.focus="buttons",this.isDirty=!0,n=!0),n)}updateChildren(){this.height=this.minHeight;const t=this.getValueJS("width");t&&(this.background.setValue("width",new e.Float(t)),this.width=t),this.copyField(this.background,"uri","backgroundUri"),this.copyField(this.title,"text","title"),this.copyField(this.title,"color","titleColor"),this.copyField(this.title,"font","titleFont");const i=this.copyField(this.icon,"uri","iconUri").toString();if(i){const e=this.title.getMeasured();if(e.width>0){const t=(this.sceneRect.width-e.width)/2;this.iconTrans[0]=t-this.iconSize-this.gap}}this.copyField(this.divider,"uri","dividerUri");const s=this.copyField(this.message,"text","message");if((0,e.isBrsString)(s)&&""!==s.getValue()){const e=this.message.getMeasured();this.height+=e.height+this.vertOffset,this.keyboard.setTranslationY(this.dialogTrans[1]+this.keyboardY)}else this.height+=this.vertOffset,this.keyboard.setTranslationY(this.dialogTrans[1]+this.keyboardY-this.vertOffset);this.copyField(this.message,"color","messageColor"),this.copyField(this.message,"font","messageFont");const n=this.getValueJS("buttons"),a=this.buttonGroup.getValueJS("buttonHeight");n?.length?(this.height+=a*n.length,this.hasButtons=!0):(this.height+=this.vertOffset,this.hasButtons=!1),""===this.focus&&(this.focus=this.hasButtons?"buttons":"keyboard");const r=(this.sceneRect.height-this.height)/2,o=r-this.dialogTrans[1];if(this.dialogTrans[1]=r,this.background.setTranslation(this.dialogTrans),this.background.setValue("height",new e.Float(this.height)),i&&(this.iconTrans[1]+=o,this.icon.setTranslation(this.iconTrans)),this.title.setTranslationOffset(0,o),this.divider.setTranslationOffset(0,o),this.message.setTranslationOffset(0,o),this.keyboard.setTranslationOffset(0,o),this.hasButtons){const e=[this.message.getValueJS("translation")[0],this.dialogTrans[1]+this.height-a*n.length-this.vertOffset];this.buttonGroup.setTranslation(e)}this.isDirty=!1}}class Y extends R{name;defaultFields=[{name:"itemComponentName",type:"string",value:""},{name:"drawFocusFeedbackOnTop",type:"boolean",value:"true"},{name:"vertFocusAnimationStyle",type:"string",value:"fixedFocusWrap"},{name:"numRows",type:"integer",value:"12"},{name:"numColumns",type:"integer",value:"1"}];focusUri="common:/images/focus_grid.9.png";marginX;marginY;gap;constructor(t=[],i=$.MarkupGrid){super([],i),this.name=i,this.setExtendsType(i,$.ArrayGrid),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t),"FHD"===this.resolution?(this.marginX=15,this.marginY=15):(this.marginX=10,this.marginY=10),this.gap=0,this.setValueSilent("focusBitmapUri",new e.BrsString(this.focusUri)),this.setValueSilent("wrapDividerBitmapUri",new e.BrsString(this.dividerUri));const s=this.getValueJS("vertFocusAnimationStyle");this.wrap="fixedfocuswrap"===s.toLowerCase(),this.numRows=this.getValueJS("numRows"),this.numCols=this.getValueJS("numColumns"),this.hasNinePatch=!0,this.focusField="gridHasFocus"}handleUpDown(t){let i,s=!1;const n=this.numCols;if("up"===t)i=-1;else if("down"===t)i=1;else if("rewind"===t)i=-Math.min(Math.ceil(this.content.length/n)-1,6);else{if("fastforward"!==t)return!1;i=Math.min(Math.ceil(this.content.length/n)-1,6)}let a=this.focusIndex+i*n;if(this.wrap){const e=this.focusIndex%n;if(a=this.getIndex(i)+e,this.metadata.length>0){let t=this.content[a];for(;t instanceof k&&"_placeholder_"===t.name;)a=this.getIndex(i,a)+e,t=this.content[a]}}if(a>=0&&a<this.content.length){const t=this.metadata[a]?.index??a;this.setValue("animateToItem",new e.Int32(t)),s=!0,this.currRow+=this.wrap?0:i}return s}handlePageUpDown(e){return this.handleUpDown(e)}handleLeftRight(i){let s=!1;const n="left"===i?-1:1,a=this.focusIndex+n;if(a>=0&&a<this.content.length&&this.itemComps?.[a]){const i=t(this.getValue("numColumns")),n=Math.floor(this.focusIndex/i),r=Math.floor(a/i),o=this.itemComps[a];if(n===r&&"Group"!==o.nodeSubtype){const t=this.metadata[a]?.index??a;this.setValue("animateToItem",new e.Int32(t)),s=!0}}return s}renderContent(t,i,s,n,a){if(0===this.content.length)return;this.focusIndex<0&&(this.focusIndex=0);const r=this.metadata.length>0,o=this.getValueJS("itemComponentName");if(!Ae(o))return void e.BrsDevice.stderr.write(`warning,[sg.markupgrid.create.fail] Failed to create markup item ${o}`);const l=this.getValueJS("itemSize");if(!(l?.[0]&&l?.[1]&&this.numRows&&this.numCols))return;const h={...i,width:l[0],height:l[1]},d=this.getValueJS("itemSpacing"),u=this.getValueJS("columnWidths"),c=this.getValueJS("columnSpacings"),g=this.getValueJS("rowHeights"),m=this.getValueJS("rowSpacings");this.currRow=this.updateCurrRow();let p=-1;const f=Math.min(Math.ceil(this.content.length/this.numCols),this.numRows);let y=0;const w=this.numCols*l[0]+(this.numCols-1)*d[0];for(let o=0;o<f;o++){const f=this.getIndex(o-this.currRow);if(h.height=g[f/this.numCols]??l[1],!r&&this.wrap&&f<p&&o>0){const e={...h,width:w},t=this.renderWrapDivider(e,n,a);h.y+=t+d[1]}else if(r&&this.wrap&&this.metadata[f]?.divider&&o>0){const e={...h,width:w},t=this.metadata[f].sectionTitle,i=this.renderSectionDivider(t,e,n,y,a);y++,h.y+=i+d[1]}for(let i=0;i<this.numCols;i++){h.width=u[i]??l[0];const r=f+i;if(r>=this.content.length)break;if(this.renderItemComponent(t,r,h,s,n,a),h.x+=h.width+(c[i]??d[0]),p=r,!(0,e.RectRect)(this.sceneRect,h))break}if(h.x=i.x,h.y+=h.height+(m[o]??d[1]),!(0,e.RectRect)(this.sceneRect,h))break}this.updateRect(i,f,l)}}class q extends R{name;defaultFields=[{name:"itemComponentName",type:"string",value:""},{name:"numRows",type:"integer",value:"12"},{name:"numColumns",type:"integer",value:"1"},{name:"vertFocusAnimationStyle",type:"string",value:"fixedFocusWrap"}];focusUri="common:/images/focus_list.9.png";footprintUri="common:/images/focus_footprint.9.png";gap;wrap;constructor(t=[],i=$.MarkupList){super([],i),this.name=i,this.setExtendsType(i,$.ArrayGrid),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t),this.gap=0,this.setValueSilent("focusBitmapUri",new e.BrsString(this.focusUri)),this.setValueSilent("focusFootprintBitmapUri",new e.BrsString(this.footprintUri)),this.setValueSilent("wrapDividerBitmapUri",new e.BrsString(this.dividerUri));const s=this.getValueJS("vertFocusAnimationStyle");this.wrap="fixedfocuswrap"===s.toLowerCase(),this.numRows=this.getValueJS("numRows"),this.numCols=this.getValueJS("numColumns"),this.hasNinePatch=!0}setValue(e,t,i=!1,s){const n=e.toLowerCase();if("vertfocusanimationstyle"===n){if(!["fixedfocuswrap","floatingfocus"].includes(t.toString().toLowerCase()))return}else if(["horizfocusanimationstyle","numcolumns"].includes(n))return;super.setValue(e,t,i,s),"content"===n||"vertfocusanimationstyle"===n?this.topRow=0:"numrows"===n&&this.clampTopRow()}handleUpDown(t){let i,s=!1;if("up"===t)i=-1;else if("down"===t)i=1;else if("rewind"===t)i=-Math.min(Math.ceil(this.content.length)-1,6);else{if("fastforward"!==t)return!1;i=Math.min(Math.ceil(this.content.length)-1,6)}let n=this.focusIndex+i;if(this.wrap&&(n=this.getIndex(i)),n>=0&&n<this.content.length){const t=this.metadata[n]?.index??n;this.setValue("animateToItem",new e.Int32(t)),s=!0,this.currRow+=this.wrap?0:i}return s}handlePageUpDown(e){return this.handleUpDown(e)}renderContent(t,i,s,n,a){if(0===this.content.length)return;this.focusIndex<0&&(this.focusIndex=0);const r=this.metadata.length>0,o=this.getValueJS("itemComponentName");if(!Ae(o))return void e.BrsDevice.stderr.write(`warning,[sg.markuplist.create.fail] Failed to create markup item ${o}`);const l=this.getValueJS("itemSize");if(0===l[0]||0===l[1]||0===this.numRows)return;const h={...i,width:l[0],height:l[1]},d=this.getValueJS("itemSpacing"),u=this.getValueJS("rowHeights"),c=this.getValueJS("rowSpacings");this.currRow=this.updateListCurrRow();let g=-1,m=0;const p=Math.min(Math.ceil(this.content.length),this.numRows),f=l[0];for(let o=0;o<p;o++){const p=this.getIndex(o-this.currRow);if(h.height=u[p]??l[1],!r&&this.wrap&&p<g&&o>0){const e={...h,width:f},t=this.renderWrapDivider(e,n,a);h.y+=t+d[1]}else if(r&&this.wrap&&this.metadata[p]?.divider&&o>0){const e={...h,width:f},t=this.metadata[p].sectionTitle,i=this.renderSectionDivider(t,e,n,m,a);m++,h.y+=i+d[1]}h.width=l[0];const y=p;if(y>=this.content.length)break;if(this.renderItemComponent(t,y,h,s,n,a),g=y,h.x=i.x,h.y+=h.height+(c[o]??d[1]),!(0,e.RectRect)(this.sceneRect,h))break}this.updateRect(i,p,l)}}class Z extends T{name;defaultFields=[{name:"text",type:"string",value:""},{name:"keyColor",type:"color",value:"0xFFFFFFFF"},{name:"focusedKeyColor",type:"color",value:"0x000000FF"},{name:"keyboardBitmapUri",type:"uri",value:""},{name:"focusBitmapUri",type:"uri",value:""},{name:"textEditBox",type:"node"},{name:"showTextEditBox",type:"boolean",value:"true"},{name:"lowerCase",type:"boolean",value:"true"}];textEditBox;showTextEdit;lowerCase;keyColor;focusedKeyColor;bmpBack;bmpFocus;textEditX;iconOffsetX;iconOffsetY;keyBaseX;keyBaseY;keyWidth;keyHeight;keyFocusDelta;widthOver;heightOver;offsetX;offsetY;font;icons=["clear","space","delete"];buttons;bmpIcons=new Map;keyFocus={row:0,col:0,key:""};constructor(t=[],i=$.MiniKeyboard){super([],i),this.name=i,this.setExtendsType(i,$.Group),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t),this.font=new K,this.lowerCase=!0,this.buttons="abcdefghijklmnopqrstuvwxyz1234567890".split(""),this.textEditBox=new z,this.showTextEdit=!0,"FHD"===this.resolution?(this.textEditBox.setValueSilent("width",new e.Float(558)),this.textEditX=12,this.iconOffsetX=75,this.iconOffsetY=81,this.keyBaseX=18,this.keyBaseY=24,this.keyWidth=93,this.keyHeight=81,this.keyFocusDelta=18,this.offsetX=90,this.offsetY=84,this.widthOver=3,this.heightOver=78):(this.textEditBox.setValueSilent("width",new e.Float(372)),this.textEditX=8,this.iconOffsetX=50,this.iconOffsetY=54,this.keyBaseX=12,this.keyBaseY=16,this.keyWidth=62,this.keyHeight=54,this.keyFocusDelta=12,this.offsetX=60,this.offsetY=56,this.widthOver=2,this.heightOver=52),this.textEditBox.setTranslation([this.textEditX,0]),this.textEditBox.setValueSilent("maxTextLength",new e.Int32(25)),this.bmpBack=this.loadBitmap(`common:/images/${this.resolution}/keyboard_mini.png`),this.setValueSilent("focusable",e.BrsBoolean.True),this.setValueSilent("width",new e.Float(this.bmpBack.width+this.widthOver)),this.setValueSilent("height",new e.Float(this.bmpBack.height+this.heightOver)),this.bmpFocus=this.loadBitmap("common:/images/focus_keyboard.9.png");for(const e of this.icons){const t=`common:/images/${this.resolution}/icon_${e}.png`,i=this.loadBitmap(t);i?.isValid()&&this.bmpIcons.set(e,i)}this.keyColor=this.getValueJS("keyColor"),this.focusedKeyColor=this.getValueJS("focusedKeyColor"),this.setValueSilent("textEditBox",this.textEditBox),this.linkField(this.textEditBox,"text"),this.appendChildToParent(this.textEditBox)}handleKey(e,t){let i=!1;return t?("left"===e||"right"===e?i=this.handleLeftRight(e):"up"===e||"down"===e?i=this.handleUpDown(e):"OK"===e?i=this.handleOK():(e.startsWith("Lit_")||"replay"===e)&&(i=this.textEditBox.handleKey(e,t)),i):i}handleLeftRight(e){this.isDirty=!0;let t=!0;return this.keyFocus.col+="left"===e?-1:1,this.keyFocus.col>5?(this.keyFocus.col=5,t=!1):this.keyFocus.col<0?(this.keyFocus.col=0,t=!1):6===this.keyFocus.row&&"left"===e?(t=0!==this.keyFocus.col,this.keyFocus.col=this.keyFocus.col>2?2:0):6===this.keyFocus.row&&(t=5!==this.keyFocus.col,this.keyFocus.col=this.keyFocus.col<3?2:5),t}handleUpDown(e){let t=!1;return"up"===e&&this.keyFocus.row>0?(this.keyFocus.row--,this.isDirty=!0,t=!0):"down"===e&&this.keyFocus.row<6&&(this.keyFocus.row++,this.isDirty=!0,t=!0),t}handleOK(){let t=!1,i=this.getValueJS("text");return 6===this.keyFocus.row?(this.keyFocus.col<2?i="":this.keyFocus.col<4?i+=" ":i=i.slice(0,-1),this.setValue("text",new e.BrsString(i)),t=!0):this.keyFocus.key.length&&(i+=this.keyFocus.key,this.setValue("text",new e.BrsString(i)),t=!0),t&&this.showTextEdit&&this.textEditBox.moveCursor(i.length),t}renderNode(t,i,s,n,a){if(!this.isVisible())return;const r=F.focused===this;this.textEditBox.setActive(r);const o=this.getTranslation().slice();o[0]+=i[0],o[1]+=i[1];const l=this.getDimensions(),h=s+this.getRotation();n*=this.getOpacity();const d={x:o[0],y:o[1],width:l.width,height:l.height};if(this.isDirty){this.keyColor=this.getValueJS("keyColor"),this.focusedKeyColor=this.getValueJS("focusedKeyColor"),this.showTextEdit=this.getValueJS("showTextEditBox"),this.textEditBox.setValueSilent("visible",e.BrsBoolean.from(this.showTextEdit)),this.setValueSilent("height",new e.Float(d.height)),this.lowerCase=this.getValueJS("lowerCase");const t=this.getValueJS("keyboardBitmapUri");t&&this.bmpBack?.getImageName()!==t&&(this.bmpBack=this.getBitmap("keyboardBitmapUri"));const i=this.getValueJS("focusBitmapUri");i&&this.bmpFocus?.getImageName()!==i&&(this.bmpFocus=this.getBitmap("focusBitmapUri"))}d.height=this.showTextEdit?this.bmpBack.height+this.heightOver:this.bmpBack.height;const u=d.y+(this.showTextEdit?this.iconOffsetY:0),c={x:d.x,y:u,width:0,height:0};this.drawImage(this.bmpBack,c,0,n,a),this.keyFocus.key="",this.renderKeys(d.x+this.keyBaseX,u+this.keyBaseY,n,r,a),this.renderBottomIcons(d.x+this.keyBaseX,u+this.keyBaseY+6*this.offsetY,n,r,a),this.updateBoundingRects(d,i,h),this.renderChildren(t,o,h,n,a),this.updateParentRects(i,s),this.isDirty=!1}renderKeys(e,t,i,s,n){for(let a=0;a<6;a++)for(let r=0;r<6;r++){const o=6*a+r;let l=this.buttons[o]??"";this.lowerCase||(l=l.toUpperCase());const h={x:e+r*this.offsetX,y:t+a*this.offsetY,width:this.keyWidth,height:this.keyHeight};let d=this.keyColor;if(s&&this.keyFocus.col===r&&this.keyFocus.row===a){d=this.focusedKeyColor,this.keyFocus.key=l;const e={x:h.x-this.keyFocusDelta,y:h.y-this.keyFocusDelta,width:h.width+2*this.keyFocusDelta,height:h.height+2*this.keyFocusDelta};this.drawImage(this.bmpFocus,e,0,i,n)}l.length&&this.drawText(l,this.font,d,i,h,"center","center",0,n,"",o)}}renderBottomIcons(e,t,i,s,n){for(let a=0;a<3;a++){const r=this.bmpIcons.get(this.icons[a]);if(r?.isValid()){let o=6===this.keyFocus.row&&Math.floor(this.keyFocus.col/2)===a;const l=this.offsetX*a*2,h={x:e+this.iconOffsetX+l,y:t+this.keyBaseY,width:r.width,height:r.height};let d=this.keyColor;if(s&&o){d=this.focusedKeyColor;const s=2*this.keyWidth,a={x:e+l-this.keyFocusDelta,y:t-this.keyFocusDelta,width:s+2*this.keyFocusDelta,height:this.keyHeight+2*this.keyFocusDelta};this.drawImage(this.bmpFocus,a,0,i,n)}this.drawImage(r,h,0,i,n,d)}}}}class Q extends S{name;defaultFields=[{name:"control",type:"string"},{name:"repeat",type:"boolean",value:"false"},{name:"duration",type:"time",value:"1.0"},{name:"fire",type:"object",alwaysNotify:!0}];active;lastFireTime;jsCallback;constructor(e=[],t=$.Timer){super([],t),this.name=t,this.setExtendsType(t,$.Node),this.lastFireTime=0,this.active=!1,this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(e),F.timers.push(this)}setValue(t,i,s=!1,n){const a=t.toLowerCase(),r=this.fields.get(a);if(r&&"control"===a&&(0,e.isBrsString)(i)){let t=i.getValue().toLowerCase();return"start"===t?(this.lastFireTime=performance.now(),this.active=!0):"stop"===t?this.active=!1:t="none",r.setValue(new e.BrsString(t)),void this.fields.set(a,r)}super.setValue(t,i,s,n)}setCallback(e){this.jsCallback=e}checkFire(){const t=performance.now(),i=this.getValueJS("duration"),s=this.getValueJS("repeat");return!!(this.active&&(t-this.lastFireTime)/1e3>=i)&&(this.lastFireTime=t,this.active=s,this.fields.get("fire")?.setValue(e.BrsInvalid.Instance),this.jsCallback&&this.jsCallback(),!0)}}class ee extends T{name;defaultFields=[{name:"color",type:"color",value:"0x00000000"},{name:"backgroundUri",type:"uri"},{name:"logoUri",type:"uri"},{name:"logoBaselineOffset",type:"float",value:"0.0"},{name:"title",type:"string"},{name:"titleColor",type:"color",value:"0xfefefeff"},{name:"showClock",type:"boolean",value:"true"},{name:"clockColor",type:"color",value:"0xfefefeff"},{name:"clockText",type:"string"},{name:"showOptions",type:"boolean",value:"false"},{name:"optionsColor",type:"color",value:"0xfefefeff"},{name:"optionsDimColor",type:"color",value:"0xfefefe99"},{name:"optionsIconColor",type:"color"},{name:"optionsIconDimColor",type:"color"},{name:"optionsAvailable",type:"boolean",value:"false"},{name:"optionsText",type:"string"},{name:"optionsMaxWidth",type:"float",value:"0.0"},{name:"leftDividerUri",type:"uri"},{name:"leftDividerVertOffset",type:"float",value:"0.0"},{name:"rightDividerUri",type:"uri"},{name:"rightDividerVertOffset",type:"float",value:"0.0"},{name:"height",type:"float",value:"115"}];backRect;backPoster;optionsIcon;optionsText;logo;leftDivider;rightDivider;title;clockText;optionsOn="common:/images/icon_options.png";optionsOff="common:/images/icon_options_off.png";width;height;realign;constructor(t=[],i=$.Overhang){super([],i),this.name=i,this.setExtendsType(i,$.Group),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t);const s=`common:/images/${this.resolution}/logo_roku.png`,n=`common:/images/${this.resolution}/divider_vertical.png`;"FHD"===this.resolution?(this.width=1920,this.height=172,this.setValueSilent("width",new e.Float(this.width)),this.setValueSilent("height",new e.Float(this.height)),this.backRect=this.addRectangle("color",[0,0],this.width,this.height),this.backPoster=this.addPoster("",[0,0],this.width,this.height),this.logo=this.addPoster(s,[102,63]),this.leftDivider=this.addPoster(n,[261,59],12,51),this.title=this.addLabel("titleColor",[297,58],0,50,45,"bottom"),this.optionsIcon=this.addPoster(this.optionsOff,[1421,67],30,30),this.optionsText=this.addLabel("optionsColor",[1460,64],0,40,33,"center","right"),this.rightDivider=this.addPoster(n,[1646,59],12,51),this.clockText=this.addLabel("clockColor",[1682,64],0,40,33,"center")):(this.width=1280,this.height=115,this.setValueSilent("width",new e.Float(this.width)),this.setValueSilent("height",new e.Float(this.height)),this.backRect=this.addRectangle("color",[0,0],this.width,this.height),this.backPoster=this.addPoster("",[0,0],this.width,this.height),this.logo=this.addPoster(s,[68,42]),this.leftDivider=this.addPoster(n,[174,39],8,34),this.title=this.addLabel("titleColor",[196,39],0,35,30,"bottom"),this.optionsIcon=this.addPoster(this.optionsOff,[959,46],20,20),this.optionsText=this.addLabel("optionsColor",[985,44],0,27,22,"center","right"),this.rightDivider=this.addPoster(n,[1109,39],8,34),this.clockText=this.addLabel("clockColor",[1133,44],0,27,22,"center")),this.logo.noScaling=!0,this.backRect.setValueSilent("visible",e.BrsBoolean.False),this.optionsText.setValue("text",new e.BrsString(e.BrsDevice.getTerm("for Options"))),this.clockText.setValue("text",new e.BrsString(e.BrsDevice.getTime()));const a=new Q;a.setCallback(()=>{this.clockText.setValue("text",new e.BrsString(e.BrsDevice.getTime()))}),a.setValueSilent("repeat",e.BrsBoolean.True),a.setValue("control",new e.BrsString("start")),this.appendChildToParent(a),this.realign=!1}updateChildren(){this.copyField(this.backPoster,"height");const t=this.getValueJS("backgroundUri");t&&this.backPoster.setValue("uri",new e.BrsString(t));const i=this.getValueJS("color"),s=this.getValueJS("logoUri");s?this.logo.setValue("uri",new e.BrsString(s)):i?(this.copyField(this.backRect,"color"),this.backRect.setValueSilent("visible",e.BrsBoolean.True)):this.backRect.setValueSilent("visible",e.BrsBoolean.False),this.copyField(this.backRect,"height");const n=this.getValueJS("title");n?(this.title.setValue("text",new e.BrsString(n)),this.copyField(this.title,"color","titleColor"),this.leftDivider.setValue("visible",e.BrsBoolean.True)):this.leftDivider.setValue("visible",e.BrsBoolean.False);const a=this.getValueJS("showOptions"),r=this.getValueJS("optionsAvailable"),o=a&&r;this.optionsIcon.setValue("visible",e.BrsBoolean.from(o)),this.optionsText.setValue("visible",e.BrsBoolean.from(o));const l=this.getValueJS("showClock");this.clockText.setValue("visible",e.BrsBoolean.from(l)),r?(this.optionsIcon.setValue("uri",new e.BrsString(this.optionsOn)),this.copyField(this.optionsIcon,"blendColor","optionsIconColor"),this.copyField(this.optionsText,"color","optionsColor")):(this.optionsIcon.setValue("uri",new e.BrsString(this.optionsOff)),this.copyField(this.optionsText,"color","optionsDimColor")),l&&o?this.rightDivider.setValue("visible",e.BrsBoolean.True):this.rightDivider.setValue("visible",e.BrsBoolean.False);const h=this.getValueJS("optionsText");h&&this.optionsText.setValue("text",new e.BrsString(h));const d=this.getValueJS("leftDividerUri");d&&this.leftDivider.setValue("uri",new e.BrsString(d));const u=this.getValueJS("rightDividerUri");u&&this.rightDivider.setValue("uri",new e.BrsString(u)),this.isDirty=!1}alignChildren(){const t="FHD"===this.resolution,i="FHD"===e.BrsDevice.getDisplayMode(),s=t?102:68,n=t?60:40,a=this.logo.rectLocal.width,r=this.optionsText.rectLocal.width??(t?168:112),o=this.getValueJS("showClock"),l=o?this.clockText.rectLocal.width:0,h=o?r+(t?60:40):r,d=this.width-s-l;t?(this.logo.setTranslation([s,n+3]),this.leftDivider.setTranslation([s+a+24,n]),this.title.setTranslation([s+a+56,n]),this.optionsIcon.setTranslation([d-h-36,n+9]),this.optionsText.setTranslation([d-h,n+3]),this.rightDivider.setTranslation([d-36,n]),this.clockText.setTranslation([d,n+3])):(this.logo.setTranslation([s,n]),this.leftDivider.setTranslation([s+a+16,n]),this.title.setTranslation([s+a+38,n-2]),this.optionsIcon.setTranslation([d-h-24,n+6]),this.optionsText.setTranslation([d-h,n+2]),this.rightDivider.setTranslation([d-24,n]),this.clockText.setTranslation([d,n+2])),i!==t&&this.logo.setTranslation([s,n]),this.realign=!1}setValue(i,s,n=!1,a){this.realign=!0,"height"===i.toLowerCase()&&(0,e.isBrsNumber)(s)&&(this.height=t(s)),super.setValue(i,s,n,a)}renderNode(e,t,i,s,n){if(!this.isVisible())return;this.isDirty&&this.updateChildren();const a=this.getDimensions(),r={x:t[0],y:t[1],width:a.width,height:a.height};s*=this.getOpacity(),this.updateBoundingRects(r,t,i),this.renderChildren(e,t,i,s,n),this.updateParentRects(t,i),this.realign&&this.alignChildren()}}class te extends T{name;defaultFields=[{name:"panelSize",type:"string",value:"narrow"},{name:"leftPosition",type:"float",value:"105"},{name:"overhangTitle",type:"string",value:""},{name:"clockText",type:"string",value:""},{name:"optionsAvailable",type:"boolean",value:"false"},{name:"leftOrientation",type:"boolean",value:"false"},{name:"leftOnly",type:"boolean",value:"false"},{name:"hasNextPanel",type:"boolean",value:"false"},{name:"isFullScreen",type:"boolean",value:"false"},{name:"goBackCount",type:"integer",value:"1"},{name:"selectButtonMovesPanelForward",type:"boolean",value:"true"},{name:"isOffscreenLeft",type:"boolean",value:"false"}];constructor(t=[],i=$.Panel){super([],i),this.name=i,this.setExtendsType(i,$.Group),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t),this.setValueSilent("focusable",e.BrsBoolean.True)}}class ie extends S{name;defaultFields=[{name:"colors",type:"assocarray"}];constructor(e=[],t=$.RSGPalette){super([],t),this.name=t,this.setExtendsType(t,$.Node),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(e)}}class se extends U{name;defaultFields=[{name:"checkedItem",type:"integer",value:"-1"},{name:"checkOnSelect",type:"boolean",value:"true"},{name:"checkedIconUri",type:"uri",value:""},{name:"focusedCheckedIconUri",type:"uri",value:""}];constructor(t=[],i=$.RadioButtonList){super([],i),this.name=i,this.setExtendsType(i,$.LabelList),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t);const s=`common:/images/${this.resolution}/icon_checkmark.png`;this.setValueSilent("checkedIconUri",new e.BrsString(s)),this.setValueSilent("focusedCheckedIconUri",new e.BrsString(s))}handleOK(i){return!!i&&(t(this.getValue("checkOnSelect"))&&this.setValue("checkedItem",new e.Int32(this.focusIndex)),this.setValue("itemSelected",new e.Int32(this.focusIndex)),!0)}renderItem(e,i,s,n,a,r,o){const l=t(i.getValue("title")),h=t(this.getValue("checkedItem")),d=["checkedIconUri","focusedCheckedIconUri"],u=this.getIconSize(d),c=u[0]>0?u[0]+this.gap:0,g=r?1:0,m=e===h&&c>0?this.getBitmap(d[g]):void 0;r?this.renderFocused(e,l,s,n,a,c,!0,m,o):this.renderUnfocused(e,l,s,n,c,!0,m,o)}}class ne extends T{name;defaultFields=[{name:"width",type:"float",value:"0.0"},{name:"height",type:"float",value:"0.0"},{name:"color",type:"color",value:"0xFFFFFFFF"},{name:"blendingEnabled",type:"boolean",value:"true"}];constructor(e=[],t=$.Rectangle){super([],t),this.name=t,this.setExtendsType(t,$.Group),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(e)}renderNode(e,t,i,s,n){if(!this.isVisible())return;const a=this.getTranslation(),r=0===i?a.slice():C(a,i);r[0]+=t[0],r[1]+=t[1];const o=this.getDimensions(),l=i+this.getRotation(),h=this.getValueJS("color");s*=this.getOpacity();const d=this.getScaleRotateCenter(),u={x:r[0],y:r[1],width:o.width,height:o.height};n?.doDrawRotatedRect(u,h,l,d,s),this.updateBoundingRects(u,t,l),this.renderChildren(e,r,l,s,n),this.updateParentRects(t,i)}}class ae extends R{name;defaultFields=[{name:"itemComponentName",type:"string",value:""},{name:"rowTitleComponentName",type:"string",value:""},{name:"numRows",type:"integer",value:"1"},{name:"numColumns",type:"integer",value:"1"},{name:"rowItemSize",type:"array",value:"[]"},{name:"rowItemSpacing",type:"array",value:"[]"},{name:"rowItemSelected",type:"array",value:"[]"},{name:"rowItemFocused",type:"array",value:"[]"},{name:"jumpToRowItem",type:"array",value:"[]"},{name:"focusXOffset",type:"array",value:"[0,0]"},{name:"rowLabelOffset",type:"array",value:"[[0,0]]"},{name:"rowLabelColor",type:"color",value:"0xffffffff"},{name:"rowLabelFont",type:"font"},{name:"showRowLabel",type:"boolarray",value:"[]"},{name:"rowCounterRightOffset",type:"float",value:"0"},{name:"showRowCounter",type:"boolarray",value:"[]"},{name:"showRowCounterForShortRows",type:"bool",value:"true"},{name:"indefiniteRowItemCount",type:"boolarray",value:"[]"},{name:"variableWidthItems",type:"boolarray",value:"[]"},{name:"rowFocusAnimationStyle",type:"string",value:"floatingFocus"},{name:"vertFocusAnimationStyle",type:"string",value:"fixedFocus"}];focusUri="common:/images/focus_grid.9.png";marginX;marginY;gap;rowItemComps=[[]];rowFocus;rowScrollOffset=[];titleHeight;constructor(t=[],i=$.RowList){super([],i),this.name=i,this.setExtendsType(i,$.ArrayGrid),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t),"FHD"===this.resolution?(this.marginX=33,this.marginY=33):(this.marginX=22,this.marginY=22),this.gap=0,this.setValueSilent("focusBitmapUri",new e.BrsString(this.focusUri)),this.setValueSilent("wrapDividerBitmapUri",new e.BrsString(this.dividerUri));const s=this.getValueJS("vertFocusAnimationStyle");this.wrap="fixedfocuswrap"===s.toLowerCase(),this.numRows=this.getValueJS("numRows"),this.numCols=this.getValueJS("numColumns"),this.rowFocus=[],this.rowScrollOffset=[],this.hasNinePatch=!0,this.focusField="rowListHasFocus";const n=this.getValue("rowLabelFont").createDrawFont();this.titleHeight=n instanceof e.RoFont?n.measureTextHeight():0,this.focusIndex=0,this.rowFocus[0]=0,this.rowScrollOffset[0]=0}setValue(i,s,n=!1,a){const r=i.toLowerCase();if("rowfocusanimationstyle"===r){const e=s.toString().toLowerCase();if(!["fixedfocuswrap","floatingfocus","fixedfocus"].includes(e))return}else if("jumptorowitem"===r&&s instanceof e.RoArray){const e=t(s);"number"==typeof e[0]&&"number"==typeof e[1]&&this.setFocusedItem(e[0],e[1])}else if(["horizfocusanimationstyle","numcolumns"].includes(r))return;super.setValue(i,s,n,a)}setFocusedItem(t,i=-1){if(t<0||t>=this.content.length)return;-1===i&&(i=this.rowFocus[t]??0);const s=this.focusIndex,n=s!==t;n&&super.setValue("itemUnfocused",new e.Int32(s)),this.focusIndex=t,this.rowFocus[t]=i;const a=this.getValueJS("rowFocusAnimationStyle").toLowerCase(),r=void 0===this.rowScrollOffset[t]||null===this.rowScrollOffset[t];r&&(this.rowScrollOffset[t]=0);const o=this.getValueJS("itemSize"),l=this.getRowItemSpacing(t),h=this.getValueJS("rowItemSize"),d=h[0]?.[0]??o[0],u=this.content[t]?.getNodeChildren(),c=u?.length??0;if(c*d+(c-1)*l[0]<=this.sceneRect.width&&"fixedfocus"!==a)this.rowScrollOffset[t]=0;else if("fixedfocuswrap"===a)this.rowScrollOffset[t]=0;else if("fixedfocus"===a)this.rowScrollOffset[t]=i;else if("floatingfocus"===a){const e=Math.floor(this.sceneRect.width/(d+l[0]));n&&r?this.rowScrollOffset[t]=0===i||i<e?0:Math.max(0,i-e+1):n||(i<this.rowScrollOffset[t]?this.rowScrollOffset[t]=i:i>=this.rowScrollOffset[t]+e&&(this.rowScrollOffset[t]=i-e+1))}super.setValue("itemFocused",new e.Int32(t)),super.setValue("rowItemFocused",new e.RoArray([new e.Int32(t),new e.Int32(i)]))}handleUpDown(t){let i,s=!1;if("up"===t)i=-1;else if("down"===t)i=1;else if("rewind"===t)i=-Math.min(Math.ceil(this.content.length/this.numCols)-1,6);else{if("fastforward"!==t)return!1;i=Math.min(Math.ceil(this.content.length/this.numCols)-1,6)}let n=this.focusIndex+i;if(this.wrap&&(n%=this.content.length,n<0&&(n+=this.content.length)),n>=0&&n<this.content.length){const t=this.getValueJS("rowFocusAnimationStyle").toLowerCase(),a=this.focusIndex,r=(this.rowFocus[a]??0)-(this.rowScrollOffset[a]??0);let o;if("floatingfocus"===t){o=(this.rowScrollOffset[n]??0)+r;const e=this.content[n]?.getNodeChildren(),t=e?.length??0;t>0&&(o=Math.max(0,Math.min(o,t-1)))}else o=this.rowFocus[n]??0;const l=new e.RoArray([new e.Int32(n),new e.Int32(o)]);this.currRow+=this.wrap?0:i,this.setValue("jumpToRowItem",l),s=!0}return s}handlePageUpDown(e){return this.handleUpDown(e)}handleLeftRight(e){const t="left"===e?-1:1,i=this.focusIndex,s=this.content[i]?.getNodeChildren(),n=s?.length??0;if(n<=1)return!1;this.rowScrollOffset[i]??=0;const a=this.getRowItemWidth(i),r=this.checkIfAllItemsFitOnScreen(n,a),o=this.getValueJS("rowFocusAnimationStyle").toLowerCase();return r&&"fixedfocus"!==o?this.handleAllItemsFit(i,n,t):"fixedfocuswrap"===o?this.handleFixedFocusWrap(i,n,t):"fixedfocus"===o?this.handleFixedFocus(i,n,t):this.handleFloatingFocus(i,n,a,t)}handleOK(e){if(e&&this.focusIndex>=0&&this.focusIndex<this.rowFocus.length){const e=this.focusIndex,t=this.rowFocus[e];t>=0&&this.setValue("rowItemSelected",n([e,t]))}return!1}getRowItemWidth(e){const t=this.getValueJS("itemSize"),i=this.getValueJS("rowItemSize");let s=e-this.currRow;return this.wrap&&s<0&&(s+=this.content.length),i[s]?.[0]??t[0]}getRowItemSpacing(e){let t=[0,0];const i=this.getValueJS("itemSpacing");return 2===i?.length&&(t=i),this.resolveVector(this.getValueJS("rowItemSpacing"),e,t)}checkIfAllItemsFitOnScreen(e,t){return e*t+(e-1)*this.getRowItemSpacing(this.focusIndex)[0]<=this.sceneRect.width}handleAllItemsFit(t,i,s){let n=this.rowFocus[t]+s;return n=Math.max(0,Math.min(n,i-1)),n!==this.rowFocus[t]&&(this.rowFocus[t]=n,super.setValue("rowItemFocused",new e.RoArray([new e.Int32(t),new e.Int32(n)])),!0)}handleFixedFocusWrap(t,i,s){let n=this.rowFocus[t]+s;return n<0?n=i-1:n>=i&&(n=0),this.rowFocus[t]=n,super.setValue("rowItemFocused",new e.RoArray([new e.Int32(t),new e.Int32(n)])),!0}handleFixedFocus(t,i,s){let n=this.rowFocus[t]+s;return n=Math.max(0,Math.min(n,i-1)),n!==this.rowFocus[t]&&(this.rowFocus[t]=n,this.rowScrollOffset[t]=n,super.setValue("rowItemFocused",new e.RoArray([new e.Int32(t),new e.Int32(n)])),!0)}handleFloatingFocus(t,i,s,n){const a=this.getRowItemSpacing(t),r=Math.floor(this.sceneRect.width/(s+a[0])),o=this.rowFocus[t],l=this.rowScrollOffset[t],h=o-l;let d=!1;if(n>0?d=this.handleFloatingFocusRight(t,i,r,o,l,h):o>0&&(d=this.handleFloatingFocusLeft(t,o,l,h)),d){const i=new e.RoArray([new e.Int32(t),new e.Int32(this.rowFocus[t])]);super.setValue("rowItemFocused",i)}return d}handleFloatingFocusRight(e,t,i,s,n,a){return!(s>=t-1||(a<Math.max(0,i-1)?this.rowFocus[e]=s+1:n+i<t?(this.rowScrollOffset[e]=n+1,this.rowFocus[e]=s+1):this.rowFocus[e]=t-1,0))}handleFloatingFocusLeft(e,t,i,s){return s>0?this.rowFocus[e]=t-1:i>0?(this.rowScrollOffset[e]=i-1,this.rowFocus[e]=t-1):this.rowFocus[e]=0,!0}renderContent(e,t,i,s,n){if(!this.validateRenderPrerequisites())return;const a=this.initializeRenderContext(t,e,i,s,n);this.currRow=this.focusIndex;for(let e=0;e<a.displayRows;e++){const t=this.calculateActualRowIndex(e);if(-1===t)break;if(!this.renderSingleRow(t,e,a))break}this.updateRect(t,a.displayRows,a.itemSize)}validateRenderPrerequisites(){if(0===this.content.length)return!1;this.focusIndex<0&&(this.focusIndex=0);const t=this.getValueJS("itemComponentName");if(!Ae(t))return e.BrsDevice.stderr.write(`warning,[sg.rowlist.create.fail] Failed to create markup item ${t}`),!1;const i=this.getValueJS("itemSize");return!!(i[0]&&i[1]&&this.numRows)}initializeRenderContext(e,t,i,s,n){const a=this.getValueJS("itemSize");return{itemSize:a,globalSpacing:this.getValueJS("itemSpacing"),rowItemSize:this.getValueJS("rowItemSize"),rowHeights:this.getValueJS("rowHeights"),rowSpacings:this.getValueJS("rowSpacings"),displayRows:Math.min(this.content.length,this.numRows),rowItemWidth:a[0],rowItemHeight:a[1],showRowLabel:!0,itemRect:{...e,width:a[0],height:a[1]},interpreter:t,rect:e,rotation:i,opacity:s,draw2D:n}}renderSingleRow(t,i,s){const n=this.content[t],a=this.getContentChildren(n),r=a.length;s.rowItemWidth=s.rowItemSize[i]?.[0]??s.rowItemWidth,s.rowItemHeight=s.rowItemSize[i]?.[1]??s.rowItemHeight;const o=this.getRowItemSpacing(t),l=r*s.rowItemWidth+(r-1)*o[0];if(s.itemRect.width=s.rowItemWidth,s.itemRect.height=s.rowHeights[i]??s.rowItemHeight,this.wrap&&0===t&&i>0){s.itemRect.y=s.itemRect.y-o[1];const e={...s.itemRect,width:l},t=this.renderWrapDivider(e,s.opacity,s.draw2D);s.itemRect.y+=t+o[1]}const h=n.getValueJS("title")??"";if(s.showRowLabel=this.getValueJS("showRowLabel")?.[t]??s.showRowLabel,0!==h.length&&s.showRowLabel){const e={...s.itemRect,width:l},t=this.renderRowDivider(h,e,s.opacity,i,s.draw2D);s.itemRect.y+=t}const d=this.getRowXOffset(i);s.itemRect.x=s.rect.x+d,this.renderRowContent(t,a,r,s.rowItemWidth,o,s.itemRect,s),s.itemRect.x=s.rect.x;const u=this.calculateRowSpacing(i,s.rowSpacings,s.globalSpacing);return s.itemRect.y+=s.itemRect.height+u,(0,e.RectRect)(this.sceneRect,s.itemRect)}getRowXOffset(e){const t=this.getValueJS("focusXOffset");return t&&0!==t.length?t[Math.min(e,t.length-1)]??0:0}renderRowContent(e,t,i,s,n,a,r){const o=i*s+(i-1)*n[0]<=this.sceneRect.width,l=this.getValueJS("rowFocusAnimationStyle").toLowerCase();this.rowScrollOffset[e]??=0;const h=this.determineRenderMode(o,l);this.renderRowItems(e,t,a,n,s,h,r)}calculateRowSpacing(e,t,i){const s=t[e]??i[1],n="FHD"===this.resolution?60:40;return void 0!==s&&0!==s?s:n}calculateActualRowIndex(e){let t=this.currRow+e;if(this.wrap)t>=this.content.length&&(t%=this.content.length),t<0&&(t+=this.content.length);else if(t>=this.content.length||t<0)return-1;return t}determineRenderMode(e,t){return e&&"fixedfocus"!==t?"allItemsFit":"fixedfocuswrap"===t?"wrapMode":"scrollMode"}renderRowItems(e,t,i,s,n,a,r){const o=t.length;let l;l="allItemsFit"===a?0:"wrapMode"===a?this.rowFocus[e]??0:this.rowScrollOffset[e]??0;const h=Math.ceil((this.sceneRect.width+s[0])/(n+s[0])),d="wrapMode"===a?o:Math.min(l+h,o);for(let n=0;n<("wrapMode"===a?o:d-l);n++){let h=l+n;if("wrapMode"===a&&h>=o&&(h%=o),h>=t.length)break;if(this.renderRowItemComponent(r.interpreter,e,h,t,i,r.rotation,r.opacity,r.draw2D),i.x+=i.width+s[0],i.x>this.sceneRect.x+this.sceneRect.width)break}}renderRowItemComponent(t,i,s,n,a,r,o,l){const h=n[s],d=F.focused===this,u=n.length,c=a.width,g=this.getRowItemSpacing(i),m=a.x-s*(c+g[0])+(u-1)*(c+g[0])+c<=this.sceneRect.width;let p=!1;if(p="fixedfocuswrap"!==this.getValueJS("rowFocusAnimationStyle").toLowerCase()||m?this.focusIndex===i&&this.rowFocus[i]===s:this.focusIndex===i&&s===this.rowFocus[i],!this.rowItemComps[i]?.[s]){const e=this.createItemComponent(t,a,h);this.rowItemComps[i]??=[],e instanceof T&&(this.rowItemComps[i][s]=e)}h.changed&&(this.rowItemComps[i][s].setValue("itemContent",h,!0),h.changed=!1);const f=this.rowItemComps[i][s];f&&(f.setValue("itemHasFocus",e.BrsBoolean.from(p)),f.setValue("focusPercent",new e.Float(p?1:0)),f.setValue("rowHasFocus",e.BrsBoolean.from(this.focusIndex===i)),f.setValue("rowFocusPercent",new e.Float(this.focusIndex===i?1:0)),f.setValue(this.focusField,e.BrsBoolean.from(d)));const y=this.getValueJS("drawFocusFeedback"),w=this.getValueJS("drawFocusFeedbackOnTop");p&&y&&!w&&this.renderFocus(a,o,d,l);const S=[a.x,a.y];this.rowItemComps[i][s].renderNode(t,S,r,o,l),p&&y&&w&&this.renderFocus(a,o,d,l)}renderRowDivider(e,t,i,s,n){const a=this.resolveVector(this.getValueJS("rowLabelOffset"),s,[0,0]),r={...t,x:t.x+(a[0]??0),height:this.titleHeight};if(0!==e.length){const t=this.getValue("rowLabelFont"),a=this.getValueJS("rowLabelColor");this.drawText(e,t,a,i,r,"left","center",0,n,"...",s)}return this.titleHeight+(a[1]??0)}refreshContent(){this.content.length=0;const e=this.getValue("content");if(!(e instanceof k))return;const t=this.getContentChildren(e);let i=0;for(const e of t)0!==e.getNodeChildren().length&&(this.rowFocus[i]=0,this.rowScrollOffset[i]=0,i++,this.content.push(e))}}class re extends T{name;defaultFields=[{name:"width",type:"float",value:"0.0"},{name:"height",type:"float",value:"0.0"},{name:"buttonSelected",type:"integer",value:"0",alwaysNotify:!0},{name:"buttonFocused",type:"integer",value:"0",alwaysNotify:!0},{name:"palette",type:"node"},{name:"close",type:"boolean",value:"false"},{name:"wasClosed",type:"boolean",value:"false",alwaysNotify:!0}];dialogBackgroundUri="common:/images/standard_dialog_background.9.png";dialogDividerUri="common:/images/dialog_divider.9.png";background;minHeight;maxWidth;dialogTrans;width;constructor(e=[],t=$.StandardDialog){super([],t),this.name=t,this.setExtendsType(t,$.Group),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(e),"FHD"===this.resolution?(this.width=1038,this.maxWidth=1380,this.minHeight=270,this.dialogTrans=[531,492],this.background=this.addPoster(this.dialogBackgroundUri,[-90,-60],this.width,this.minHeight)):(this.width=692,this.maxWidth=920,this.minHeight=180,this.dialogTrans=[354,328],this.background=this.addPoster(this.dialogBackgroundUri,[-60,-40],this.width,this.minHeight)),this.setTranslation(this.dialogTrans)}setValue(i,s,n=!1,a){const r=i.toLowerCase();"close"===r?(i="wasClosed",s=e.BrsBoolean.True,this.setValue("visible",e.BrsBoolean.False),F.scene?.dialog===this&&(F.scene.dialog=void 0)):"width"===r&&(t(s)>this.maxWidth&&(s=new e.BrsString(this.maxWidth.toString())),this.width=t(s),this.background.setValue("width",s)),super.setValue(i,s,n,a)}renderNode(t,i,s,n,a){if(!this.isVisible())return;const r=this.getTranslation(),o=0===s?r.slice():C(r,s);o[0]+=i[0],o[1]+=i[1];const l=this.getDimensions(),h={x:o[0],y:o[1],width:this.width,height:l.height},d=this.getPaletteColors().get(new e.BrsString("DialogBackgroundColor"));(0,e.isBrsString)(d)&&this.background.setValue("blendColor",d),n*=this.getOpacity(),this.updateBoundingRects(h,i,s),this.renderChildren(t,o,s,n,a),this.updateParentRects(i,s)}getPaletteColors(){let t=this.getValue("palette");if(t instanceof ie||!F.scene||(t=F.scene.getValue("palette")),t instanceof ie){const i=t.getValue("colors");if(i instanceof e.RoAssociativeArray)return i}return r({DialogBackgroundColor:"0x6C6278FF"})}}class oe extends T{name;defaultFields=[{name:"backgroundURI",type:"uri"},{name:"backgroundColor",type:g.Color,value:"0x2F3140FF"},{name:"backExitsScene",type:g.Boolean,value:"true"},{name:"dialog",type:g.Node},{name:"currentDesignResolution",type:g.AssocArray},{name:"palette",type:g.Node}];ui={width:1280,height:720,resolution:"HD"};dialog;subSearch;subReplace;constructor(t=[],i=$.Scene){super([],i),this.name=i,this.setExtendsType(i,$.Group),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t),this.setValueSilent("focusable",e.BrsBoolean.True),this.setDesignResolution("HD",""),this.subSearch="",this.subReplace=""}setValue(t,i,s=!1,n,a=!0){const r=t.toLowerCase();if("dialog"===r)if(i instanceof _||i instanceof re)this.dialog?.setValue("close",e.BrsBoolean.True),this.dialog=i;else{if(!(i instanceof e.BrsInvalid))return;this.dialog?.setValue("close",e.BrsBoolean.True)}super.setValue(t,i,s,n),a&&F.tasks.length>0&&this.changed&&this.fields.has(r)&&(this.sendThreadUpdate(F.taskId,"scene",r,i),F.inTaskThread()&&(this.changed=!1))}cloneNode(t,i){return e.BrsInvalid.Instance}getDimensions(){return{width:this.ui.width,height:this.ui.height}}addObserver(e,t,i,s,n){return e.environment.hostNode??=this,super.addObserver(e,t,i,s,n)}setDesignResolution(e,t){if(["SD","HD","FHD"].includes(e.toUpperCase())&&(this.ui.resolution=e.toUpperCase(),"FHD"===this.ui.resolution?(this.ui.width=1920,this.ui.height=1080):"HD"===this.ui.resolution?(this.ui.width=1280,this.ui.height=720):"SD"===this.ui.resolution&&(this.ui.width=720,this.ui.height=480),this.rectLocal={x:0,y:0,width:this.ui.width,height:this.ui.height},this.rectToParent={x:0,y:0,width:this.ui.width,height:this.ui.height},this.rectToScene={x:0,y:0,width:this.ui.width,height:this.ui.height},this.setValueSilent("currentDesignResolution",r(this.ui)),4===t.split(",").length)){const e=t.split(",");this.subSearch=e[0],"SD"===this.ui.resolution?this.subReplace=e[1]:"HD"===this.ui.resolution?this.subReplace=e[2]:this.subReplace=e[3]}}renderNode(e,t,i,s,n){if(!this.isVisible())return;const a=i+this.getRotation(),r=this.getValueJS("backgroundColor");if(s*=this.getOpacity(),n){n.doClearCanvas(r);const e=this.getBitmap("backgroundUri");if(e?.isValid()){const t=this.ui.width/e.width,i=this.ui.height/e.height;n.doDrawScaledObject(0,0,t,i,e,void 0,s)}}this.renderChildren(e,t,a,s,n)}handleOnKeyEvent(e,t,i){if(!(F.focused instanceof S))return this.handleKeyByNode(e,this,t,i);{const s=this.createPath(F.focused,!1);for(let n of s)if(this.handleKeyByNode(e,n,t,i))return!0}return!1}handleKeyByNode(t,i,s,n){const a=F.nodeDefMap.get(i.nodeSubtype.toLowerCase());if(void 0===a?.environment)return i instanceof T&&i.handleKey(s.value,n.toBoolean());const r=a.environment,o=t.inSubEnv(a=>{a.environment.hostNode=i,a.environment.setRootM(i.m),a.environment.setM(i.m);let r=a.getCallableFunction("onKeyEvent");if(!(r instanceof e.Callable)||""===s.value)return e.BrsBoolean.False;try{const i=r?.getFirstSatisfiedSignature([s,n]);if(i){let{signature:r,impl:o}=i;a.environment.define(e.Scope.Function,r.args[0].name.text,s,t.location),a.environment.define(e.Scope.Function,r.args[1].name.text,n,t.location),o(a,s,n)}}catch(t){if(!(t instanceof e.BlockEnd))throw t;if(t instanceof e.Stmt.ReturnValue)return t.value??e.BrsBoolean.False;throw t}return e.BrsBoolean.False},r),l=o instanceof e.BrsBoolean&&o.toBoolean();return!l&&i instanceof T?i.handleKey(s.value,n.toBoolean()):l}}!function(e){e[e.STATIC=0]="STATIC",e[e.INITIAL_PAUSE=1]="INITIAL_PAUSE",e[e.SCROLLING=2]="SCROLLING",e[e.END_PAUSE=3]="END_PAUSE",e[e.FINISHED=4]="FINISHED"}(W||(W={}));class le extends P{name;defaultFields=[{name:"scrollSpeed",type:"float",value:"100"},{name:"repeatCount",type:"float",value:"-1"},{name:"maxWidth",type:"integer",value:"500"}];scrollState=W.STATIC;scrollOffset=0;elapsedTime=0;currentRepeat=0;needsScrolling=!1;fullTextWidth=0;truncatedText="";ellipsisWidth=0;lastUpdateTime=0;constructor(e=[],t=$.ScrollingLabel){super([],t),this.name=t,this.setExtendsType(t,$.Label),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(e),this.lastUpdateTime=Date.now(),this.checkForScrolling()}setValue(e,t,i=!1){const s=this.getValueJS("visible");if(super.setValue(e,t,i),this.isDirty){const t=e.toLowerCase();(["text","font","maxwidth","scrollspeed","repeatcount","ellipsistext"].includes(t)||s!==this.getValueJS("visible"))&&(this.resetScrollingState(),this.checkForScrolling())}}checkForScrolling(){const t=this.getValue("font"),i=t.createDrawFont();if(!(i instanceof e.RoFont))return;const s=this.getValueJS("text"),n=this.getValueJS("maxWidth"),a=this.getValueJS("ellipsisText")||"...";if(!s||!t||n<=0||!(i instanceof e.RoFont))return this.needsScrolling=!1,void(this.scrollState=W.STATIC);if(this.fullTextWidth=i.measureTextWidth(s).width,this.ellipsisWidth=i.measureTextWidth(a).width,this.fullTextWidth>n){this.needsScrolling=!0;let e=0,t=0;const r=n-this.ellipsisWidth;for(let n=0;n<s.length;n++){const a=i.measureTextWidth(s[n]).width;if(!(e+a<=r))break;e+=a,t=n+1}this.truncatedText=s.substring(0,t)+a,this.scrollState===W.STATIC&&this.resetScrollingState()}else this.needsScrolling=!1,this.scrollState=W.STATIC,this.scrollOffset=0}resetScrollingState(){this.scrollState=this.needsScrolling?W.INITIAL_PAUSE:W.STATIC,this.scrollOffset=0,this.elapsedTime=0,this.currentRepeat=0,this.lastUpdateTime=Date.now(),this.measured=void 0}renderLabel(t,i,s,n){const a=this.getValueJS("text");(this.isDirty||0===this.fullTextWidth&&a)&&this.checkForScrolling();const r=this.getValue("font").createDrawFont();if(!(r instanceof e.RoFont))return{text:a,width:0,height:0,ellipsized:!1};const o=Date.now(),l=o-this.lastUpdateTime;this.lastUpdateTime=o,this.elapsedTime+=l;const h=this.getValueJS("scrollSpeed"),d=this.getValueJS("repeatCount"),u=this.getValueJS("maxWidth"),c=r.measureTextHeight();t.width=u>0?u:t.width,t.height=c;const g=this.getValueJS("color"),m=this.getValueJS("vertAlign")||"top";let p=a,f=0,y=!1;if(this.needsScrolling&&this.scrollState!==W.FINISHED){const e=this.fullTextWidth-u,t=e>0&&h>0?e/h*1e3:0;switch(this.scrollState){case W.INITIAL_PAUSE:p=this.truncatedText,y=!0,this.elapsedTime>=2500&&(this.scrollState=W.SCROLLING,this.elapsedTime=0);break;case W.SCROLLING:p=a,this.scrollOffset=Math.min(e,this.elapsedTime/t*e),f=-this.scrollOffset,this.elapsedTime>=t&&(this.scrollState=W.END_PAUSE,this.elapsedTime=0,this.scrollOffset=e,f=-this.scrollOffset);break;case W.END_PAUSE:p=a,f=-e,this.elapsedTime>=2500&&(this.currentRepeat++,-1!==d&&this.currentRepeat>=d?(this.scrollState=W.FINISHED,p=this.truncatedText,f=0,y=!0):(this.scrollState=W.INITIAL_PAUSE,this.elapsedTime=0,this.scrollOffset=0,p=this.truncatedText,f=0,y=!0))}}else this.scrollState===W.FINISHED?(p=this.truncatedText,y=!0):p=a;const w={...t,width:u};let S=t.x+f,v=t.y;return"center"===m?v+=(t.height-c)/2:"bottom"===m&&(v+=t.height-c),n?.pushClip(w),n?.doDrawRotatedText(p,S,v,g,s,r,i),n?.popClip(),this.setEllipsized(y),{text:p,width:this.needsScrolling?u:this.fullTextWidth,height:c,ellipsized:y}}}class he extends S{name;defaultFields=[{name:"uri",type:"uri"},{name:"control",type:"string",value:"none",alwaysNotify:!0},{name:"state",type:"string",value:"none",alwaysNotify:!0},{name:"loadStatus",type:"string",value:"none",alwaysNotify:!0},{name:"volume",type:"integer",value:"50"}];uri;state;stream;audioId;constructor(e=[],t=$.SoundEffect){super([],t),this.name=t,this.setExtendsType(t,$.Node),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(e),this.uri="",this.state="none",this.stream=-1,this.audioId=-1}setValue(i,s,n=!1,a){const r=i.toLowerCase();if("control"===r&&(0,e.isBrsString)(s)){const t=["play","stop"],r=s.getValue().toLowerCase();if(!t.includes(r)||this.audioId<0)return s=new e.BrsString("none"),void super.setValue(i,s,n,a);"play"===r?this.play():"stop"===r&&this.stop()}else if("uri"===r&&(0,e.isBrsString)(s)){"playing"===this.state&&this.stop();const e=s.getValue().toLowerCase();this.setUri(e)}else if("volume"===r&&(0,e.isBrsNumber)(s)&&(t(s)<0||t(s)>100))return;super.setValue(i,s,n,a)}getAudioId(){return this.audioId}getState(){return this.state}setState(t){switch(this.state="none",t){case e.MediaEvent.StartPlay:this.state="playing";break;case e.MediaEvent.Partial:this.state="stopped",this.stream=-1;break;case e.MediaEvent.Finished:this.state="finished",this.stream=-1;break;case e.MediaEvent.Failed:this.state="notready";break;case e.MediaEvent.TooMany:this.state="toomanysounds"}super.setValue("state",new e.BrsString(this.state))}setUri(t){if(t.startsWith("pkg:")&&e.BrsDevice.fileSystem.existsSync(t)||t.startsWith("http")){this.uri=t;const i=e.BrsDevice.sfx.indexOf(t);i>-1?this.audioId=i:(this.audioId=e.BrsDevice.sfx.length,F.inTaskThread()||postMessage(`sfx,new,${t},${this.audioId}`),e.BrsDevice.sfx.push(t)),super.setValue("loadStatus",new e.BrsString("ready"))}else e.BrsDevice.isDevMode&&e.BrsDevice.stderr.write(`warning,Invalid sound effect URI: ${t}`),this.uri="",this.audioId=-1,super.setValue("loadStatus",new e.BrsString("failed")),this.setState(e.MediaEvent.Failed)}play(){const t=this.getValueJS("volume");this.stream=e.BrsDevice.getSfxStream(this.audioId),-1===this.stream?(e.BrsDevice.isDevMode&&e.BrsDevice.stderr.write(`warning,No available sound effect streams for ${this.uri}`),this.setState(e.MediaEvent.TooMany)):(F.sfx[this.stream]=this,F.inTaskThread()||postMessage(`sfx,trigger,${this.uri},${t},${this.stream}`),this.setState(e.MediaEvent.StartPlay))}stop(){F.inTaskThread()||postMessage(`sfx,stop,${this.uri}`),F.sfx[this.stream]===this&&(F.sfx[this.stream]=void 0),this.setState(e.MediaEvent.Partial)}}class de extends T{name;defaultFields=[{name:"primaryTitle",type:"string",value:""},{name:"primaryIcon",type:"uri"},{name:"primaryIconVertOffset",type:"float",value:"0.0"},{name:"secondaryIcon",type:"uri"},{name:"secondaryIconVertOffset",type:"float",value:"0.0"}];constructor(e=[],t=$.StdDlgTitleArea){super([],t),this.name=t,this.setExtendsType(t,$.Group),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(e)}}class ue extends T{name;constructor(e=[],t=$.StdDlgContentArea){super([],t),this.name=t,this.setExtendsType(t,$.Group),this.registerInitializedFields(e)}}class ce extends T{name;defaultFields=[{name:"text",type:"string",value:""},{name:"scrollable",type:"boolean",value:"false"}];spinner;label;gap;constructor(t=[],i=$.StdDlgProgressItem){super([],i),this.name=i,this.setExtendsType(i,$.Group),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t),this.spinner=new N,this.gap="FHD"===this.resolution?30:20,this.spinner.setValue("control",new e.BrsString("start")),this.appendChildToParent(this.spinner),this.label=new P,this.appendChildToParent(this.label),this.linkField(this.label,"text")}renderNode(t,i,s,n,a){if(!this.isVisible())return;const r=this.getTranslation(),o=0===s?r.slice():C(r,s);o[0]+=i[0],o[1]+=i[1];const l=this.getDimensions(),h={x:o[0],y:o[1],width:l.width,height:l.height},d=this.getPaletteColors(),u=d.get(new e.BrsString("DialogItemColor"));u instanceof e.BrsString&&this.spinner.setBlendColor(u);const c=d.get(new e.BrsString("DialogTextColor"));c instanceof e.BrsString&&this.label.setValueSilent("color",c);const g=this.spinner.getDimensions(),m=this.label.getMeasured();if(g.width>0&&g.height>0){const t=[g.width+this.gap,(g.height-m.height)/2];this.label.setTranslation(t),h.width=g.width+m.width+this.gap,this.setValue("width",new e.Float(h.width))}else m.width>0&&m.height>0&&(h.width=m.width,this.setValue("width",new e.Float(h.width)));n*=this.getOpacity(),this.updateBoundingRects(h,i,s),this.renderChildren(t,o,s,n,a),this.updateParentRects(i,s)}getPaletteColors(){const t=this.getNodeParent();if(t instanceof ue){const e=t.getNodeParent();if(e instanceof re)return e.getPaletteColors()}return new e.RoAssociativeArray([])}}class ge extends re{name;defaultFields=[{name:"title",type:"string",value:""},{name:"message",type:"string",value:""}];progressItem;margin;screenWidth;constructor(e=[],t=$.StandardProgressDialog){super([],t),this.name=t,this.setExtendsType(t,$.StandardDialog),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(e),"FHD"===this.resolution?(this.margin=180,this.screenWidth=1920):(this.margin=120,this.screenWidth=1280);const i=new de;this.appendChildToParent(i);const s=new ue;this.progressItem=new ce,s.appendChildToParent(this.progressItem),this.appendChildToParent(s),this.linkField(this.progressItem,"text","message")}renderNode(i,s,n,a,r){const o=t(this.getValue("title")),l=t(this.getValue("message"));if(""===o){const i=t(this.progressItem.getValue("width"));this.setValue("width",new e.Float(i+this.margin)),this.setTranslationX((this.screenWidth-i)/2)}""===l&&this.setValue("message",new e.BrsString(e.BrsDevice.getTerm("Please wait..."))),super.renderNode(i,s,n,a,r)}}class me extends S{name;defaultFields=[{name:"control",type:"string"},{name:"state",type:"string",value:"init"},{name:"functionName",type:"string"}];taskBuffer;id;active;started;thread;constructor(e=[],t=$.Task){super([],t),this.name=t,this.setExtendsType(t,$.Node),this.id=-1,this.active=!1,this.started=!1,this.thread=!1,this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(e)}setValue(t,i,s=!1,n,a=!0){const r=new Set(["init","run","stop","done"]),o=t.toLowerCase(),l=this.fields.get(o);if(l&&"control"===o&&(0,e.isBrsString)(i)){let e=i.getValue().toLowerCase();return r.has(e)||(e=""),void this.setControlField(l,e,a)}l&&"state"===o&&(0,e.isBrsString)(i)?r.has(i.getValue().toLowerCase())&&l.setValue(i):(super.setValue(t,i,s,n),this.id>=0&&l&&a&&this.changed&&(this.sendThreadUpdate(this.id,"task",o,i,!0),this.changed=!1))}setControlField(t,i,s){const n=this.fields.get("state");if("run"===i)this.active=!0;else if("stop"===i||"done"===i){if(this.started){postMessage(`debug,[task] Posting Task #${this.id} Data to STOP: ${this.nodeSubtype}`);const t={id:this.id,name:this.nodeSubtype,state:e.TaskState.STOP};postMessage(t),this.started=!1}this.active=!1}t.setValue(new e.BrsString(i)),n&&""!==i&&"init"!==i&&(n.setValue(new e.BrsString(i)),this.fields.set("state",n),this.id>=0&&this.thread&&s&&this.sendThreadUpdate(this.id,"task","control",new e.BrsString(i)))}setTaskBuffer(t){this.taskBuffer=new e.SharedObject,this.taskBuffer.setBuffer(t)}getNewEvents(e,t){if(this.taskBuffer&&this.thread){const e=0===t?void 0:t,i=this.taskBuffer.waitVersion(0,e);postMessage(`debug,[task] The thread ${this.id} was awaken with "${i}"`),this.updateTask()}return new Array}checkTask(){const t=this.getValueJS("functionName");if(t&&""!==t.trim()){if(!this.started){this.taskBuffer=new e.SharedObject;const i={id:this.id,name:this.nodeSubtype,state:e.TaskState.RUN,buffer:this.taskBuffer.getBuffer(),tmp:e.BrsDevice.getTmpVolume(),cacheFS:e.BrsDevice.getCacheFS(),m:a(this.m),scene:F.scene?d(F.scene,!1):void 0,render:F.getRenderThread()?.id},s=this.m.elements.get("global");if(s instanceof v){const e=s.getNodeFields(),t=[];for(const[i,s]of e)!s.isHidden()&&s.isPortObserved(this)&&t.push(i);t.length&&i.m&&(i.m.global._observed_=t)}postMessage(`debug,[task] Posting Task #${this.id} Data to RUN: ${this.nodeSubtype}, ${t}`),postMessage(i),this.started=!0}}else this.setValue("control",new e.BrsString("stop"))}updateTask(){const e=this.processUpdateFromOtherThread(),t=this.getValueJS("state");if(!this.thread||"run"!==t)return e;for(const[e,t]of this.getNodeFields()){const i=t.getValue();!t.isHidden()&&i instanceof S&&i.changed&&this.sendThreadUpdate(this.id,"task",e,i,!0)}return e}processUpdateFromOtherThread(){const t=this.taskBuffer?.getVersion()??-1;if(!this.taskBuffer||1!==t)return!1;const i=this.taskBuffer.load(!0);if((0,e.isThreadUpdate)(i)){postMessage(`debug,[task] Received Update at ${this.id} thread from ${this.thread?"Main thread":"Task Thread"}: ${i.id} - ${i.type} - ${i.field}`);const e=this.getNodeToUpdate(i.type);if(!e)return!1;const t=e.getValue(i.field);let s;return s=t instanceof S&&i.value?._node_&&t.address===i.value._address_?h(i.value,t):n(i.value),e.setValue(i.field,s,!1,void 0,!1),!0}return!1}getNodeToUpdate(e){return"global"===e?F.mGlobal:"scene"===e?F.scene:this}}class pe extends T{name;defaultFields=[{name:"currentTimeMarkerBlendColor",type:"color",value:"0xffffffff"},{name:"textColor",type:"color",value:"0xfefefeff"},{name:"thumbBlendColor",type:"color",value:"0xffffffff"},{name:"filledBarBlendColor",type:"color",value:"0xffffffff"},{name:"liveFilledBarBlendColor",type:"color",value:"0xffffffff"},{name:"filledBarImageUri",type:"uri"},{name:"trackBlendColor",type:"color",value:"0xffffffff"},{name:"trackImageUri",type:"uri"}];barW;barH;backBack;barProgress;barTicker;position;remaining;bmpIcons;stateIcon;stateIconTimeout=-1;constructor(t=[],i=$.TrickPlayBar){super([],i),this.name=i,this.setExtendsType(i,$.Group),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t),"FHD"===this.resolution?(this.barH=18,this.barW=1716,this.remaining=this.addLabel("textColor",[1542,36],174,36,36,"top","right")):(this.barH=12,this.barW=1144,this.remaining=this.addLabel("textColor",[1028,24],116,24,24,"top","right"));const s=`common:/images/${this.resolution}/trickplaybar.9.png`;this.backBack=this.addPoster(s,[0,0],this.barW,this.barH),this.barProgress=this.addPoster(s,[0,0],1,this.barH),this.barTicker=this.addPoster(`common:/images/${this.resolution}/trickplayticker.png`,[0,0]),this.barTicker.noScaling=!0,this.position=this.addLabel("textColor",[0,2*this.barH],0,2*this.barH),this.backBack.setValueSilent("opacity",new e.Float(.3)),this.barProgress.setValueSilent("visible",e.BrsBoolean.False),this.barProgress.setValueSilent("blendColor",new e.Int32(1730004479)),this.barTicker.setValueSilent("visible",e.BrsBoolean.False),this.linkField(this.backBack,"blendColor","trackBlendColor"),this.linkField(this.backBack,"uri","trackImageUri"),this.linkField(this.barProgress,"blendColor","filledBarBlendColor"),this.linkField(this.barProgress,"uri","filledBarImageUri"),this.linkField(this.barTicker,"blendColor","currentTimeMarkerBlendColor"),this.setValueSilent("width",new e.Int32(this.barW)),this.bmpIcons=new Map([["skip-right",this.loadBitmap(`common:/images/${this.resolution}/icon_skipAhead.png`)],["skip-left",this.loadBitmap(`common:/images/${this.resolution}/icon_skipBack.png`)],["replay",this.loadBitmap(`common:/images/${this.resolution}/icon_replay.png`)],["ff-x1",this.loadBitmap(`common:/images/${this.resolution}/icon_FFx1.png`)],["ff-x2",this.loadBitmap(`common:/images/${this.resolution}/icon_FFx2.png`)],["ff-x3",this.loadBitmap(`common:/images/${this.resolution}/icon_FFx3.png`)],["rw-x1",this.loadBitmap(`common:/images/${this.resolution}/icon_RWx1.png`)],["rw-x2",this.loadBitmap(`common:/images/${this.resolution}/icon_RWx2.png`)],["rw-x3",this.loadBitmap(`common:/images/${this.resolution}/icon_RWx3.png`)]])}setValue(t,i,s=!1,n){const a=t.toLowerCase();"textcolor"===a?(this.position.setValue("color",i),this.remaining.setValue("color",i)):"visible"===a&&i instanceof e.BrsBoolean&&this.getValueJS("visible")!==i.toBoolean()&&(F.inTaskThread()||postMessage({trickPlayBarVisible:i.toBoolean()})),super.setValue(t,i,s,n)}setPosition(t,i){if(this.position&&t>=0&&i>0){const s=i-t,n=e=>{const t=Math.floor(e/3600),i=Math.floor(e%3600/60),s=Math.floor(e%60),n=`${i.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;return t>0?`${t}:${n}`:n},a=n(t),r=n(s);this.position.setValueSilent("text",new e.BrsString(a)),this.remaining.setValueSilent("text",new e.BrsString(r));const o=t/i*this.backBack.getValueJS("width");this.barProgress.setValueSilent("visible",e.BrsBoolean.from(o>this.barH)),this.barProgress.setValueSilent("width",new e.Int32(o)),this.barTicker.setValueSilent("visible",e.BrsBoolean.True),this.barTicker.setTranslationX(Math.max(o-this.barH,0))}else this.barProgress.setValueSilent("visible",e.BrsBoolean.False),this.barTicker.setValueSilent("visible",e.BrsBoolean.False)}setStateIcon(e,t=-1){0===t&&(this.stateIcon=void 0,this.stateIconTimeout=0),this.stateIcon=this.bmpIcons.get(e),this.stateIcon&&(this.stateIconTimeout=t>0?Date.now()+t:-1)}renderNode(e,t,i,s,n){if(!this.isVisible()||F.inTaskThread())return;const a=this.getTranslation();a[0]+=t[0],a[1]+=t[1];const r=this.getDimensions(),o={x:a[0],y:a[1],width:r.width,height:r.height};if(s*=this.getOpacity(),this.updateBoundingRects(o,t,i),this.renderChildren(e,a,i,s,n),this.stateIcon&&(-1===this.stateIconTimeout||this.stateIconTimeout>Date.now())){const e={x:o.x+(r.width-this.stateIcon.width)/2,y:o.y+this.barH,width:this.stateIcon.width,height:this.stateIcon.height};this.drawImage(this.stateIcon,e,i,s,n)}this.updateParentRects(t,i)}}class fe extends T{name;defaultFields=[{name:"content",type:"node"},{name:"playStartInfo",type:"assocarray"},{name:"licenseStatus",type:"assocarray"},{name:"contentIsPlaylist",type:"boolean",value:"false"},{name:"contentIndex",type:"integer",value:"-1",alwaysNotify:!0},{name:"nextContentIndex",type:"integer",value:"-1"},{name:"control",type:"string",value:"none"},{name:"asyncStopSemantics",type:"boolean",value:"false"},{name:"state",type:"string",value:"none"},{name:"errorCode",type:"integer",value:"0"},{name:"errorMsg",type:"string",value:""},{name:"errorStr",type:"string",value:""},{name:"errorInfo",type:"assocarray"},{name:"decoderStats",type:"assocarray"},{name:"enableDecoderStats",type:"boolean",value:"false"},{name:"playbackActionButtons",type:"array"},{name:"playbackActionButtonSelected",type:"integer",value:"0",alwaysNotify:!0},{name:"playbackActionButtonFocused",type:"integer",value:"0",alwaysNotify:!0},{name:"playbackActionButtonFocusedTextFont",type:"font",value:"font:SmallBoldSystemFont"},{name:"playbackActionButtonUnfocusedTextFont",type:"font",value:"font:SmallSystemFont"},{name:"playbackActionButtonFocusedTextColor",type:"color",value:"0x121212FF"},{name:"playbackActionButtonUnfocusedTextColor",type:"color",value:"0xEFEFEFFF"},{name:"playbackActionButtonFocusIndicatorBlendColor",type:"color"},{name:"subtitleSelectionPreferences",type:"assocarray"},{name:"audioSelectionPreferences",type:"assocarray"},{name:"duration",type:"time",value:"0",alwaysNotify:!0},{name:"loop",type:"boolean",value:"false"},{name:"position",type:"time",value:"0",alwaysNotify:!0},{name:"positionInfo",type:"assocarray"},{name:"clipId",type:"integer",value:"0"},{name:"notificationInterval",type:"time",value:"0.5"},{name:"seek",type:"time"},{name:"seekMode",type:"string",value:"default"},{name:"autoPlayAfterSeek",type:"boolean",value:"true"},{name:"timedMetaData",type:"assocarray"},{name:"timedMetaData2",type:"assocarray"},{name:"timedMetaDataSelectionKeys",type:"array"},{name:"streamInfo",type:"assocarray"},{name:"completedStreamInfo",type:"assocarray"},{name:"timeToStartStreaming",type:"time",value:"0"},{name:"bufferingStatus",type:"assocarray"},{name:"videoFormat",type:"string",value:""},{name:"pauseBufferStart",type:"time",value:"0"},{name:"pauseBufferEnd",type:"time",value:"0"},{name:"pauseBufferPosition",type:"time",value:"0"},{name:"pauseBufferOverflow",type:"boolean",value:"false"},{name:"pauseBufferEpochOffset",type:"double"},{name:"streamingSegment",type:"assocarray"},{name:"downloadedSegment",type:"assocarray"},{name:"enableLiveAvailabilityWindow",type:"boolean",value:"false"},{name:"enableThumbnailTilesDuringLive",type:"boolean",value:"false"},{name:"thumbnailTiles",type:"assocarray"},{name:"trickPlayBackgroundOverlay",type:"uri",value:""},{name:"enableUI",type:"boolean",value:"true"},{name:"enableTrickPlay",type:"boolean",value:"true"},{name:"bifDisplay",type:"node"},{name:"trickPlayBar",type:"node"},{name:"bufferingBar",type:"node"},{name:"bufferingTextColor",type:"color"},{name:"retrievingBar",type:"node"},{name:"retrievingTextColor",type:"color"},{name:"pivotNode",type:"node"},{name:"globalCaptionMode",type:"string",value:"Off"},{name:"suppressCaptions",type:"boolean",value:"false"},{name:"subtitleTrack",type:"string",value:""},{name:"currentSubtitleTrack",type:"string",value:""},{name:"availableSubtitleTracks",type:"array"},{name:"captionStyle",type:"assocarray"},{name:"mute",type:"boolean",value:"false"},{name:"audioTrack",type:"string",value:""},{name:"currentAudioTrack",type:"string",value:""},{name:"availableAudioTracks",type:"array"},{name:"seamlessAudioTrackSelection",type:"boolean",value:"false"},{name:"audioFormat",type:"string",value:""},{name:"supplementaryAudioVolume",type:"integer",value:"50"},{name:"cdnSwitch",type:"array"},{name:"MaxVideoDecodeResolution",type:"vector2d",value:"[0, 0]"},{name:"cgms",type:"integer",value:"0"},{name:"enableScreenSaverWhilePlaying",type:"boolean",value:"false"},{name:"disableScreenSaver",type:"boolean",value:"false"},{name:"contentBlocked",type:"boolean",value:"false"}];titleText;contentTitles;audioTracks=[];subtitleTracks=[];clockText;spinner;pausedIcon;trickPlayBar;backgroundOverlay;lastPressHandled;enableUI;enableTrickPlay;showHeader;showPaused;showTrickPlay;trickPlayPos;seekMode;seekLevel;seekTimeout;statusChanged;seeking;constructor(t=[],i=$.Video){if(super([],i),this.name=i,this.setExtendsType(i,$.Group),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t),this.enableUI=!0,this.enableTrickPlay=!0,this.backgroundOverlay=this.addPoster("common:/images/video_trickplay_overlay.png",[0,0],this.sceneRect.width,this.sceneRect.height),this.backgroundOverlay.setValueSilent("visible",e.BrsBoolean.False),this.linkField(this.backgroundOverlay,"uri","trickPlayBackgroundOverlay"),this.trickPlayBar=new pe,this.trickPlayBar.setValue("visible",e.BrsBoolean.False),this.spinner=new N,this.spinner.setValueSilent("spinInterval",new e.Float(1)),this.spinner.setValueSilent("visible",e.BrsBoolean.False),this.spinner.setValue("control",new e.BrsString("start")),this.appendChildToParent(this.spinner),"FHD"===this.resolution?(this.titleText=this.addScrollingLabel("",[102,60],1020,0,"LargeSystemFont"),this.clockText=this.addLabel("",[1644,60],174,36,36,"top","right"),this.spinner.setTranslation([900,480]),this.pausedIcon=this.addPoster("common:/images/FHD/video_pause.png",[902,483],117,117),this.trickPlayBar.setTranslation([102,948])):(this.titleText=this.addScrollingLabel("",[68,40],680,0,"LargeSystemFont"),this.clockText=this.addLabel("",[1096,40],116,24,24,"top","right"),this.spinner.setTranslation([600,320]),this.pausedIcon=this.addPoster("common:/images/HD/video_pause.png",[602,322],78,78),this.trickPlayBar.setTranslation([68,632])),this.contentTitles=[],this.clockText.setValueSilent("text",new e.BrsString(e.BrsDevice.getTime())),this.setValueSilent("trickPlayBar",this.trickPlayBar),this.appendChildToParent(this.trickPlayBar),this.showHeader=0,this.showPaused=0,this.showTrickPlay=0,this.seekMode="off",this.seekLevel=0,this.seekTimeout=0,this.trickPlayPos=-1,this.seeking=!1,this.statusChanged=!1,this.lastPressHandled="",F.inTaskThread())return;const s=new Q;s.setCallback(()=>{this.clockText.setValue("text",new e.BrsString(e.BrsDevice.getTime()))}),s.setValueSilent("repeat",e.BrsBoolean.True),s.setValue("control",new e.BrsString("start")),this.appendChildToParent(s),this.showUI(!1),postMessage("video,loop,false"),postMessage("video,next,-1"),postMessage("video,mute,false"),postMessage("video,notify,500"),postMessage({videoPlaylist:new Array}),postMessage({supportCaptions:!0}),postMessage({captionMode:e.BrsDevice.deviceInfo.captionMode}),postMessage({captionStyle:new Array}),F.setVideo(this)}get(t){if(!(0,e.isBrsString)(t))throw new Error("RoSGNode indexes must be strings");return t.getValue().toLowerCase()==="globalCaptionMode".toLowerCase()?new e.BrsString(e.BrsDevice.deviceInfo.captionMode):super.get(t)}setValue(i,s,n=!1,r){const o=i.toLowerCase();if("control"===o&&(0,e.isBrsString)(s)){const t=["play","pause","resume","stop","replay","prebuffer","skipcontent"],i=s.getValue().toLowerCase();if(t.includes(i))this.checkContentChanged(),F.inTaskThread()||postMessage(`video,${i}`);else if("none"!==i)return void e.BrsDevice.stderr.write(`warning,${(0,e.getNow)()} [sg.video.cntrl.bad] control field set to invalid value`)}else if("seek"===o&&(0,e.isBrsNumber)(s)){this.checkContentChanged();const e=t(s);F.inTaskThread()||postMessage("video,seek,"+1e3*e)}else if("notificationinterval"===o&&(0,e.isBrsNumber)(s))F.inTaskThread()||postMessage(`video,notify,${Math.round(1e3*t(s))}`);else if("loop"===o&&(0,e.isBrsBoolean)(s))F.inTaskThread()||postMessage(`video,loop,${s.toBoolean()}`);else if("mute"===o&&(0,e.isBrsBoolean)(s))F.inTaskThread()||postMessage(`video,mute,${s.toBoolean()}`);else if("audiotrack"===o&&(0,e.isBrsString)(s))F.inTaskThread()||postMessage(`video,audio,${s.getValue()}`);else if("subtitletrack"===o&&(0,e.isBrsString)(s))F.inTaskThread()||postMessage(`video,subtitle,${s.getValue()}`);else{if("contentisplaylist"===o&&(0,e.isBrsBoolean)(s)){const e=this.getValueJS("contentIsPlaylist"),t=s.toBoolean();super.setValue(i,s,n,r);const a=this.getValue("content");return void(e!==t&&a instanceof k&&this.resetContent(a))}if("content"===o&&s instanceof k)this.resetContent(s);else if("enableui"===o&&(0,e.isBrsBoolean)(s))this.enableUI=s.toBoolean(),this.statusChanged=this.enableUI,this.enableUI||(this.spinner.setValueSilent("visible",e.BrsBoolean.False),this.showUI(!1));else if("enabletrickplay"===o&&(0,e.isBrsBoolean)(s))this.enableTrickPlay=s.toBoolean();else if("globalcaptionmode"===o&&(0,e.isBrsString)(s)){const t=(0,e.parseCaptionMode)(s.getValue());if(!t)return void e.BrsDevice.stderr.write(`warning,${(0,e.getNow)()} [sg.video.mode.set.bad] globalCaptionMode set to bad value '${t}'`);e.BrsDevice.deviceInfo.captionMode=t,F.inTaskThread()||postMessage({captionMode:t})}else"captionstyle"===o&&s instanceof e.RoAssociativeArray&&this.setCaptionStyle(a(s))}super.setValue(i,s,n,r)}setState(t,i){const s=Date.now();this.statusChanged=!0;let n="none";switch(t){case e.MediaEvent.Loading:return this.showUI(!1),this.resetSeeking(),this.showHeader=s+5e3,this.spinner.setValueSilent("visible",e.BrsBoolean.from(this.enableUI)),void this.setBufferingStatus(i);case e.MediaEvent.StartStream:case e.MediaEvent.Resumed:n="playing",this.resetSeeking(),this.spinner.setValueSilent("visible",e.BrsBoolean.False),t===e.MediaEvent.Resumed&&this.showUI(!1);break;case e.MediaEvent.Paused:n="paused",this.spinner.setValueSilent("visible",e.BrsBoolean.False),-1===this.trickPlayPos&&(this.showHeader=s+5e3,this.showTrickPlay=s+5e3,this.showPaused=s+2e3);break;case e.MediaEvent.Partial:n="stopped";break;case e.MediaEvent.Finished:case e.MediaEvent.Full:this.spinner.setValueSilent("visible",e.BrsBoolean.False),this.showUI(!1),n="finished";break;case e.MediaEvent.Failed:this.setErrorFields(i),n="error",F.inTaskThread()||postMessage("video,error")}this.getValue("bufferingStatus")instanceof e.RoAssociativeArray&&this.setValue("bufferingStatus",e.BrsInvalid.Instance),super.setValue("state",new e.BrsString(n))}resetContent(t){F.inTaskThread()||(postMessage({videoPlaylist:this.formatContent(t)}),this.contentTitles.length>0?this.setContentIndex(0):this.titleText.setValueSilent("text",new e.BrsString("")),this.resetSeeking(),this.setValueSilent("currentAudioTrack",new e.BrsString("")),this.setValueSilent("availableAudioTracks",new e.RoArray([])),this.setValueSilent("currentSubtitleTrack",new e.BrsString("")),this.setValueSilent("availableSubtitleTracks",new e.RoArray([])))}setContentIndex(t){t>-1&&t<this.contentTitles.length&&this.titleText.setValue("text",new e.BrsString(this.contentTitles[t])),super.setValue("contentIndex",new e.Int32(t))}setDuration(t){super.setValue("duration",new e.Double(t))}setPosition(t){const i=this.getValueJS("duration")??0;t>=0&&i>0&&(this.trickPlayBar.setPosition(t,i),this.seeking&&(this.spinner.setValueSilent("visible",e.BrsBoolean.False),this.setState(e.MediaEvent.Resumed,0),this.seeking=!1)),super.setValue("position",new e.Double(t))}setCurrentAudioTrack(t){if(t>=0&&t<this.audioTracks.length){const i=this.audioTracks[t];this.setValue("currentAudioTrack",new e.BrsString(i.id))}}setAudioTracks(t){const i=[];if(this.audioTracks.length=0,t.length)for(const e of t){this.audioTracks.push(e);const t={Track:e.id,Language:e.lang,Name:e.name,Format:e.codec,HasAccessibilityDescription:!1,HasAccessibilityEAI:!1};i.push(r(t))}this.setValue("availableAudioTracks",new e.RoArray(i))}setCurrentSubtitleTrack(t){if(t>=0&&t<this.subtitleTracks.length){const i=this.subtitleTracks[t];this.setValue("currentSubtitleTrack",new e.BrsString(i.id))}}setSubtitleTracks(t){const i=[];if(this.subtitleTracks.length=0,t.length)for(const e of t){this.subtitleTracks.push(e);const t={TrackName:e.id,Language:e.lang,Description:e.name,HasAccessibilityDescription:!1,HasAccessibilityCaption:!1,HasAccessibilitySign:!1};i.push(r(t))}this.setValue("availableSubtitleTracks",new e.RoArray(i))}setCaptionStyle(t){const i=[];for(const s in t){const n=s.toLowerCase();if(n.includes("/")&&e.CaptionOptions.has(n)){const a=t[s];"string"==typeof a&&e.CaptionOptions.get(n)?.includes(a.toLowerCase())?i.push({id:n,style:a.toLowerCase()}):e.BrsDevice.stderr.write(`warning,${(0,e.getNow)()} [sg.video.cap.val.err] caption style '${a}' is not a valid '${s}'. Using default.`)}else e.BrsDevice.stderr.write(`warning,${(0,e.getNow)()} [sg.video.cap.attr.err] caption style '${s}' is invalid`)}i.length>0?F.inTaskThread()||postMessage({captionStyle:i}):e.BrsDevice.stderr.write(`warning,${(0,e.getNow)()} [sg.video.cap.empty] caption style is empty or invalid. Using default.`)}setBufferingStatus(t){super.setValue("state",new e.BrsString("buffering"));const i={percentage:t,isUnderrun:!1,prebufferDone:t>33,actualStart:0};this.setValue("bufferingStatus",r(i))}setErrorFields(t){let i="",s={clipId:this.getValueJS("contentIndex"),ignored:!1,source:"buffer:reader",category:"",errCode:t,dbgmsg:"",drmerrcode:0};switch(t){case e.MediaErrorCode.Http:i="Network or HTTP error",s.category="http";break;case e.MediaErrorCode.TimeOut:i="Connection timed out",s.category="http";break;case e.MediaErrorCode.Unknown:i="Unknown/unspecified or generic error",s.category="mediaplayer";break;case e.MediaErrorCode.EmptyList:i="Empty list; no streams were specified to play",s.category="mediaplayer";break;case e.MediaErrorCode.Unsupported:i="Media error; the media format is unknown or unsupported",s.category="mediaerror";break;case e.MediaErrorCode.DRM:i="DRM error",s.category="drm"}if(t<0&&i.length){s.dbgmsg=i;const n=`category:${s.category}:error:${t}:ignored:0:source:buffer:reader:message:${i}`;super.setValue("errorCode",new e.Int32(t)),super.setValue("errorMsg",new e.BrsString(i)),super.setValue("errorStr",new e.BrsString(n)),super.setValue("errorInfo",r(s))}}showUI(t){if(F.inTaskThread())return;t||(this.showHeader=0,this.showPaused=0,this.showTrickPlay=0);const i=Date.now();this.backgroundOverlay.setValueSilent("visible",e.BrsBoolean.from(this.showHeader>i)),this.titleText.setValue("visible",e.BrsBoolean.from(this.showHeader>i)),this.clockText.setValueSilent("visible",e.BrsBoolean.from(this.showHeader>i)),this.pausedIcon.setValueSilent("visible",e.BrsBoolean.from(this.showPaused>i)),this.trickPlayBar.setValue("visible",e.BrsBoolean.from(this.showTrickPlay>i))}handleKey(t,i){if(F.inTaskThread())return!1;if(!i&&this.lastPressHandled===t)return this.lastPressHandled="",!0;let s=!1;if("play"===t&&this.enableTrickPlay){const t=this.getValueJS("state");"paused"===t?(this.trickPlayPos>=0?(postMessage("video,seek,"+1e3*this.trickPlayPos),this.trickPlayPos=-1,this.spinner.setValueSilent("visible",e.BrsBoolean.from(this.enableUI)),this.seeking=!0,this.showUI(!1)):postMessage("video,resume"),s=!0):"playing"===t&&(postMessage("video,pause"),s=!0)}else if("OK"===t&&this.enableTrickPlay){const t=Date.now();this.showHeader<t&&(this.showHeader=t+5e3,s=!0),this.trickPlayPos>=0&&(postMessage("video,seek,"+1e3*this.trickPlayPos),this.trickPlayPos=-1,this.spinner.setValueSilent("visible",e.BrsBoolean.from(this.enableUI)),this.showUI(!1),this.seeking=!0,s=!0)}else if("replay"===t&&this.enableTrickPlay){if("playing"===this.getValueJS("state")){const e=this.getValueJS("position");if(e>0){const t=Date.now();postMessage("video,seek,"+1e3*Math.max(0,e-20)),this.showHeader=t+1e3,this.showTrickPlay=t+1e3,this.trickPlayBar.setStateIcon("replay",500),s=!0}}}else"left"!==t&&"right"!==t||!this.enableTrickPlay?"rewind"!==t&&"fastforward"!==t||!this.enableTrickPlay||(s=this.handleRewFastForward(t)):s=this.handleLeftRight(t);return this.lastPressHandled=s?t:"",s}handleLeftRight(e){const t=this.getValueJS("duration");if(t<=0)return!1;if("paused"!==this.getValueJS("state")&&postMessage("video,pause"),this.trickPlayPos<0)this.seekMode="skip",this.seekLevel=1,this.seekTimeout=0,this.trickPlayPos=this.getValueJS("position");else if("skip"!==this.seekMode)return this.seekMode="skip",this.seekLevel=1,this.seekTimeout=0,this.trickPlayBar.setStateIcon("",0),!0;return this.updateSeekStep("right"===e,t),this.trickPlayBar.setStateIcon(`skip-${e}`,500),!0}handleRewFastForward(e){const t=this.getValueJS("duration");if(t<=0)return!1;"paused"!==this.getValueJS("state")&&postMessage("video,pause");const i="rewind"===e?"rw":"ff";if(this.trickPlayPos<0)this.seekMode=i,this.seekLevel=1,this.trickPlayPos=this.getValueJS("position");else if("skip"===this.seekMode)this.seekMode=i,this.seekLevel=1;else{if(this.seekMode!==i)return this.seekMode="skip",this.seekLevel=1,this.seekTimeout=0,this.trickPlayBar.setStateIcon("",0),!0;this.seekLevel=Math.min(3,this.seekLevel+1)}return this.updateSeekStep("ff"===i,t,Math.trunc(1e3/this.seekLevel)),this.trickPlayBar.setStateIcon(`${this.seekMode}-x${this.seekLevel}`),!0}updateSeekStep(e,t,i=0){const s=Date.now(),n=Math.min(10,Math.max(1,Math.trunc(t/30)))*Math.max(1,3*this.seekLevel-3);this.showHeader=s+3e4,this.showTrickPlay=s+3e4;const a=e?this.trickPlayPos+n:this.trickPlayPos-n;this.trickPlayPos=Math.max(0,Math.min(a,t)),this.trickPlayBar.setPosition(this.trickPlayPos,t),i>0&&(this.seekTimeout=s+i)}renderNode(e,t,i,s,n){if(!this.isVisible()||F.inTaskThread())return;const a=this.getTranslation(),r=0===i?a.slice():C(a,i);r[0]+=t[0],r[1]+=t[1];const o=this.getDimensions(),l={x:r[0],y:r[1],width:o.width||this.sceneRect.width,height:o.height||this.sceneRect.height},h=i+this.getRotation();if(s*=this.getOpacity(),this.isDirty&&(postMessage(`video,rect,${l.x},${l.y},${l.width},${l.height}`),this.isDirty=!1),n?.doDrawClearedRect(l),this.statusChanged){if(this.seekTimeout>0&&this.seekTimeout<Date.now()&&["rw","ff"].includes(this.seekMode)){const e=this.getValueJS("duration");this.updateSeekStep("ff"===this.seekMode,e,Math.trunc(1e3/this.seekLevel))}this.showUI(this.enableUI)}this.updateBoundingRects(l,t,h),this.renderChildren(e,r,h,s,n),this.updateParentRects(t,i)}resetSeeking(){this.seekMode="off",this.trickPlayPos=-1,this.seeking=!1,this.seekLevel=0,this.seekTimeout=0,this.trickPlayBar.setStateIcon("",0)}checkContentChanged(){const e=this.getValue("content");e instanceof k&&e.changed&&(this.resetContent(e),e.changed=!1)}formatContent(t){const i=[];if(this.contentTitles.length=0,this.getValueJS("contentIsPlaylist")){const s=t.getNodeChildren().filter(e=>e instanceof S);for(const t of s){const s=t.getValueJS("url");if(s?.length){const n={url:s,streamFormat:t.getValueJS("streamFormat"),audioTrack:-1};s.startsWith("http")&&(n.url=e.BrsDevice.getCORSProxy(s)),this.contentTitles.push(t.getValueJS("title")??""),i.push(n)}}}else{const s=t.getValueJS("url");if(s?.length){const n={url:s,streamFormat:t.getValueJS("streamFormat"),audioTrack:-1};s.startsWith("http")&&(n.url=e.BrsDevice.getCORSProxy(s)),this.contentTitles.push(t.getValueJS("title")??""),i.push(n)}}return i}}class ye extends R{name;defaultFields=[{name:"itemComponentName",type:"string",value:""},{name:"numRows",type:"integer",value:"12"},{name:"numColumns",type:"integer",value:"1"},{name:"rowWidth",type:"float",value:"0.0"},{name:"rowHeight",type:"floatarray",value:"[]"},{name:"rowZoomHeight",type:"floatarray",value:"[]"},{name:"spacingAfterRow",type:"float",value:"0.0"},{name:"rowItemYOffset",type:"array",value:"[]"},{name:"rowItemZoomYOffset",type:"array",value:"[]"},{name:"rowItemHeight",type:"floatarray",value:"[]"},{name:"rowItemZoomHeight",type:"floatarray",value:"[]"},{name:"rowItemAspectRatio",type:"floatarray",value:"[]"},{name:"spacingAfterRowItem",type:"floatarray",value:"[]"},{name:"useDefaultAspectRatio",type:"boolarray",value:"[]"},{name:"showRowTitle",type:"boolarray",value:"[]"},{name:"rowTitleOffset",type:"array",value:"[]"},{name:"rowTitleFont",type:"font",value:"font:SmallestSystemFont"},{name:"rowTitleColor",type:"array",value:"[]"},{name:"showRowCounter",type:"boolarray",value:"[]"},{name:"rowCounterOffset",type:"array",value:"[]"},{name:"rowCounterFont",type:"font",value:"font:SmallestSystemFont"},{name:"rowCounterColor",type:"array",value:"[]"},{name:"showRowCounterForShortRows",type:"bool",value:"true"},{name:"rowDecorationComponentName",type:"array",value:"[]"},{name:"rowFocusAnimationStyle",type:"string",value:"fixedFocusWrap"},{name:"wrap",type:"boolean",value:"true"},{name:"drawFocusFeedbackOnTop",type:"boolean",value:"true"},{name:"rowSelected",type:"integer",value:"-1",alwaysNotify:!0},{name:"rowFocused",type:"integer",value:"-1",alwaysNotify:!0},{name:"rowUnfocused",type:"integer",value:"-1",alwaysNotify:!0},{name:"rowItemSelected",type:"array",value:"[]",alwaysNotify:!0},{name:"rowItemFocused",type:"array",value:"[]",alwaysNotify:!0},{name:"scrollingStatus",type:"boolean",value:"false",alwaysNotify:!0},{name:"rowsRendered",type:"array",value:"[]",alwaysNotify:!0},{name:"rowItemsRendered",type:"array",value:"[]",alwaysNotify:!0},{name:"currFocusRow",type:"float",value:"-1.0",alwaysNotify:!0},{name:"jumpToRow",type:"integer",value:"-1",alwaysNotify:!0},{name:"jumpToRowItem",type:"array",value:"[]",alwaysNotify:!0},{name:"animateToRow",type:"integer",value:"-1",alwaysNotify:!0},{name:"remainZoomedAboveFocus",type:"string",value:"focusIsAtTop"},{name:"fadeOutAboveFocus",type:"string",value:"focusIsAtTop"}];focusUri="common:/images/focus_grid.9.png";marginX;marginY;gap;rowItemComps=[[]];rowFocus=[];defaultAspectRatio=16/9;defaultRowHeight;defaultRowZoomHeight;defaultItemSpacing;defaultRowSpacing;defaultItemYOffset;defaultItemZoomYOffset;nodeWidth;rowWidth;constructor(t=[],i=$.ZoomRowList){super([],i),this.name=i,this.setExtendsType(i,$.ArrayGrid),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(t),this.setValueSilent("focusBitmapUri",new e.BrsString(this.focusUri)),this.setValueSilent("wrapDividerBitmapUri",new e.BrsString(this.dividerUri)),"FHD"===this.resolution?(this.marginX=18,this.marginY=18,this.defaultRowHeight=204,this.defaultRowZoomHeight=321,this.defaultRowSpacing=80,this.defaultItemSpacing=21,this.setValueSilent("wrapDividerHeight",new e.Float(54))):(this.marginX=12,this.marginY=12,this.defaultRowHeight=214,this.defaultRowZoomHeight=136,this.defaultRowSpacing=53,this.defaultItemSpacing=14,this.setValueSilent("wrapDividerHeight",new e.Float(36))),this.gap=this.marginX/2,this.defaultItemYOffset=0,this.defaultItemZoomYOffset=0,this.hasNinePatch=!0,this.focusField="zoomRowListHasFocus",this.wrap=!0,this.focusIndex=0,this.rowFocus[0]=0,this.nodeWidth=this.sceneRect.width,this.rowWidth=0}setValue(i,s,n=!1,a){const r=i.toLowerCase();if("content"===r)return super.setValue(i,s,n,a),this.rowItemComps.length=0,this.rowItemComps.push([]),this.refreshContent(),void(this.content.length>0&&this.setFocusedItem(0));if(["jumptorow","animatetorow"].includes(r)&&(0,e.isBrsNumber)(s)){const e=t(s);Number.isFinite(e)&&e>=0&&this.setFocusedRow(Math.floor(e))}else if("jumptorowitem"===r&&s instanceof e.RoArray){const e=t(s);"number"==typeof e[0]&&"number"==typeof e[1]&&this.setFocusedItem(e[0],e[1])}else"wrap"===r&&s instanceof e.BrsBoolean?this.wrap=s.toBoolean():"rowwidth"===r&&(0,e.isBrsNumber)(s)&&(this.rowWidth=t(s));super.setValue(i,s,n,a)}setFocusedRow(e){e<0||e>=this.content.length||this.setFocusedItem(e,this.rowFocus[e]??0)}setFocusedItem(t,i=-1){if(0===this.content.length)return;if(t<0||t>=this.content.length)return;const s=this.getRowContent(t).length;-1===i&&(i=this.rowFocus[t]??0),i=s>0?Math.max(0,Math.min(i,s-1)):0;const n=this.focusIndex;n!==t&&super.setValue("rowUnfocused",new e.Int32(n)),this.focusIndex=t,this.rowFocus[t]=i,this.currRow=t,super.setValue("rowFocused",new e.Int32(t)),super.setValue("rowItemFocused",new e.RoArray([new e.Int32(t),new e.Int32(i)])),super.setValue("currFocusRow",new e.Float(t))}handleUpDown(t){let i=!1,s=0;if("up"===t)s=-1;else if("down"===t)s=1;else if("rewind"===t)s=-Math.min(this.content.length-1,6);else{if("fastforward"!==t)return!1;s=Math.min(this.content.length-1,6)}let n=this.focusIndex+s;if(this.wrap){if(0===this.content.length)return!1;n=(n+this.content.length)%this.content.length}return n>=0&&n<this.content.length&&(super.setValue("scrollingStatus",e.BrsBoolean.True),this.focusIndex=n,this.rowFocus[n]??=0,this.setFocusedItem(n,this.rowFocus[n]),super.setValue("currFocusRow",new e.Float(n)),i=!0),super.setValue("scrollingStatus",e.BrsBoolean.False),i}handlePageUpDown(e){return this.handleUpDown(e)}handleLeftRight(t){const i="left"===t?-1:1,s=this.focusIndex,n=this.getRowContent(s).length;if(0===n)return!1;this.rowFocus[s]??=0;let a=this.rowFocus[s]+i;const r=this.canWrapItems(n,this.getRowMetrics(s),this.nodeWidth);return a<0?a=r?(n+a)%n:0:a>=n&&(a=r?a%n:n-1),a!==this.rowFocus[s]&&(this.rowFocus[s]=a,super.setValue("rowItemFocused",new e.RoArray([new e.Int32(s),new e.Int32(a)])),super.setValue("scrollingStatus",e.BrsBoolean.True),super.setValue("scrollingStatus",e.BrsBoolean.False),!0)}handleOK(t){if(t&&this.focusIndex>=0&&this.focusIndex<this.rowFocus.length){const t=this.focusIndex,i=this.rowFocus[t]??0;super.setValue("rowItemSelected",n([t,i])),super.setValue("rowSelected",new e.Int32(t))}return!1}renderContent(t,i,s,n,a){if(!this.validateRenderPrerequisites())return;const r=this.content.length;if(0===r)return;const o=this.canWrapRows(r),l=o?this.normalizeRowIndex(this.focusIndex):this.clampRowIndex(this.focusIndex);this.currRow=l;let h=i.y,d=-1,u=-1;const c=[];for(let g=0;g<r;g++){let m=o?this.normalizeRowIndex(l+g):l+g;if(!o&&m>=r)break;const p=this.getRowMetrics(m),f=this.sceneRect.x+this.sceneRect.width;this.nodeWidth=f-i.x,this.rowWidth<=0&&this.refreshRowWidth(this.nodeWidth);let y=h;if(o&&0===m&&g>0){y-=.3*p.spacingY;const e={x:i.x,y,width:this.rowWidth,height:Math.max(p.spacingY,1)};y+=this.renderWrapDivider(e,n,a)+.3*p.spacingY}const w={x:i.x,y,width:this.rowWidth,height:p.rowHeight},S=this.renderRow(t,m,w,p,s,n,a);if(S&&c.push(new e.Int32(S[0]),new e.Int32(S[1]),new e.Int32(S[2])),d=-1===d?m:d,u=m,h=y+p.rowHeight+p.spacingY,this.sceneRect.height>0&&h>this.sceneRect.y+this.sceneRect.height)break}if(-1!==d){const t=new e.RoArray([new e.Int32(d),new e.Int32(u)]);this.setValueSilent("rowsRendered",t)}c.length&&this.setValueSilent("rowItemsRendered",new e.RoArray(c))}validateRenderPrerequisites(){if(0===this.content.length)return!1;this.focusIndex<0&&(this.focusIndex=0);const t=this.getValueJS("itemComponentName");return!!Ae(t)||(e.BrsDevice.stderr.write(`warning,[sg.zoomrowlist.create.fail] Failed to create item ${t}`),!1)}refreshContent(){this.content.length=0;const e=this.getValue("content");if(!(e instanceof k))return;const t=this.getContentChildren(e);for(const[e,i]of t.entries())0!==i.getNodeChildren().length&&(this.rowFocus[e]??=0,this.content.push(i));if(0===this.content.length)return this.focusIndex=0,void(this.currRow=0);this.focusIndex>=this.content.length&&(this.focusIndex=this.content.length-1);const i=this.canWrapRows(this.content.length);this.currRow=i?this.normalizeRowIndex(this.focusIndex):this.clampRowIndex(this.focusIndex)}renderRow(e,t,i,s,n,a,r){const o=this.getRowContent(t);if(0===o.length)return;const l=this.renderRowTitle(t,i,this.nodeWidth,a,r),h=this.renderRowCounter(t,i,s,this.nodeWidth,a,r),d=i.y+Math.max(l,h)+s.itemYOffset,u={x:i.x,y:d,width:s.itemWidth,height:s.itemHeight},c=this.canWrapItems(o.length,s,this.nodeWidth);let g=c?this.rowFocus[t]??0:0;const m=this.getMaxVisibleItems(s.itemWidth,s.spacingX,this.nodeWidth),p=c?o.length:Math.min(g+m,o.length);let f=-1,y=-1;for(let l=0;l<(c?o.length:p-g);l++){let h=g+l;if(c&&h>=o.length&&(h%=o.length),h>=o.length)break;if(this.renderRowItemComponent(e,[t,h],o,u,n,a,r),f=-1===f?h:f,y=h,u.x+=u.width+s.spacingX,u.x>i.x+this.nodeWidth)break}return-1!==f?[t,f,y]:void 0}getRowContent(e){const t=this.content[e];return this.getContentChildren(t)}getMaxVisibleItems(e,t,i,s=!0){if(e<=0)return 1;const n=i>0?i:this.sceneRect.width;return n<=0?1:s?Math.ceil((n+t)/(e+t)):Math.floor((n+t)/(e+t))}canWrapRows(e){return this.wrap&&e>0&&this.content.length>=e}canWrapItems(e,t,i){const s=i>0?i:this.sceneRect.width,n=e*t.itemWidth+(e-1)*t.spacingX;return!(s>0&&n<=s)}normalizeRowIndex(e){const t=this.content.length;if(0===t)return 0;let i=e%t;return i<0&&(i+=t),i}clampRowIndex(e){return 0===this.content.length?0:Math.max(0,Math.min(e,this.content.length-1))}getRowItemSpacing(e){const t=this.defaultItemSpacing,i=this.getValueJS("spacingAfterRowItem");if(Array.isArray(i)&&i.length>0){const t=Math.min(e,i.length-1),s=Number(i[t]);if(Number.isFinite(s)&&s>0)return s}return t}refreshRowWidth(e){const t=this.getValueJS("rowWidth");if("number"==typeof t&&t>0)return this.rowWidth=t,t;const i=this.resolveNumber(this.getValueJS("rowItemHeight"),0,this.defaultRowHeight)*this.resolveNumber(this.getValueJS("rowItemAspectRatio"),0,this.defaultAspectRatio),s=this.getRowItemSpacing(0),n=this.getMaxVisibleItems(i,s,e,!1);return this.rowWidth=(i+s)*n,this.rowWidth}getRowMetrics(e){const t=this.focusIndex===e?1:0,i=this.resolveNumber(this.getValueJS("rowHeight"),e,this.defaultRowHeight),s=this.resolveNumber(this.getValueJS("rowZoomHeight"),e,this.defaultRowZoomHeight),n=this.lerp(i,s,t),a=this.resolveNumber(this.getValueJS("rowItemHeight"),e,this.defaultRowHeight),r=this.resolveNumber(this.getValueJS("rowItemZoomHeight"),e,this.defaultRowZoomHeight),o=this.lerp(a,r,t),l=o>0?o:Math.max(a,1),h=this.resolveNumber(this.getValueJS("rowItemAspectRatio"),e,this.defaultAspectRatio),d=this.getRowItemSpacing(e),u=this.getValueJS("spacingAfterRow"),c=u>0?u:this.defaultRowSpacing,g=this.resolveNumber(this.getValueJS("rowItemYOffset"),e,this.defaultItemYOffset),m=this.resolveNumber(this.getValueJS("rowItemZoomYOffset"),e,this.defaultItemZoomYOffset),p=this.lerp(g,m,t);let f=h>0?h:this.defaultAspectRatio;if(!this.resolveBoolean(this.getValueJS("useDefaultAspectRatio"),e,!0)){const t=this.getRowContent(e);if(t.length){const e=t[0].getValueJS("aspectRatio");"number"==typeof e&&e>0&&(f=e)}}const y=l*f;return{rowHeight:Math.max(n,p+l),itemHeight:l,itemWidth:y,spacingX:d,spacingY:c,itemYOffset:p,focusPercent:t}}renderRowItemComponent(t,i,s,a,r,o,l){const h=i[0],d=i[1],u=s[d],c=F.focused===this,g=this.focusIndex===h&&this.rowFocus[h]===d;if(!this.rowItemComps[h]?.[d]){const e=this.createItemComponent(t,a,u);this.rowItemComps[h]??=[],e instanceof T&&(this.rowItemComps[h][d]=e)}u.changed&&(this.rowItemComps[h][d].setValue("itemContent",u,!0),u.changed=!1);const m=this.rowItemComps[h][d];m&&(m.setValue("itemHasFocus",e.BrsBoolean.from(g)),m.setValue("focusPercent",new e.Float(g?1:0)),m.setValue("rowHasFocus",e.BrsBoolean.from(this.focusIndex===h)),m.setValue("rowFocusPercent",new e.Float(this.focusIndex===h?1:0)),m.setValue(this.focusField,e.BrsBoolean.from(c)),m.setValueSilent("width",n(a.width)),m.setValueSilent("height",n(a.height)));const p=this.getValueJS("drawFocusFeedback"),f=this.getValueJS("drawFocusFeedbackOnTop");g&&p&&!f&&this.renderFocus(a,o,c,l);const y=[a.x,a.y];this.rowItemComps[h][d].renderNode(t,y,r,o,l),g&&p&&f&&this.renderFocus(a,o,c,l)}renderRowTitle(t,i,s,n,a){if(!this.resolveBoolean(this.getValueJS("showRowTitle"),t,!0))return 0;const r=this.content[t].getValueJS("title")??"";if(!r)return 0;const o=this.getValueJS("rowTitleOffset"),l=this.resolveVector(o,t,[0,0]),h=this.resolveColor(this.getValueJS("rowTitleColor"),t,4294967295),d=this.getValue("rowTitleFont");if(!(d instanceof K))return 0;const u=d.createDrawFont();if(!(u instanceof e.RoFont))return 0;const c={x:i.x+l[0],y:i.y+l[1],width:s,height:u.measureTextHeight()+this.gap};return this.drawText(r,d,h,n,c,"left","top",0,a,"",t+1),c.height+l[1]}renderRowCounter(t,i,s,n,a,r){const o=this.resolveBoolean(this.getValueJS("showRowCounter"),t,!1),l=this.content[t].getNodeChildren().length;if(!o&&t!==this.focusIndex)return 0;if(0===l)return 0;const h=this.getValueJS("showRowCounterForShortRows")??!0,d=l*s.itemWidth+(l-1)*s.spacingX;if(!h&&d<n)return 0;const u=this.getValueJS("rowCounterOffset"),c=this.resolveVector(u,t,[0,0]),g=this.resolveColor(this.getValueJS("rowCounterColor"),t,4294967295),m=this.getValue("rowCounterFont");let p;if(m instanceof K)p=m;else{const e=this.getValue("rowTitleFont");e instanceof K&&(p=e)}if(!p)return 0;const f=p.createDrawFont();if(!(f instanceof e.RoFont))return 0;const y=`${this.rowFocus[t]+1} of ${l}`,w={x:i.x,y:i.y+c[1],width:c[0]||this.rowWidth,height:f.measureTextHeight()+this.gap};return this.drawText(y,p,g,a,w,"right","top",0,r,"",0),w.height+c[1]}lerp(e,t,i){return!Number.isFinite(e)&&Number.isFinite(t)?t:Number.isFinite(e)&&!Number.isFinite(t)?e:Number.isFinite(e)||Number.isFinite(t)?e+(t-e)*i:0}}class we extends S{defaultFields=[{name:"control",type:"string",value:"none"},{name:"state",type:"string",value:"stopped",system:!0},{name:"repeat",type:"boolean",value:"false"},{name:"delay",type:"float",value:"0"}];_state="stopped";lastUpdateTime=0;elapsedTime=0;delayRemaining=0;constructor(e=[],t=$.AnimationBase){super([],t),this.setExtendsType(t,$.Node),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(e),this.delayRemaining=this.getDelaySeconds()}setValue(t,i,s=!1,n){const a=t.toLowerCase(),r=this.fields.get(a);if(r&&"control"===a&&(0,e.isBrsString)(i)){const t=i.getValue().toLowerCase();return this.handleControl(t),r.setValue(new e.BrsString(t)),void this.fields.set(a,r)}super.setValue(t,i,s,n)}handleControl(e){switch(e){case"start":this.startFromBeginning();break;case"stop":case"none":this.stop();break;case"pause":this.pause();break;case"resume":"paused"===this._state?this.resumeFromPause():this.startFromBeginning();break;case"finish":this.finishImmediately()}}stop(){this._state="stopped",this.elapsedTime=0,this.delayRemaining=this.getDelaySeconds(),this.updateStateField("stopped"),this.dequeue()}tick(){if("running"!==this._state)return!1;const e=performance.now(),t=(e-this.lastUpdateTime)/1e3;this.lastUpdateTime=e;let i=t;if(this.delayRemaining>0){if(this.delayRemaining-=t,this.delayRemaining>0)return!1;i=Math.abs(this.delayRemaining),this.delayRemaining=0}this.elapsedTime+=i;const s=this.getDurationSeconds(),n=s>0?Math.min(this.elapsedTime/s,1):1,a=this.shapeFraction(Math.min(Math.max(n,0),1));return this.updateAnimation(a),(s<=0||this.elapsedTime>=s)&&(this.shouldRepeat()?(this.elapsedTime=0,this.delayRemaining=this.getDelaySeconds(),this.lastUpdateTime=performance.now()):this.stop()),!0}shapeFraction(e){return e}getDurationSeconds(){return 0}shouldRepeat(){return Boolean(this.getValueJS("repeat"))}getDelaySeconds(){const e=this.getValueJS("delay");return"number"==typeof e&&e>0?e:0}startFromBeginning(){this.elapsedTime=0,this.delayRemaining=this.getDelaySeconds(),this.lastUpdateTime=performance.now(),this.enterRunningState()}resumeFromPause(){this.lastUpdateTime=performance.now(),this.enterRunningState()}pause(){"running"===this._state&&(this._state="paused",this.updateStateField("paused"),this.dequeue())}finishImmediately(){const e=this.shapeFraction(1);this.updateAnimation(e),this.stop()}enterRunningState(){this._state="running",this.updateStateField("running"),this.enqueue()}enqueue(){F.animations.includes(this)||F.animations.push(this)}dequeue(){const e=F.animations.indexOf(this);e>-1&&F.animations.splice(e,1)}updateStateField(t){const i=this.fields.get("state");i&&(i.setValue(new e.BrsString(t)),this.fields.set("state",i))}}class Se extends S{defaultFields=[{name:"fieldToInterp",type:"string"},{name:"key",type:"floatarray",value:"[]"},{name:"fraction",type:"float",value:"0.0"},{name:"reverse",type:"boolean",value:"false"}];constructor(e=[],t=$.Node){super([],t),this.setExtendsType(t,$.Node),this.registerDefaultFields(this.defaultFields),this.registerInitializedFields(e)}resolveSegment(e){const t=this.getKeyframes(),i=this.normalizeFraction(e);if(t.length<2)return{index:0,localT:i};const s=t.length-1,n=t[0],a=t[s],r=a-n,o=a>=n;let l=i;if(0!==r&&Number.isFinite(r)&&(l=n+r*i),o){if(l<=n)return{index:0,localT:0};if(l>=a)return{index:s-1,localT:1}}else{if(l>=n)return{index:0,localT:0};if(l<=a)return{index:s-1,localT:1}}for(let e=0;e<s;e++){const i=t[e],s=t[e+1];if(!(s>=i?l>=i&&l<=s:l<=i&&l>=s))continue;const n=s-i;return{index:e,localT:0===n?0:(l-i)/n}}return{index:s-1,localT:1}}getKeyframes(){const e=this.getValueJS("key");return Array.isArray(e)?e:[]}normalizeFraction(e){const t=Math.min(Math.max(e,0),1);return this.getValueJS("reverse")?1-t:t}}class ve extends we{targetCache=new WeakMap;animationFields=[{name:"duration",type:"float",value:"0"},{name:"easeFunction",type:"string",value:"outCubic"},{name:"easeInPercent",type:"float",value:"0.5"},{name:"easeOutPercent",type:"float",value:"0.5"},{name:"optional",type:"boolean",value:"false"},{name:"willBeSkipped",type:"boolean",value:"false",system:!0}];constructor(e=[],t=$.Animation){super(e,t),this.registerDefaultFields(this.animationFields),this.refreshWillBeSkipped()}setValue(e,t,i=!1,s){const n=e.toLowerCase();"willbeskipped"!==n&&(super.setValue(e,t,i,s),"optional"===n&&this.refreshWillBeSkipped())}handleControl(e){"start"!==e&&"resume"!==e||!this.computeSkipDecision()?super.handleControl(e):this.playSkippedAnimation()}updateAnimation(t){for(const i of this.children){if(!(i instanceof Se))continue;i.setValue("fraction",new e.Float(t));const s=i.interpolate(t);if(!s)continue;const n=this.resolveTarget(i);n&&n.node.setValue(n.field,s)}}shapeFraction(e){return this.applyEaseFunction(e,this.getEaseFunction())}getDurationSeconds(){const e=this.getValueJS("duration");return"number"==typeof e&&e>0?e:0}applyEaseFunction(e,t){const i=Math.min(Math.max(e,0),1);switch(t.toLowerCase()){case"linear":default:return i;case"inquad":return i*i;case"outquad":return i*(2-i);case"inoutquad":return i<.5?2*i*i:(4-2*i)*i-1;case"incubic":return Math.pow(i,3);case"outcubic":return Math.pow(i-1,3)+1;case"inoutcubic":return i<.5?4*Math.pow(i,3):4*Math.pow(i-1,3)+1;case"inquartic":return Math.pow(i,4);case"outquartic":return 1-Math.pow(i-1,4);case"inoutquartic":return i<.5?8*Math.pow(i,4):1-8*Math.pow(i-1,4);case"inquintic":return Math.pow(i,5);case"outquintic":return 1+Math.pow(i-1,5);case"inoutquintic":return i<.5?16*Math.pow(i,5):1+16*Math.pow(i-1,5);case"inexpo":return 0===i?0:Math.pow(2,10*(i-1));case"outexpo":return 1===i?1:1-Math.pow(2,-10*i);case"inoutexpo":return 0===i||1===i?i:i<.5?.5*Math.pow(2,20*i-10):1-.5*Math.pow(2,-20*i+10);case"piecewise":return this.applyPiecewiseEase(i)}}applyPiecewiseEase(e){const t=this.clampPercent(this.getValueJS("easeInPercent"),.5),i=this.clampPercent(this.getValueJS("easeOutPercent"),.5),s=Math.min(i,1-t),n=Math.min(t,1-s),a=Math.max(0,1-n-s);if(n>0&&e<=n){const t=e/n;return n*t*t}if(s>0&&e>=1-s){const t=(e-(1-s))/s;return 1-s+s*(1-Math.pow(1-t,2))}return a>0?n+a*((e-n)/a):e}clampPercent(e,t){return"number"!=typeof e||Number.isNaN(e)?Math.min(Math.max(t,0),1):Math.min(Math.max(e,0),1)}getEaseFunction(){const e=this.getValueJS("easeFunction");return"string"==typeof e&&e.length>0?e:"outCubic"}refreshWillBeSkipped(){this.setWillBeSkippedFlag(this.computeSkipDecision(!1))}computeSkipDecision(t=!0){const i=Boolean(this.getValueJS("optional")),s=e.BrsDevice.deviceInfo?.customFeatures,n=i&&Array.isArray(s)&&s.some(e=>"skip_optional_animations"===e.toLowerCase());return t&&this.setWillBeSkippedFlag(n),n}setWillBeSkippedFlag(t){const i=this.fields.get("willbeskipped");i&&(i.setValue(e.BrsBoolean.from(t)),this.fields.set("willbeskipped",i))}playSkippedAnimation(){this._state="running",this.updateStateField("running"),this.updateAnimation(this.shapeFraction(1)),this.stop()}resolveTarget(e){const t=e.getValueJS("fieldToInterp");if("string"!=typeof t||0===t.trim().length)return void this.targetCache.delete(e);const i=t.trim(),s=this.targetCache.get(e);if(s?.signature===i.toLowerCase())return s;let n,a="";if(i.includes(".")){const[e,...t]=i.split(".");a=t.join(".").trim(),n=this.findTargetNode(e.trim())}else{const e=this.getNodeParent();n=e instanceof S?e:this,a=i}if(!n||!a)return void this.targetCache.delete(e);const r={node:n,field:a,signature:i.toLowerCase()};return this.targetCache.set(e,r),r}findTargetNode(e){if(!e)return;const t=this.getSearchRoot();if(!t)return;const i=this.findNodeById(t,e);return i instanceof S?i:void 0}getSearchRoot(){let e=this;for(;e instanceof we;){const t=e.getNodeParent();if(!(t instanceof S))return e;e=t}return e??(F.scene instanceof S?F.scene:void 0)}}class be extends we{constructor(e=[],t=$.ParallelAnimation){super(e,t)}setValue(e,t,i=!1){if(super.setValue(e,t,i),"control"===e.toLowerCase()){const e=t.getValue().toLowerCase();"start"!==e&&"stop"!==e||this.propagateControl(e)}}updateAnimation(e){}tick(){if("running"!==this._state)return!1;let e=!0;for(const t of this.children)if(t instanceof we&&"stopped"!==t.getValueJS("state")){e=!1;break}return e&&(this.getValueJS("repeat")?this.propagateControl("start"):this.stop()),!0}stop(){this.propagateControl("stop"),super.stop()}propagateControl(t){for(const i of this.children)i instanceof we&&i.setValue("control",new e.BrsString(t))}}class Fe extends we{currentChildIndex=-1;constructor(e=[],t=$.SequentialAnimation){super(e,t)}setValue(e,t,i=!1){if(super.setValue(e,t,i),"control"===e.toLowerCase()){const e=t.getValue().toLowerCase();"start"===e?(this.currentChildIndex=0,this.playNext()):"stop"===e&&(this.stopCurrent(),this.currentChildIndex=-1)}}playNext(){if(this.currentChildIndex>=0&&this.currentChildIndex<this.children.length){const t=this.children[this.currentChildIndex];t instanceof we&&t.setValue("control",new e.BrsString("start"))}else this.getValueJS("repeat")?(this.currentChildIndex=0,this.playNext()):this.stop()}stopCurrent(){if(this.currentChildIndex>=0&&this.currentChildIndex<this.children.length){const t=this.children[this.currentChildIndex];t instanceof we&&t.setValue("control",new e.BrsString("stop"))}}tick(){if("running"!==this._state)return!1;if(this.currentChildIndex>=0&&this.currentChildIndex<this.children.length){const e=this.children[this.currentChildIndex];e instanceof we&&"stopped"===e.getValueJS("state")&&(this.currentChildIndex++,this.playNext())}else-1===this.currentChildIndex&&this.children.length>0?(this.currentChildIndex=0,this.playNext()):this.stop();return!0}stop(){this.stopCurrent(),this.currentChildIndex=-1,super.stop()}updateAnimation(e){}}class Be extends Se{interpolationFields=[{name:"keyValue",type:"floatarray",value:"[]"}];constructor(e=[],t=$.FloatFieldInterpolator){super(e,t),this.registerDefaultFields(this.interpolationFields)}interpolate(t){const i=this.getValueJS("keyValue");if(!Array.isArray(i)||0===i.length)return;if(1===i.length)return new e.Float(i[0]);const{index:s,localT:n}=this.resolveSegment(t),a=Math.min(s,i.length-2),r=i[a],o=r+(i[Math.min(a+1,i.length-1)]-r)*n;return new e.Float(o)}}class Ve extends Se{interpolationFields=[{name:"keyValue",type:"colorarray",value:"[]"}];constructor(e=[],t=$.ColorFieldInterpolator){super(e,t),this.registerDefaultFields(this.interpolationFields)}interpolate(t){const i=this.getValueJS("keyValue");if(!Array.isArray(i)||0===i.length)return;if(1===i.length)return new e.Int32(i[0]);const{index:s,localT:n}=this.resolveSegment(t),a=Math.min(s,i.length-2),r=i[a],o=i[Math.min(a+1,i.length-1)],l=this.interpolateColor(r,o,n);return new e.Int32(l)}interpolateColor(e,t,i){const s=this.toHsv(e),n=this.toHsv(t);let a=s.h,r=n.h;Math.abs(r-a)>180&&(r>a?a+=360:r+=360);const o=(a+(r-a)*i+360)%360,l=Math.min(Math.max(s.s+(n.s-s.s)*i,0),1),h=Math.min(Math.max(s.v+(n.v-s.v)*i,0),1),d=s.a+(n.a-s.a)*i;return this.fromHsv(o,l,h,d)}toHsv(e){const t=(e>>24&255)/255,i=(e>>16&255)/255,s=(e>>8&255)/255,n=255&e,a=Math.max(t,i,s),r=a-Math.min(t,i,s);let o=0;return 0!==r&&(o=a===t?(i-s)/r%6*60:a===i?60*((s-t)/r+2):60*((t-i)/r+4)),o<0&&(o+=360),{h:o,s:0===a?0:r/a,v:a,a:n}}fromHsv(e,t,i,s){const n=i*t,a=n*(1-Math.abs(e/60%2-1)),r=i-n;let o=0,l=0,h=0;return e<60?(o=n,l=a):e<120?(o=a,l=n):e<180?(l=n,h=a):e<240?(l=a,h=n):e<300?(o=a,h=n):(o=n,h=a),(255&Math.round(255*(o+r)))<<24|(255&Math.round(255*(l+r)))<<16|(255&Math.round(255*(h+r)))<<8|255&Math.round(Math.min(Math.max(s,0),255))}}class Ce extends Se{interpolationFields=[{name:"keyValue",type:"vector2darray",value:"[]"}];constructor(e=[],t=$.Vector2DFieldInterpolator){super(e,t),this.registerDefaultFields(this.interpolationFields)}interpolate(i){const s=this.getValue("keyValue");if(!(s instanceof e.RoArray)||0===s.getElements().length)return;const n=s.getElements();if(1===n.length&&n[0]instanceof e.RoArray)return n[0].deepCopy();const{index:a,localT:r}=this.resolveSegment(i),o=Math.min(a,n.length-2),l=n[o],h=n[Math.min(o+1,n.length-1)];if(l instanceof e.RoArray&&h instanceof e.RoArray){const i=t(l),s=t(h);if(Array.isArray(i)&&Array.isArray(s)&&i.length>=2&&s.length>=2){const t=i[0]+(s[0]-i[0])*r,n=i[1]+(s[1]-i[1])*r;return new e.RoArray([new e.Float(t),new e.Float(n)])}}}}!function(e){e.Node="Node",e.ContentNode="ContentNode",e.Group="Group",e.LayoutGroup="LayoutGroup",e.MaskGroup="MaskGroup",e.TargetGroup="TargetGroup",e.TargetList="TargetList",e.TargetSet="TargetSet",e.ButtonGroup="ButtonGroup",e.Button="Button",e.Panel="Panel",e.PanelSet="PanelSet",e.ListPanel="ListPanel",e.GridPanel="GridPanel",e.OverhangPanelSetScene="OverhangPanelSetScene",e.Dialog="Dialog",e.KeyboardDialog="KeyboardDialog",e.PinPad="PinPad",e.PinDialog="PinDialog",e.ParentalControlPinPad="ParentalControlPinPad",e.StandardDialog="StandardDialog",e.StandardKeyboardDialog="StandardKeyboardDialog",e.StandardMessageDialog="StandardMessageDialog",e.StandardPinPadDialog="StandardPinPadDialog",e.StandardProgressDialog="StandardProgressDialog",e.ProgressDialog="ProgressDialog",e.StdDlgActionCardItem="StdDlgActionCardItem",e.StdDlgAreaBase="StdDlgAreaBase",e.StdDlgBulletTextItem="StdDlgBulletTextItem",e.StdDlgButton="StdDlgButton",e.StdDlgButtonArea="StdDlgButtonArea",e.StdDlgContentArea="StdDlgContentArea",e.StdDlgCustomItem="StdDlgCustomItem",e.StdDlgDeterminateProgressItem="StdDlgDeterminateProgressItem",e.StdDlgGraphicItem="StdDlgGraphicItem",e.StdDlgItemBase="StdDlgItemBase",e.StdDlgItemGroup="StdDlgItemGroup",e.StdDlgKeyboardItem="StdDlgKeyboardItem",e.StdDlgMultiStyleTextItem="StdDlgMultiStyleTextItem",e.StdDlgProgressItem="StdDlgProgressItem",e.StdDlgSideCardArea="StdDlgSideCardArea",e.StdDlgTextItem="StdDlgTextItem",e.StdDlgTitleArea="StdDlgTitleArea",e.Rectangle="Rectangle",e.Poster="Poster",e.Label="Label",e.LabelBase="LabelBase",e.SimpleLabel="SimpleLabel",e.MultiStyleLabel="MultiStyleLabel",e.MonospaceLabel="MonospaceLabel",e.ScrollingLabel="ScrollingLabel",e.ScrollableText="ScrollableText",e.Font="Font",e.ArrayGrid="ArrayGrid",e.PosterGrid="PosterGrid",e.LabelList="LabelList",e.CheckList="CheckList",e.RowList="RowList",e.RadioButtonList="RadioButtonList",e.MarkupList="MarkupList",e.ZoomRowList="ZoomRowList",e.MarkupGrid="MarkupGrid",e.TimeGrid="TimeGrid",e.Task="Task",e.Timer="Timer",e.Scene="Scene",e.Keyboard="Keyboard",e.MiniKeyboard="MiniKeyboard",e.DynamicKeyboard="DynamicKeyboard",e.DynamicKeyboardBase="DynamicKeyboardBase",e.DynamicMiniKeyboard="DynamicMiniKeyboard",e.DynamicCustomKeyboard="DynamicCustomKeyboard",e.DynamicPinPad="DynamicPinPad",e.DynamicKeyGrid="DynamicKeyGrid",e.TextEditBox="TextEditBox",e.VoiceTextEditBox="VoiceTextEditBox",e.Overhang="Overhang",e.RSGPalette="RSGPalette",e.Video="Video",e.Audio="Audio",e.SoundEffect="SoundEffect",e.TrickPlayBar="TrickPlayBar",e.Animation="Animation",e.AnimationBase="AnimationBase",e.SequentialAnimation="SequentialAnimation",e.ParallelAnimation="ParallelAnimation",e.FloatFieldInterpolator="FloatFieldInterpolator",e.Vector2DFieldInterpolator="Vector2DFieldInterpolator",e.ColorFieldInterpolator="ColorFieldInterpolator",e.BusySpinner="BusySpinner",e.ChannelStore="ChannelStore",e.ComponentLibrary="ComponentLibrary",e.InfoPane="InfoPane"}($||($={}));var xe=i(507),Ie=i.n(xe);function Te(e){const t=e.toLowerCase();return Object.values($).some(e=>e.toLowerCase()===t)}class ke{static additionalNodes=new Map;static addNodeTypes(e){for(const[t,i]of e)this.additionalNodes.set(t.toLowerCase(),i)}static createNode(t,i){let s=i||t;const n=this.additionalNodes.get(t?.toLowerCase());if(n)return n(s);switch(t.toLowerCase()){case $.Node.toLowerCase():return new S([],s);case $.Group.toLowerCase():case $.MaskGroup.toLowerCase():case $.TargetGroup.toLowerCase():case $.ScrollableText.toLowerCase():return new T([],s);case $.LayoutGroup.toLowerCase():return new M([],s);case $.Panel.toLowerCase():case $.ListPanel.toLowerCase():case $.GridPanel.toLowerCase():return new te([],s);case $.Button.toLowerCase():return new L([],s);case $.ButtonGroup.toLowerCase():return new O([],s);case $.KeyboardDialog.toLowerCase():return new X([],s);case $.Dialog.toLowerCase():return new _([],s);case $.Rectangle.toLowerCase():return new ne([],s);case $.Label.toLowerCase():return new P([],s);case $.ScrollingLabel.toLowerCase():return new le([],s);case $.Font.toLowerCase():return new K([],s);case $.Poster.toLowerCase():return new A([],s);case $.ArrayGrid.toLowerCase():return new R([],s);case $.LabelList.toLowerCase():return new U([],s);case $.CheckList.toLowerCase():return new H([],s);case $.RadioButtonList.toLowerCase():return new se([],s);case $.RowList.toLowerCase():return new ae([],s);case $.ZoomRowList.toLowerCase():return new ye([],s);case $.MarkupList.toLowerCase():return new q([],s);case $.MarkupGrid.toLowerCase():return new Y([],s);case $.ContentNode.toLowerCase():return new k(s);case $.Task.toLowerCase():return new me([],s);case $.Timer.toLowerCase():return new Q([],s);case $.Scene.toLowerCase():return new oe([],s);case $.Audio.toLowerCase():return new D([],s);case $.SoundEffect.toLowerCase():return new he([],s);case $.Video.toLowerCase():return new fe([],s);case $.TrickPlayBar.toLowerCase():return new pe([],s);case $.Keyboard.toLowerCase():return new j([],s);case $.MiniKeyboard.toLowerCase():return new Z([],s);case $.TextEditBox.toLowerCase():return new z([],s);case $.Overhang.toLowerCase():return new ee([],s);case $.StandardDialog.toLowerCase():return new re([],s);case $.StandardProgressDialog.toLowerCase():return new ge([],s);case $.StdDlgContentArea.toLowerCase():return new ue([],s);case $.StdDlgTitleArea.toLowerCase():return new de([],s);case $.StdDlgProgressItem.toLowerCase():return new ce([],s);case $.BusySpinner.toLowerCase():return new N([],s);case $.RSGPalette.toLowerCase():return new ie([],s);case $.ChannelStore.toLowerCase():return new E([],s);case $.Animation.toLowerCase():return new ve([],s);case $.ParallelAnimation.toLowerCase():return new be([],s);case $.SequentialAnimation.toLowerCase():return new Fe([],s);case $.FloatFieldInterpolator.toLowerCase():return new Be([],s);case $.ColorFieldInterpolator.toLowerCase():return new Ve([],s);case $.Vector2DFieldInterpolator.toLowerCase():return new Ce([],s);default:return Te(t)?(e.BrsDevice.stderr.write(`warning,The roSGNode with type "${t}" is not implemented yet, created as regular "Node".`),new S([],s)):void 0}}static canResolveNodeType(e){return this.additionalNodes.has(e?.toLowerCase())||Te(e)}}function Re(t,i){let s=ke.createNode(t)??e.BrsInvalid.Instance;if(s instanceof e.BrsInvalid){let n=F.nodeDefMap.get(t.toLowerCase());if(n&&i instanceof e.Interpreter)s=Ne(i,t,n);else{if(!n)return e.BrsDevice.stderr.write(`warning,BRIGHTSCRIPT: ERROR: roSGNode: Failed to create roSGNode with type ${t}: ${i?.formatLocation()??""}`),e.BrsInvalid.Instance;n=Pe(n).pop(),s=ke.createNode(n.extends,t)??e.BrsInvalid.Instance,s instanceof e.BrsInvalid&&(s=new S([],t))}}if(s instanceof me&&(s.id=F.tasks.length+1,F.tasks.push(s),F.setThread(s.id)),s instanceof S&&F.inTaskThread()){const t=F.tasks[0];t&&(0,e.isInvalid)(s.getNodeParent())&&s.setNodeParent(t)}return s}function De(t,i){let s=F.nodeDefMap.get(i.toLowerCase());return Pe(s),s&&He(i,$.Scene)?new oe([],i):(e.BrsDevice.stderr.write(`warning,BRIGHTSCRIPT: ERROR: roSGNode: Failed to create a Scene with type ${i}: ${t.formatLocation()}`),e.BrsInvalid.Instance)}function Ae(e){return F.nodeDefMap.has(e.toLowerCase())}function Ne(t,i,s,n){if(s){const a=Pe(s),r=s.environment?.createSubEnvironment();s=a.pop(),n??=ke.createNode(s.extends,i),n??=new S([],i);const o=new e.RoAssociativeArray([]);for(r?.setM(new e.RoAssociativeArray([])),r&&(r.hostNode=n);s;){let i;t.inSubEnv(t=>(Ee(t,n,s),Oe(t,n,s),e.BrsInvalid.Instance),r),n instanceof oe&&n.renderNode(t,[0,0],0,1),t.inSubEnv(t=>(i=t.getCallableFunction("init"),e.BrsInvalid.Instance),s.environment),t.inSubEnv(t=>(t.environment.hostNode=n,o.set(new e.BrsString("top"),n),o.set(new e.BrsString("global"),F.mGlobal),t.environment.setM(o),t.environment.setRootM(o),n.m=o,i instanceof e.Callable&&i.call(t),e.BrsInvalid.Instance),r),s=a.pop()}return n}return e.BrsDevice.stderr.write(`warning,BRIGHTSCRIPT: ERROR: roSGNode: Failed to initialize roSGNode with type ${i}: ${t.formatLocation()}`),e.BrsInvalid.Instance}function Le(t,i){const s=i.name;let a=F.nodeDefMap.get(s.toLowerCase());if(a){let r=Pe(a),l=a.environment?.createSubEnvironment();a=r.pop();let h=ke.createNode(a.extends,s)||new me([],s),d=new e.RoAssociativeArray([]);for(l?.setM(new e.RoAssociativeArray([])),l&&(l.hostNode=h);a;)t.inSubEnv(t=>(Ee(t,h,a),Oe(t,h,a),e.BrsInvalid.Instance),l),t.inSubEnv(t=>(t.environment.hostNode=h,d.set(new e.BrsString("top"),h),d.set(new e.BrsString("global"),F.mGlobal),t.environment.setM(d),t.environment.setRootM(d),h.m=d,e.BrsInvalid.Instance),l),a=r.pop();return function(t,i,s){let a;if(i instanceof me&&(i.id=s.id,i.thread=!0,F.tasks.push(i),F.setThread(0,!1,s.render),F.setThread(s.id,!0),t.environment.hostNode=i),s.m)for(let[t,r]of Object.entries(s.m)){if("global"===t||"top"===t)continue;const s=n(r);!a&&s instanceof e.RoMessagePort&&(a=s),i.m.set(new e.BrsString(t),s)}if(s.m?.global&&Me(t,s.m.global,F.mGlobal,a),s.m?.top&&Me(t,s.m.top,i,a),s.scene?._node_){const e=s.scene._node_.split(":"),t=o(s.scene,e[0],e[1]);t instanceof oe&&F.setScene(t)}}(t,h,i),h}return e.BrsDevice.stderr.write(`warning,BRIGHTSCRIPT: ERROR: roSGNode: Failed to initialize Task with type ${s}: ${t.formatLocation()}`),e.BrsInvalid.Instance}function Pe(e){let t=[];if(!e)return t;for(t.push(e);e;){const i=e.name.toLowerCase();Ue.has(i)||Ue.set(i,e.extends||$.Node),(e=F.nodeDefMap.get(e.extends.toLowerCase()))&&t.push(e)}return t}function Me(t,i,s,a){const r=i._observed_;s.owner=i._owner_??F.taskId;for(let[o,l]of Object.entries(i))o.startsWith("_")&&o.endsWith("_")&&o.length>2||(s.setValueSilent(o,n(l)),a&&r?.includes(o)&&s.addObserver(t,"unscoped",new e.BrsString(o),a))}function Oe(t,i,s){let n=s.fields;for(let[a,r]of Object.entries(n))if(r instanceof Object){if(r.alias?.includes(".")){const t=r.alias.split(".")[0],n=r.alias.split(".")[1],o=i.findNodeById(i,t);if(!(o instanceof S)){let n=`warning,Error creating XML component ${i.nodeSubtype}\n`;return n+=`-- Interface field alias failed: No node named ${t}\n`,n+=`-- Error found ${s.xmlPath}`,void e.BrsDevice.stderr.write(n)}{const r=o.getNodeFields().get(n?.toLowerCase());if(!r){let a=`warning,Error creating XML component ${i.nodeSubtype}\n`;return a+=`-- Interface field alias failed: Node "${t}" has no field named "${n}"\n`,a+=`-- Error found ${s.xmlPath}`,void e.BrsDevice.stderr.write(a)}i.addNodeFieldAlias(a,r,t,n)}}else{if(i.getNodeFields().get(a.toLowerCase())){let t=`warning,Error creating XML component ${i.nodeSubtype}\n`;return t+=`-- Attempt to add duplicate field "${a}" to RokuML component "${i.nodeSubtype}"\n`,t+=`---- Extends node type "${s.extends}" already has a field named ${a}\n`,t+=`-- Error found ${s.xmlPath}`,void e.BrsDevice.stderr.write(t)}i.addNodeField(a,r.type,"true"===r.alwaysNotify),r.value&&i.setValueSilent(a,Je(r.type,r.value))}if(r.onChange){const s=i.getNodeFields().get(a.toLowerCase()),n=t.getCallableFunction(r.onChange);n instanceof e.Callable&&s&&s.addObserver("permanent",t,n,i,new e.BrsString(a))}}}function Ee(e,t,i){const s=i.children,n=t.getMethod("appendchild");for(let i of s){const s=Re(i.name,e);if(s instanceof S){const a=s.getNodeFields();for(let[e,t]of Object.entries(i.fields)){const i=a.get(e.toLowerCase());i&&s.setValue(e,Je(i.getType(),t))}if(i.fields?.role){const n=i.fields.role;if(!t.getNodeFields().get(n))throw new Error(`Role/Field ${n} does not exist in ${t.getId()} node`);i.children.length>0&&Ee(e,s,i),t.setValue(n,s,!1)}else n&&(n.call(e,s),i.children.length>0&&Ee(e,s,i))}}}const Ue=new Map;function He(e,t){if(t=t.toLowerCase(),(e=e.toLowerCase())===t)return!0;let i=Ue.get(e);return null!=i&&He(i,t)}function _e(e){if(Te(e))return e;let t=Ue.get(e.toLowerCase());return null==t?$.Node:Te(t)?t:_e(t)}function Ke(t){switch(t.toLowerCase()){case"bool":case"boolean":return e.ValueKind.Boolean;case"color":case"int":case"integer":return e.ValueKind.Int32;case"longinteger":return e.ValueKind.Int64;case"float":return e.ValueKind.Float;case"time":case"double":return e.ValueKind.Double;case"uri":case"str":case"string":return e.ValueKind.String;case"function":return e.ValueKind.Callable;case"node":case"font":case"roarray":case"array":case"roassociativearray":case"assocarray":case"rect2d":case"vector2d":case"floatarray":case"intarray":case"boolarray":case"stringarray":case"vector2darray":case"rect2darray":case"colorarray":case"timearray":case"nodearray":return e.ValueKind.Object;default:return e.ValueKind.Invalid}}function Je(t,i){let s;switch(t.toLowerCase()){case"bool":case"boolean":s=i?e.BrsBoolean.from("true"===i.toLowerCase()):e.BrsBoolean.False;break;case"int":case"integer":s=i?new e.Int32(Number.parseInt(i)):new e.Int32(0);break;case"longinteger":s=i?new e.Int64(Ie().fromString(i)):new e.Int64(0);break;case"float":s=i?new e.Float(Number.parseFloat(i)):new e.Float(0);break;case"time":case"double":s=i?new e.Double(Number.parseFloat(i)):new e.Double(0);break;case"node":s=new e.RoInvalid;break;case"font":s=new K,s instanceof K&&i?.startsWith("font:")&&!s.setSystemFont(i.slice(5).toLowerCase())&&(s=e.BrsInvalid.Instance);break;case"roarray":case"array":case"vector2d":case"rect2d":case"boolarray":case"floatarray":case"intarray":case"stringarray":case"timearray":case"vector2darray":case"rect2darray":case"nodearray":s=function(t){const i=t?.trim();if(!i?.startsWith("[")||!i.endsWith("]"))return new e.RoArray([]);try{const t=JSON.parse(i);return Array.isArray(t)?new e.RoArray(t.map(e=>n(e))):new e.RoArray([])}catch{return new e.RoArray([])}}(i??"");break;case"colorarray":s=function(t){const i=t?.trim();if(!i?.startsWith("[")||!i.endsWith("]"))return new e.RoArray([]);const s=i.slice(1,-1).trim();if(!s)return new e.RoArray([]);const n=s.split(","),a=[];for(const t of n)""!==t.trim()&&a.push(new e.Int32(I(t)));return new e.RoArray(a)}(i??"");break;case"roassociativearray":case"assocarray":case"object":s=e.BrsInvalid.Instance;break;case"uri":case"str":case"string":s=new e.BrsString(i??"");break;case"color":s=new e.Int32(-1),i?.length&&(s=new e.Int32(I(i)));break;default:s=e.Uninitialized.Instance}return s}async function ze(e){try{return{status:"fulfilled",value:await e,isFulfilled:!0,isRejected:!1}}catch(e){return{status:"rejected",reason:e,isFulfilled:!1,isRejected:!0}}}var Ge=i(308);async function We(e,t={}){const{concurrency:i=Number.POSITIVE_INFINITY,mapper:s}=t;if(s&&"function"!=typeof s)throw new TypeError("Mapper must be a function");const n=Ge(i);return Promise.all(e.map((e,t)=>s?ze(n(()=>s(e,t))):e&&"function"==typeof e.then?ze(e):ze("function"==typeof e?n(()=>e()):Promise.resolve(e))))}var $e=i(942);class je{componentMap;excludedNames=["init"];parserLexerFn;constructor(e,t,i){this.componentMap=e,this.parserLexerFn=this.getLexerParserFn(t,i)}async resolve(e){let t=await We(Array.from(this.getStatements(e))),i=t.filter(e=>e.isRejected);if(i.length>0){for(const e of i)for(const t of e.reason.messages)console.error(t);throw new Error(`Unable to resolve scope for component ${e.name}`)}return this.flatten(t.map(e=>e.isFulfilled?e.value:[]))}flatten(e){let t=e.shift()||[],i=new Set(t.filter(e=>!0).map(e=>e.name.text.toLowerCase()));for(;e.length>0;){let s=e.shift()||[];t=t.concat(s.filter(e=>!0).filter(e=>{let t=e.name.text.toLowerCase(),s=i.has(t);return s||i.add(t),!s&&!this.excludedNames.includes(t)}))}return t}*getStatements(e){yield this.parserLexerFn(e.scripts);let t=e;for(;t.extends;){if(ke.canResolveNodeType(t.extends))return;let e=t;if(t=this.componentMap.get(t.extends.toLowerCase()),!t)return void console.error(`Warning: XML component '${e.name}' extends unknown component '${e.extends}'. Ignoring extension.`);yield this.parserLexerFn(t.scripts)}}getLexerParserFn(t,i){const s=new Map;return async function(n){async function a(s){let n,a;if(void 0!==s.uri){a=s.uri.replaceAll(/[/\\]+/g,$e.posix.sep);try{n=t.readFileSync(a,"utf-8"),s.content=n}catch(e){throw new Error(`brs: can't open file '${a}': [Errno ${e?.errno||-4858}]`)}}else{if(void 0===s.content)throw new Error("brs: invalid script object");n=s.content,a=s.xmlPath||"xml"}const r=new e.Lexer,o=new e.preprocessor.Preprocessor,l=new e.Parser;for(const t of[r,o,l])t.onError(e.logError);const h=r.scan(n,a);if(h.errors.length>0)throw new Error("Error occurred during lexing");const d=o.preprocess(h.tokens,i);if(d.errors.length>0)throw new Error("Error occurred during pre-processing");const u=l.parse(d.processedTokens);if(u.errors.length>0)throw new Error("Error occurred parsing");return u.statements}const r=[];for(const e of n)if(void 0!==e.uri){const t=s.get(e.uri);if(t)r.push(t);else{const t=a(e);s.has(e.uri)||s.set(e.uri,t),r.push(t)}}else void 0!==e.content&&r.push(a(e));let o=await We(r);if(o.some(e=>e.isRejected)){const e=o.filter(e=>e.isRejected).map(e=>e.reason.message);throw new Error(e.join("\n"))}return o.map(e=>e.isFulfilled?e.value:[]).reduce((e,t)=>[...e,...t],[])}}}const Xe=xmldoc;let Ye;class qe{xmlPath;contents;xmlNode;name;processed=!1;fields={};functions={};children=[];scripts=[];environment;constructor(e){this.xmlPath=e}async parse(){try{if(void 0===Ye)throw new Error("FileSystem not set");return this.contents=Ye.readFileSync(this.xmlPath,"utf-8"),this.xmlNode=new Xe.XmlDocument(this.contents??""),this.name=this.xmlNode.attr.name,this}catch(e){throw postMessage(`error,[ComponentDefinition] Error parsing component XML at ${this.xmlPath}: ${e.message}`),e}}get extends(){return this.xmlNode?.attr?.extends??""}get initialFocus(){return this.xmlNode?.attr?.initialFocus??""}}async function Ze(e,t=[],i){Ye=e;const s=[],n=["components",...t];for(const e of n){const t=`pkg:/${e.replaceAll("\\","/")}`;Ye?.existsSync(t)&&s.push(...Ye.findSync(t,"xml"))}return async function(e,t){const i=await e,s=new Map;if(0===i.length)return s;for(const e of i)if(e.isFulfilled&&!e.isRejected){let i=e.value?.name?.toLowerCase();t&&(i=`${t.toLowerCase()}:${i}`),i&&s.set(i,e.value)}let n=[];for(const e of s.values()){if(!1===e?.processed){let t=e.xmlNode;for(n.push(e);t?.attr?.extends;){let e=s.get(t.attr.extends?.toLowerCase());e?(n.push(e),t=e.xmlNode):t=void 0}let i={};for(;n.length>0;){let e=n.pop();if(e)if(e.processed)i=e.functions;else{let t=et(e.xmlNode);i={...i,...t.functions},e.functions=i,e.fields=t.fields,e.processed=!0}}}e?.xmlNode&&(e.children=tt(e.xmlNode),e.scripts=await st(e.xmlNode,e))}return s}(We(s.map(e=>new qe(e)).map(async e=>e.parse())),i)}async function Qe(t,i,s,n){if(!Ye)throw new Error("FileSystem not set");const a=n.entryPoint??!1,r=new je(i,Ye,s);await We(Array.from(i).map(async i=>{const[s,n]=i;n.environment=t.environment.createSubEnvironment(!1);const a=await r.resolve(n);t.inSubEnv(t=>{const i=new e.RoAssociativeArray([]);return t.options.entryPoint=!1,t.environment.setM(i),t.environment.setRootM(i),t.exec(a),e.BrsInvalid.Instance},n.environment)})),t.options.entryPoint=a}function et(e){const t=e.childNamed("interface"),i={},s={};return t?(t.eachChild(e=>{"field"===e.name?i[e.attr.id]={type:e.attr.type,id:e.attr.id,alias:e.attr.alias,onChange:e.attr.onChange,alwaysNotify:e.attr.alwaysNotify,value:e.attr.value}:"function"===e.name&&(s[e.attr.name]={name:e.attr.name})}),{fields:i,functions:s}):{fields:i,functions:s}}function tt(e){const t=e.childNamed("children");if(!t)return[];const i=[];return it(t,i),i}function it(e,t){e.eachChild(e=>{const i={name:e.name,fields:e.attr,children:[]};e.children.length>0&&it(e,i.children),t.push(i)})}async function st(t,i){const s=t.childrenNamed("script"),n=[];for(const t of s){if(t.attr.uri&&t.val)throw new Error(e.BrsError.format("<script> element cannot contain both internal and external source",at(i,t)).trim());if(t.attr?.uri){let e=await nt(t,i);n.push({type:t.attr.type,uri:e})}else"string"==typeof t.val&&n.push({type:t.attr.type,content:t.val,xmlPath:i.xmlPath})}return n}async function nt(t,i){let s;try{if(t.attr.uri.startsWith("pkg:/"))s=t.attr.uri;else{let n=$e.dirname(i.xmlPath.replaceAll(/[/\\]+/g,$e.posix.sep));e.Platform.inWindows&&(n=n.replace(/^[a-zA-Z]:/,"")),s=$e.join(n,t.attr.uri)}}catch(s){throw new Error(e.BrsError.format(`Invalid path '${t.attr.uri}' found in <script/> tag`,at(i,t)).trim())}return s}function at(e,t){const i=(e.contents?.substring(t.startTagPosition??0,t.position??0)??"").split("\n"),s=e.contents?.substring(0,t.startTagPosition??0).split("\n")??[],n={line:s.length,column:rt(s)};return{file:e.xmlPath,start:n,end:{line:n.line+i.length-1,column:n.column+rt(i)}}}function rt(e){return e[e.length-1].length+e.length-1}class ot extends e.BrsEvent{closed;constructor(e){super("roSGScreenEvent"),this.closed=e,this.appendMethods([this.isScreenClosed])}isScreenClosed=new e.Callable("isScreenClosed",{signature:{args:[],returns:e.ValueKind.Dynamic},impl:e=>this.closed})}const lt=new Map([[0,"back"],[2,"up"],[3,"down"],[4,"left"],[5,"right"],[6,"OK"],[7,"replay"],[8,"rewind"],[9,"fastforward"],[10,"options"],[13,"play"]]);class ht extends e.BrsComponent{kind=e.ValueKind.Object;x=0;y=0;draw2D;maxMs;canvas;context;textureManager;fontRegistry;port;sceneType;alphaEnable;lastMessage;width;height;resolution;scaleMode;isDirty;constructor(){super("roSGScreen"),this.draw2D=new e.IfDraw2D(this),this.textureManager=(0,e.getTextureManager)(),this.fontRegistry=(0,e.getFontRegistry)(),this.alphaEnable=!0,this.scaleMode=1,this.isDirty=!1,this.lastMessage=performance.now();const t=e.BrsDevice.deviceInfo.maxFps;this.maxMs=Math.trunc(1/t*1e3),this.width=1280,this.height=720,this.resolution="HD",this.canvas=(0,e.createNewCanvas)(this.width,this.height),this.context=this.canvas.getContext("2d");const i=new e.IfSetMessagePort(this,this.getNewEvents.bind(this)),s=new e.IfGetMessagePort(this);this.registerMethods({ifSGScreen:[this.getGlobalNode,this.show,this.close,this.createScene,this.getScene,i.setMessagePort,s.getMessagePort]})}clearCanvas(t){Number.isNaN(t)&&(t=255);const i=this.context;i.clearRect(0,0,this.canvas.width,this.canvas.height),(255&t)>0&&(i.fillStyle=(0,e.rgbaIntToHex)(t),i.fillRect(0,0,this.canvas.width,this.canvas.height)),this.isDirty=!0}getContext(){return this.context}getCanvas(){return this.canvas}getRgbaCanvas(e){return this.canvas}setCanvasAlpha(e){this.alphaEnable=e,this.isDirty=!0}getCanvasAlpha(){return this.alphaEnable}drawImage(t,i,s,n=1,a=1,r){return this.isDirty=!0,(0,e.drawObjectToComponent)(this,t,i,s,n,a,r)}makeDirty(){this.isDirty=!0}finishDraw(){this.isDirty&&(postMessage(this.context.getImageData(0,0,this.width,this.height)),this.isDirty=!1)}equalTo(t){return e.BrsBoolean.False}toString(){return"<Component: roSGScreen>"}dispose(){(0,e.releaseCanvas)(this.canvas)}getDebugData(){return{textures:this.textureManager.count(),fonts:this.fontRegistry.count()}}getNewEvents(t){const i=[],s=this.handleNextKey(t);if(s instanceof e.BrsEvent&&i.push(s),F.scene){const i=F.processTimers(),s=F.processAnimations(),n=F.processTasks(),a=F.processAudio(),r=F.processSFX(),o=F.processVideo();this.isDirty||=i||s||n||a||r||o;const l=F.scene?.dialog?.getNodeParent()instanceof e.BrsInvalid;if((F.isDirty||this.isDirty||l)&&(F.clearDirty(),F.scene.renderNode(t,[0,0],0,1,this.draw2D)),l){const i=F.scene.dialog;i.setValueSilent("visible",e.BrsBoolean.True);const s={x:0,y:0,width:this.width,height:this.height};this.draw2D.doDrawRotatedRect(s,255,0,[0,0],.5),i.renderNode(t,[0,0],0,1,this.draw2D)}let h=Date.now();for(;h-this.lastMessage<this.maxMs;)h=Date.now();this.finishDraw(),this.lastMessage=h}return i}handleNextKey(t){const i=e.BrsDevice.updateKeysBuffer();if(!i||!F?.scene)return e.BrsInvalid.Instance;this.isDirty=!0;const s=i.key-i.mod;let n;n=s<32?new e.BrsString(lt.get(s)??""):new e.BrsString(`Lit_${String.fromCodePoint(s)}`);const a=e.BrsBoolean.from(0===i.mod);let r=!1;return r=F.scene.dialog?.isVisible()?F.scene.dialog.handleKey(n.value,a.toBoolean()):F.scene.handleOnKeyEvent(t,n,a),a.toBoolean()&&(this.playNavigationSound(n.value,r),"back"===n.value&&!r)?new ot(e.BrsBoolean.True):e.BrsInvalid.Instance}playNavigationSound(t,i){let s="deadend";"back"===t?s="navsingle":["OK","options"].includes(t)&&i?s="select":["rewind","fastforward"].includes(t)&&i?s="navmulti":i&&(s="navsingle"),e.BrsDevice.playSound(s)}getGlobalNode=new e.Callable("getGlobalNode",{signature:{args:[],returns:e.ValueKind.Dynamic},impl:e=>F.mGlobal});show=new e.Callable("show",{signature:{args:[],returns:e.ValueKind.Boolean},impl:t=>{if(this.sceneType&&F.scene){const e=F.nodeDefMap.get(this.sceneType.value.toLowerCase());Ne(t,this.sceneType.value,e,F.scene)}return this.isDirty=!0,e.BrsBoolean.True}});close=new e.Callable("close",{signature:{args:[],returns:e.ValueKind.Void},impl:t=>(this.port?.pushMessage(new ot(e.BrsBoolean.True)),e.Uninitialized.Instance)});createScene=new e.Callable("createScene",{signature:{args:[new e.StdlibArgument("sceneType",e.ValueKind.String)],returns:e.ValueKind.Object},impl:(t,i)=>{const s=t.manifest,n=s.get("ui_resolutions")??"HD";if(n.length&&"HD"!==n){const e=n.split(",");"FHD"===e[0].toUpperCase()?(this.resolution="FHD",this.width=1920,this.height=1080,this.canvas.width=this.width,this.canvas.height=this.height):"SD"===e[0].toUpperCase()&&(this.resolution="SD",this.width=720,this.height=480,this.canvas.width=this.width,this.canvas.height=this.height)}let a;if(i.value===$.Scene)a=new oe([],$.Scene);else{if(!F.nodeDefMap.has(i.value.toLowerCase()))return e.BrsDevice.stderr.write(`warning,BRIGHTSCRIPT: ERROR: roSGScreen.CreateScene: No such node ${i.value}: ${t.formatLocation()}`),e.BrsInvalid.Instance;a=De(t,i.value)}if(!(a instanceof oe))return e.BrsDevice.stderr.write(`warning,BRIGHTSCRIPT: ERROR: roSGScreen.CreateScene: Type mismatch converting from '${i.value}' to 'Scene': ${t.formatLocation()}`),e.BrsInvalid.Instance;{this.sceneType=i;const e=s.get("uri_resolution_autosub")??"";F.setScene(a),F.scene?.setDesignResolution(this.resolution,e)}return a}});getScene=new e.Callable("getScene",{signature:{args:[],returns:e.ValueKind.Object},impl:t=>F.scene??e.BrsInvalid.Instance})}class dt{name="SceneGraph";version="0.0.5";onInit(){e.BrsObjects.set("rosgscreen",()=>new ht,0),e.BrsObjects.set("rosgnode",(e,t)=>Re(t.getValue(),e),1)}async onBeforeExecute(t,i){try{const s=await Ze(e.BrsDevice.fileSystem,[]);s.size>0?(await Qe(t,s,i.manifest,t.options),F.setNodeDefMap(s)):e.BrsDevice.fileSystem.existsSync("pkg:/components")&&postMessage("warning,No SceneGraph components found!")}catch(i){i instanceof e.BrsError?t.addError(i):postMessage(`error,Failed to load SceneGraph components: ${i.message}`)}}updateSourceMap(e){if(!F.nodeDefMap?.size)return;const t=F.nodeDefMap;for(const i of t.values())for(const t of i.scripts){const i=t.uri??t.xmlPath;i&&t.content?.length&&e.set(i,t.content)}}tick(e){F.inTaskThread()&&F.tasks[0]?.updateTask()}execTask(t,i){const s=i.taskData,n=Le(t,s),a=s.m?.top?.functionname;if(!(n instanceof me&&a))return;s.buffer&&n.setTaskBuffer(s.buffer);const r=F.nodeDefMap.get(n.nodeSubtype.toLowerCase()),o=r?.environment;if(o)try{const i=n.m;t.inSubEnv(t=>{const r=t.getCallableFunction(a);if(t.environment.hostNode=n,t.environment.setM(i),t.environment.setRootM(i),r instanceof e.Callable){postMessage(`debug,[sg] Task function called: ${s.name} ${a}`),r.call(t),postMessage(`debug,[sg] Task function finished: ${s.name} ${a}`);const i={id:n.id,type:"task",field:"control",value:"stop"};postMessage(i),s.state=e.TaskState.STOP,postMessage(s)}else t.addError(new e.BrsError(`Cannot found the Task function '${a}'`,t.location));return e.BrsInvalid.Instance},o)}catch(i){if(!(i instanceof e.Stmt.ReturnValue)){if(i instanceof e.BrsError){const e=t.formatBacktrace(i.location,!0,i.backTrace),s=new Error(`${i.format()}\nBackTrace:\n${e}`);throw s.cause=i,s}throw i}}}}})(),s})());